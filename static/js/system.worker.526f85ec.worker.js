!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=19)}([function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"e",(function(){return I})),n.d(t,"h",(function(){return s})),n.d(t,"d",(function(){return c})),n.d(t,"p",(function(){return l})),n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return p})),n.d(t,"c",(function(){return d})),n.d(t,"m",(function(){return y})),n.d(t,"f",(function(){return b})),n.d(t,"q",(function(){return k})),n.d(t,"i",(function(){return w})),n.d(t,"k",(function(){return O})),n.d(t,"j",(function(){return E})),n.d(t,"n",(function(){return x})),n.d(t,"g",(function(){return j})),n.d(t,"l",(function(){return C})),n.d(t,"o",(function(){return S}));var i,r=n(0);!function(e){e[e.Tag=0]="Tag"}(i||(i={}));var a,s=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(r.a)(this,e),this._integerDescriptorTag=i.Tag,this.initialValue=Math.trunc(t)};!function(e){e[e.Tag=0]="Tag"}(a||(a={}));var o,c=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(r.a)(this,e),this._floatDescriptorTag=a.Tag,this.initialValue=t};!function(e){e[e.Tag=0]="Tag"}(o||(o={}));var u,l=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object(r.a)(this,e),this._TextDescriptorTag=o.Tag,this.initialValue=t};!function(e){e[e.Tag=0]="Tag"}(u||(u={}));var h,f=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(Object(r.a)(this,e),this._characterDescriptorTag=u.Tag,t.length>1)throw new Error("CharacterDescriptor initialValue lenght > 1");this.initialValue=t};!function(e){e[e.Tag=0]="Tag"}(h||(h={}));var v,p=function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(r.a)(this,e),this._booleanDescriptorTag=h.Tag,this.initialValue=t},g=n(6),m=function e(){Object(r.a)(this,e),this.init=new T,this.variables=new Array,this.procedures=new Array,this.components=new Array},d=function e(t){Object(r.a)(this,e),this.identifier=t,this.offers=new Array,this.requires=new Array,this.declarations=new m,this.implementations=new Array,this.begin=new T,this.activity=new T,this.finally=new T},y=function e(t,n){Object(r.a)(this,e),this.identifier=t,this.returnType=n,this.parameters=new Array,this.declarations=new m,this.begin=new T},b=function e(t){Object(r.a)(this,e),this.reference=t,this.declarations=new m,this.begin=new T},k=function e(t,n,i){Object(r.a)(this,e),this.identifier=t,this.type=n,this.mutable=i,this.indexTypes=new Array},T=function e(){Object(r.a)(this,e),this.instructions=new Array},w=function e(t){Object(r.a)(this,e),this.identifier=t,this.protocols=new Array},O=function e(t){Object(r.a)(this,e),this.identifier=t,this.data=new Array},E=function e(t){Object(r.a)(this,e),this.offset=t},x=function e(t){Object(r.a)(this,e),this.systemCall=t;for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];this.arguments=Object(g.a)(Array,i)};!function(e){e[e.Once=0]="Once",e[e.Optional=1]="Optional",e[e.Repeating=2]="Repeating"}(v||(v={}));var C,S,j=function e(t){Object(r.a)(this,e),this.code=t;for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];this.arguments=Object(g.a)(Array,i)};!function(e){e[e.Add=0]="Add",e[e.Subtract=1]="Subtract",e[e.Multiply=2]="Multiply",e[e.Divide=3]="Divide",e[e.Negate=4]="Negate",e[e.Modulo=5]="Modulo",e[e.Equal=6]="Equal",e[e.Less=7]="Less",e[e.LessEqual=8]="LessEqual",e[e.Greater=9]="Greater",e[e.GreaterEqual=10]="GreaterEqual",e[e.NotEqual=11]="NotEqual",e[e.Not=12]="Not",e[e.LogicOr=13]="LogicOr",e[e.LogicAnd=14]="LogicAnd",e[e.New=15]="New",e[e.Delete=16]="Delete",e[e.Send=17]="Send",e[e.Receive=18]="Receive",e[e.Connect=19]="Connect",e[e.Disconnect=20]="Disconnect",e[e.ReceiveTest=21]="ReceiveTest",e[e.InputTest=22]="InputTest",e[e.SystemCall=23]="SystemCall",e[e.ProcedureCall=24]="ProcedureCall",e[e.Return=25]="Return",e[e.LoadConstantBoolean=26]="LoadConstantBoolean",e[e.LoadConstantText=27]="LoadConstantText",e[e.LoadConstantCharacter=28]="LoadConstantCharacter",e[e.LoadConstantFloat=29]="LoadConstantFloat",e[e.LoadConstantInteger=30]="LoadConstantInteger",e[e.Move=31]="Move",e[e.StoreVariable=32]="StoreVariable",e[e.LoadVariable=33]="LoadVariable",e[e.LoadService=34]="LoadService",e[e.LoadThis=35]="LoadThis",e[e.Await=36]="Await",e[e.Passivate=37]="Passivate",e[e.AcquireShared=38]="AcquireShared",e[e.ReleaseShared=39]="ReleaseShared",e[e.AcquireExclusive=40]="AcquireExclusive",e[e.ReleaseExclusive=41]="ReleaseExclusive",e[e.Branch=42]="Branch",e[e.BranchTrue=43]="BranchTrue",e[e.BranchFalse=44]="BranchFalse",e[e.IsType=45]="IsType",e[e.ExistsTest=46]="ExistsTest"}(C||(C={})),function(e){e[e.Write=0]="Write",e[e.WriteLine=1]="WriteLine",e[e.WriteHex=2]="WriteHex",e[e.Assert=3]="Assert",e[e.Halt=4]="Halt",e[e.Inc=5]="Inc",e[e.Dec=6]="Dec",e[e.Passivate=7]="Passivate",e[e.Count=8]="Count",e[e.Length=9]="Length",e[e.Sqrt=10]="Sqrt",e[e.Sin=11]="Sin",e[e.Cos=12]="Cos",e[e.Tan=13]="Tan",e[e.ArcSin=14]="ArcSin",e[e.ArcCos=15]="ArcCos",e[e.ArcTan=16]="ArcTan",e[e.Random=17]="Random",e[e.Min=18]="Min",e[e.Max=19]="Max",e[e.ToCharacter=20]="ToCharacter",e[e.ToInteger=21]="ToInteger",e[e.ToReal=22]="ToReal",e[e.ToText=23]="ToText",e[e.LoadForEachDesignators=24]="LoadForEachDesignators"}(S||(S={}));var I=function e(){Object(r.a)(this,e),this.entryPoints=new Array,this.components=new Array,this.interfaces=new Array}},function(e,t,n){"use strict";n.d(t,"d",(function(){return l})),n.d(t,"l",(function(){return f})),n.d(t,"i",(function(){return p})),n.d(t,"k",(function(){return m})),n.d(t,"e",(function(){return y})),n.d(t,"m",(function(){return b})),n.d(t,"j",(function(){return k})),n.d(t,"h",(function(){return T})),n.d(t,"o",(function(){return w})),n.d(t,"a",(function(){return E})),n.d(t,"g",(function(){return C})),n.d(t,"f",(function(){return j})),n.d(t,"n",(function(){return L})),n.d(t,"c",(function(){return P})),n.d(t,"b",(function(){return F}));var i,r,a=n(4),s=n(5),o=n(3),c=n(0);!function(e){e[e.Init=0]="Init",e[e.Begin=1]="Begin",e[e.Activity=2]="Activity",e[e.Finally=3]="Finally",e[e.Procedure=4]="Procedure"}(i||(i={})),function(e){e[e.Tag=0]="Tag"}(r||(r={}));var u,l=function e(t,n){Object(c.a)(this,e),this.address=t,this.type=n,this._componentPointerTag=r.Tag};!function(e){e[e.Tag=0]="Tag"}(u||(u={}));var h,f=function e(t,n){Object(c.a)(this,e),this.address=t,this.type=n,this._servicePointerTag=u.Tag};!function(e){e[e.Tag=0]="Tag"}(h||(h={}));var v,p=function e(t,n){Object(c.a)(this,e),this.address=t,this.type=n,this._procedurePointerTag=h.Tag};!function(e){e[e.Tag=0]="Tag"}(v||(v={}));var g,m=function e(){Object(c.a)(this,e),this._rootPointerTag=v.Tag},d=function(){function e(t,n){Object(c.a)(this,e),this.declarations=t,this.parent=n,this.variables=new Array,this.procedures=new Array,this.done=!1,this.activeCode=i.Init,this.lastActiveCode=i.Init,this.instructionPointer=new Map([[i.Init,0],[i.Begin,0],[i.Activity,0],[i.Finally,0],[i.Procedure,0]])}return Object(o.a)(e,[{key:"fetch",value:function(){var e;if(this.updateActiveSection(),!this.isDone())switch(this.activeCode){case i.Init:return this.declarations.init.instructions[this.loadAndAdvanceIP()];case i.Procedure:return null===(e=this.procedures[this.loadIP()])||void 0===e?void 0:e.fetch();default:return this.fetchNext()}}},{key:"jump",value:function(e){if(!this.isDone()){var t=this.instructionPointer.get(this.activeCode)+e.offset;if(t<0)throw new Error("Invalid jump.");this.instructionPointer.set(this.activeCode,t)}}},{key:"call",value:function(e,t){var n,r=this;if(t.length!==e.parameters.length)throw new Error("Procedurecall: Number of parameters do not match.");if(this.activeCode===i.Procedure)return null===(n=this.procedures[this.activeCode])||void 0===n||n.call(e,t),!1;this.lastActiveCode=this.activeCode,this.activeCode=i.Procedure;var a=this.procedures.findIndex((function(t){return t.descriptor===e}));if(-1===a)throw new Error("Unkonwn procedure, hierarchical calls are not yet supported.");return this.instructionPointer.set(this.activeCode,a),t.forEach((function(t,n){if(void 0!==t){var i=e.parameters[n],s=new w(i,t);s.fixAccessModifier(),r.procedures[a].parameters.push(s)}})),!0}},{key:"procedureReturned",value:function(){var e;if(this.activeCode!==i.Procedure)throw new Error("Return is only supported in a procedure.");null===(e=this.procedures[this.loadIP()])||void 0===e||e.markReturned()}},{key:"currentState",value:function(){return this.activeCode}},{key:"finalize",value:function(){this.lastActiveCode===i.Finally&&this.activeCode===i.Procedure||(this.lastActiveCode=this.activeCode,this.activeCode=i.Finally)}},{key:"isDone",value:function(){return this.done}},{key:"loadIP",value:function(){return this.instructionPointer.get(this.activeCode)}},{key:"loadAndAdvanceIP",value:function(){var e=this.loadIP();return this.activeCode!==i.Procedure&&this.instructionPointer.set(this.activeCode,e+1),e}},{key:"updateActiveSection",value:function(){if(!this.isDone()&&this.activeDone())return this.activeCode===i.Init?(this.lastActiveCode=this.activeCode,this.activeCode=i.Begin,this.variables.forEach((function(e){e instanceof w&&e.fixAccessModifier()})),void this.updateActiveSection()):this.activeCode===i.Begin?(this.lastActiveCode=this.activeCode,this.activeCode=i.Activity,void this.updateActiveSection()):this.activeCode===i.Activity?(this.lastActiveCode=this.activeCode,this.activeCode=i.Finally,void this.updateActiveSection()):this.activeCode===i.Procedure?(this.activeCode=this.lastActiveCode,this.lastActiveCode=i.Procedure,void this.updateActiveSection()):this.activeCode===i.Finally?(this.lastActiveCode=this.activeCode,void(this.done=!0)):void 0}},{key:"activeDone",value:function(){var e=this.loadIP();return this.initActive()?e>=this.declarations.init.instructions.length:this.procedureActive()?void 0===this.procedures[e]||this.procedures[e].isDone():this.activeCodeDone()}},{key:"initActive",value:function(){return this.activeCode===i.Init}},{key:"procedureActive",value:function(){return this.activeCode===i.Procedure}},{key:"resetActive",value:function(){this.done=!1,this.activeCode=i.Init,this.lastActiveCode=i.Init,this.instructionPointer=new Map([[i.Init,0],[i.Begin,0],[i.Activity,0],[i.Finally,0],[i.Procedure,0]])}}]),e}(),y=function(e){Object(a.a)(n,e);var t=Object(s.a)(n);function n(e,i){var r;return Object(c.a)(this,n),(r=t.call(this,e.declarations,i)).descriptor=e,r.offerConnections=new Map,r.requiredConnections=new Map,e.offers.forEach((function(e){return r.offerConnections.set(e,void 0)})),e.requires.forEach((function(e){return r.requiredConnections.set(e,void 0)})),r}return Object(o.a)(n,[{key:"fetchNext",value:function(){switch(this.activeCode){case i.Begin:return this.loadIP()<this.descriptor.begin.instructions.length?this.descriptor.begin.instructions[this.loadAndAdvanceIP()]:void 0;case i.Activity:return this.loadIP()<this.descriptor.activity.instructions.length?this.descriptor.activity.instructions[this.loadAndAdvanceIP()]:void 0;case i.Finally:return this.descriptor.finally.instructions[this.loadAndAdvanceIP()];default:return}}},{key:"activeCodeDone",value:function(){var e=this.loadIP();switch(this.activeCode){case i.Begin:return e>=this.descriptor.begin.instructions.length;case i.Activity:return e>=this.descriptor.activity.instructions.length;case i.Finally:return e>=this.descriptor.finally.instructions.length;default:return!0}}}]),n}(d),b=function(e){Object(a.a)(n,e);var t=Object(s.a)(n);function n(e,i){var r;return Object(c.a)(this,n),(r=t.call(this,e.declarations,i)).descriptor=e,r.messageQueue=new Array,r}return Object(o.a)(n,[{key:"fetchNext",value:function(){switch(this.activeCode){case i.Begin:return this.descriptor.begin.instructions[this.loadAndAdvanceIP()];default:return}}},{key:"activeCodeDone",value:function(){var e=this.loadIP();switch(this.activeCode){case i.Begin:return this.descriptor.begin.instructions.length<=e;default:return!0}}}]),n}(d),k=function(e){Object(a.a)(n,e);var t=Object(s.a)(n);function n(e,i){var r;return Object(c.a)(this,n),(r=t.call(this,e.declarations,i)).descriptor=e,r.hasReturned=!1,r.parameters=new Array,r}return Object(o.a)(n,[{key:"findConnectedService",value:function(){}},{key:"markReturned",value:function(){var e;return this.activeCode===i.Procedure?(null!==(e=this.procedures[this.loadIP()])&&void 0!==e&&e.markReturned()&&(this.activeCode=this.lastActiveCode,this.lastActiveCode=i.Procedure),!1):(this.resetActive(),this.parameters=new Array,!0)}},{key:"fetchNext",value:function(){switch(this.activeCode){case i.Begin:return this.descriptor.begin.instructions[this.loadAndAdvanceIP()];default:return}}},{key:"activeCodeDone",value:function(){var e=this.loadIP();switch(this.activeCode){case i.Begin:return!this.hasReturned&&this.descriptor.begin.instructions.length<=e;default:return!0}}}]),n}(d),T=function e(t){Object(c.a)(this,e),this.descriptor=t,this.fields=new Array},w=function(){function e(t,n){Object(c.a)(this,e),this.descriptor=t,this.value=n,this.mutable=!0}return Object(o.a)(e,[{key:"isMutabled",value:function(){return this.mutable}},{key:"fixAccessModifier",value:function(){this.mutable=this.descriptor.mutable}}]),e}();!function(e){e[e.Tag=0]="Tag"}(g||(g={}));var O,E=function e(t,n){Object(c.a)(this,e),this.descriptor=t,this.value=n,this._arrayVariableTag=g.Tag};!function(e){e[e.Tag=0]="Tag"}(O||(O={}));var x,C=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(c.a)(this,e),this.value=t,this._integerTag=O.Tag};!function(e){e[e.Tag=0]="Tag"}(x||(x={}));var S,j=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(c.a)(this,e),this.value=t,this._floatTag=x.Tag};!function(e){e[e.Tag=0]="Tag"}(S||(S={}));var I,L=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object(c.a)(this,e),this.value=t,this._textTag=S.Tag};!function(e){e[e.Tag=0]="Tag"}(I||(I={}));var A,P=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"\0";Object(c.a)(this,e),this.value=t,this._characterTag=I.Tag};!function(e){e[e.Tag=0]="Tag"}(A||(A={}));var F=function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(c.a)(this,e),this.value=t,this._booleanTag=A.Tag}},function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(10);function r(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Object(i.a)(e,t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n(11),r=n(12);function a(e){return(a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){return!t||"object"!==a(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){var t=Object(r.a)();return function(){var n,r=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return s(this,n)}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(10),r=n(12);function a(e,t,n){return(a=Object(r.a)()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&Object(i.a)(a,n.prototype),a}).apply(null,arguments)}},function(e,t,n){"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var i,r,a;if(Array.isArray(t)){if((i=t.length)!=n.length)return!1;for(r=i;0!==r--;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((i=(a=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(r=i;0!==r--;)if(!Object.prototype.hasOwnProperty.call(n,a[r]))return!1;for(r=i;0!==r--;){var s=a[r];if(!e(t[s],n[s]))return!1}return!0}return t!==t&&n!==n}},function(e,t,n){e.exports=n(17)},function(e,t,n){"use strict";function i(e,t,n,i,r,a,s){try{var o=e[a](s),c=o.value}catch(u){return void n(u)}o.done?t(c):Promise.resolve(c).then(i,r)}function r(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function o(e){i(s,r,a,o,c,"next",e)}function c(e){i(s,r,a,o,c,"throw",e)}o(void 0)}))}}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";function i(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return g}));var i=n(8),r=n.n(i),a=n(9),s=n(0),o=n(3),c=n(15),u=n(1),l=n(2),h=n(14),f=n(16),v=n(7),p=n.n(v),g=function(){function t(){Object(s.a)(this,t),this.scheduler=new c.a,this.nextTaskId=0,this.stop=!1,this.memory=new Map,this.objectDependency=new Map,this.out=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.forEach((function(t){return e.stdout.write(t)}))},this.isRunning=function(){},this.interfaceToService=new Map,this.serviceToImpl=new Map,this.clientToServer=new Map}return Object(o.a)(t,[{key:"halt",value:function(){this.stop=!0}},{key:"changeOutput",value:function(e){this.out=e}},{key:"isRunningUpdate",value:function(e){this.isRunning=e}},{key:"run",value:function(){var e=Object(a.a)(r.a.mark((function e(t){var n,i=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stop=!1,this.isRunning(!0),t.entryPoints.forEach((function(e){i.createComponent(e,new l.k)})),n=this.scheduler.getActiveTask();case 4:if(void 0===n||this.stop){e.next=10;break}return e.next=7,n.execute();case 7:n=this.scheduler.getActiveTask(),e.next=4;break;case 10:this.isRunning(!1);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"print",value:function(){this.out.apply(this,arguments)}},{key:"time",value:function(){return(new Date).getMilliseconds()}},{key:"load",value:function(e){var t=this.tryLoad(e);if(void 0===t)throw new Error("Failed to load value.");return t}},{key:"tryLoad",value:function(e){return this.memory.get(e)}},{key:"getDefaultVariableValue",value:function(e){return e instanceof u.h?new l.g:e instanceof u.d?new l.f:e instanceof u.p?new l.n:e instanceof u.b?new l.c:e instanceof u.a?new l.b:void 0}},{key:"createComponent",value:function(e,t){var n=this,i=new l.d(this.nextTaskId++,e),r=new l.e(e,t);return this.objectDependency.set(i,t),this.memory.set(i,r),this.registerTask(i),e.declarations.variables.forEach((function(e){e.indexTypes.length>0&&!(e.type instanceof u.p)?r.variables.push(new l.a(e,new Map)):r.variables.push(new l.o(e,n.getDefaultVariableValue(e.type)))})),e.declarations.procedures.forEach((function(e){var t=new l.j(e,i),a=new l.i(n.nextTaskId++,e);n.memory.set(a,t),n.objectDependency.set(a,i),r.procedures.push(t)})),e.offers.forEach((function(e){n.interfaceToService.has(e)||n.interfaceToService.set(e,new Map)})),e.requires.forEach((function(e){n.interfaceToService.has(e)||n.interfaceToService.set(e,new Map)})),i}},{key:"registerTask",value:function(e){var t=new f.a(this,e),n=new h.a(e,t);this.scheduler.enqueue(n)}},{key:"getService",value:function(e,t){var n=this.interfaceToService.get(e);if(void 0===n)throw new Error("Interface not defined for service.");var i=this.memory.get(t);if(!(i instanceof l.e))throw new Error("Component not in memory.");var r=i.descriptor.implementations.find((function(t){return p()(t.reference,e)}));if(n.has(t))return n.get(t);if(void 0!==r){var a=new l.l(this.nextTaskId++,e);return this.serviceToImpl.set(a,t),n.set(t,a),a}var s=i.offerConnections.get(e);if(void 0!==s)return s;var o=i.requiredConnections.get(e);if(void 0!==o)return o;throw new Error("No service connected and no implementation found.")}},{key:"findService",value:function(e,t){var n=this;if(!(t instanceof l.k)){var i=this.objectDependency.get(t);if(void 0===i)throw new Error("Pointer without a parent.");if(t instanceof l.i)return this.findService(e,i);var r=this.memory.get(t);if(t instanceof l.l)return r instanceof l.m&&p()(r.descriptor.reference,e)?t:this.findService(e,i);if(r instanceof l.d){var a,s=null===(a=this.clientToServer.get(r))||void 0===a?void 0:a.filter((function(t){var i=n.memory.get(t);return i instanceof l.m&&p()(i.descriptor.reference,e)}));return 1===(null===s||void 0===s?void 0:s.length)?s[0]:void 0}}}},{key:"send",value:function(e,t){var n=this.memory.get(e);if(void 0===n||!(n instanceof l.m))throw new Error("No service found to send to.");n.messageQueue.push(t)}},{key:"receive",value:function(e,n){var i=this.memory.get(e);if(void 0===i||!(i instanceof l.m))throw new Error("No service found to send to.");var r=i.messageQueue;if(void 0!==r&&0!==r.length){var a=r[0].descriptor;return p()(a,n)||p()(n,t.anyMessage)||p()(a,t.finishMessage)?r.shift():void 0}}},{key:"receiveTest",value:function(e){var t=this.memory.get(e);if(void 0===t||!(t instanceof l.m))throw new Error("No service found to send to.");var n=t.messageQueue;if(void 0!==n&&0!==n.length)return n[0]}},{key:"connect",value:function(e,t){var n=this.memory.get(e);if(!(n instanceof l.e))throw new Error('connect: "To" must be a component value.');var i=n.descriptor.implementations.find((function(e){return p()(e.reference,t.type)}));if(void 0===i&&!this.serviceToImpl.has(t))throw new Error("Impl undefined.");if(void 0!==i){n.offerConnections.set(t.type,t);var r=this.memory.get(this.serviceToImpl.get(t));if(void 0===r||!(r instanceof l.e))throw new Error("from undefiend when connecting");r.requiredConnections.set(t.type,t)}if(void 0===i){var a;if(void 0===(i=null===(a=this.serviceToImpl.get(t))||void 0===a?void 0:a.type.implementations.find((function(e){return p()(e.reference,t.type)}))))throw new Error("Implementation not found.");n.requiredConnections.set(t.type,t);var s=this.memory.get(this.serviceToImpl.get(t));if(void 0===s||!(s instanceof l.e))throw new Error("from undefiend when connecting");s.offerConnections.set(t.type,t)}if(!this.memory.has(t)){var o=new l.m(i,this.serviceToImpl.get(t));this.memory.set(t,o)}this.registerTask(t)}},{key:"disconnect",value:function(e,t){var n,i=null===(n=this.clientToServer.get(e))||void 0===n?void 0:n.filter((function(e){return!p()(e,t)}));void 0!==i&&this.clientToServer.set(e,i)}}]),t}();g.finishMessage=new l.h(new u.k("FINISH")),g.anyMessage=new l.h(new u.k("ANY"))}).call(this,n(18))},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return u}));var i,r=n(8),a=n.n(r),s=n(9),o=n(0),c=n(3);!function(e){e[e.Ready=0]="Ready",e[e.Running=1]="Running",e[e.Paused=2]="Paused",e[e.Done=3]="Done"}(i||(i={}));var u=function(){function e(t,n){Object(o.a)(this,e),this.value=t,this.interpreter=n,this.state=i.Ready}return Object(c.a)(e,[{key:"execute",value:function(){var e=Object(s.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isDone()&&!this.interpreter.isDone()){e.next=3;break}return this.state=i.Done,e.abrupt("return");case 3:this.state=i.Running,this.interpreter.processNext();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pause",value:function(){this.isDone()||(this.state=i.Paused)}},{key:"isDone",value:function(){return this.state===i.Done}},{key:"getState",value:function(){return this.state}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(0),r=n(3),a=n(14),s=function(){function e(){Object(i.a)(this,e),this.activeTask=void 0,this.readyTasks=new Array}return Object(r.a)(e,[{key:"enqueue",value:function(e){this.readyTasks.push(e)}},{key:"getActiveTask",value:function(){return this.scheduleNext(),this.activeTask}},{key:"scheduleNext",value:function(){var e;void 0!==this.activeTask&&this.activeTask.getState()!==a.b.Done&&this.readyTasks.push(this.activeTask),null===(e=this.activeTask)||void 0===e||e.pause(),this.activeTask=this.readyTasks.shift()}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var i=n(0),r=n(3),a=n(1),s=n(2),o=function(){function e(){Object(i.a)(this,e),this.stack=new Array}return Object(r.a)(e,[{key:"pop",value:function(){if(0===this.stack.length)throw new Error("Pop called on empty evaluation stack.");var e=this.stack.pop();if(void 0===e)throw new Error("Undefined value on stack.");return e}},{key:"popVariable",value:function(){var e=this.pop();return e instanceof s.o?e.value:e}},{key:"push",value:function(e){this.stack.push(e)}}]),e}(),c=n(13),u=function(){function e(t,n){Object(i.a)(this,e),this.system=t,this.evalStack=n}return Object(r.a)(e,[{key:"handleNoArg",value:function(e){switch(e){case a.o.WriteLine:return void this.system.print("\n")}throw new Error("Failed system call '".concat(a.o[e],"' and zero argumentss. Operation not supported."))}},{key:"handleSingleArg",value:function(t,n){switch(t){case a.o.Write:if((n=e.toValue(n))instanceof s.n||n instanceof s.c||n instanceof s.f||n instanceof s.g)return void this.system.print(n.value.toString());break;case a.o.WriteHex:if((n=e.toValue(n))instanceof s.g)return void this.system.print(n.value.toString(16));break;case a.o.Assert:if((n=e.toValue(n))instanceof s.b){if(!n.value)throw new Error("Assertion failed.");return}break;case a.o.Halt:if((n=e.toValue(n))instanceof s.g)throw new Error("Halt called. Id: ".concat(n.value));break;case a.o.Inc:if(n instanceof s.o){var i=n.value;if(i instanceof s.g)return void(n.value=new s.g(i.value+1))}break;case a.o.Dec:if(n instanceof s.o){var r=n.value;if(r instanceof s.g)return void(n.value=new s.g(r.value-1))}break;case a.o.Passivate:return void console.warn("PASSIVATE syscall not supported");case a.o.Count:return void console.warn("COUNT syscall not supported");case a.o.Length:if((n=e.toValue(n))instanceof s.n)return void this.evalStack.push(new s.g(n.value.length));break;case a.o.Sqrt:if((n=e.toValue(n))instanceof s.f)return void this.evalStack.push(new s.f(Math.sqrt(n.value)));break;case a.o.Sin:if((n=e.toValue(n))instanceof s.f)return void this.evalStack.push(new s.f(Math.sin(n.value)));break;case a.o.Cos:if((n=e.toValue(n))instanceof s.f)return void this.evalStack.push(new s.f(Math.cos(n.value)));break;case a.o.Tan:if((n=e.toValue(n))instanceof s.f)return void this.evalStack.push(new s.f(Math.tan(n.value)));break;case a.o.ArcSin:if((n=e.toValue(n))instanceof s.f)return void this.evalStack.push(new s.f(Math.asin(n.value)));break;case a.o.ArcCos:if((n=e.toValue(n))instanceof s.f)return void this.evalStack.push(new s.f(Math.acos(n.value)));break;case a.o.ArcTan:if((n=e.toValue(n))instanceof s.f)return void this.evalStack.push(new s.f(Math.atan(n.value)));break;case a.o.Min:return void this.evalStack.push(new s.f(Number.MIN_VALUE));case a.o.Max:return void this.evalStack.push(new s.f(Number.MAX_VALUE));case a.o.ToCharacter:if((n=e.toValue(n))instanceof s.g)return void this.evalStack.push(new s.c(String.fromCharCode(n.value)));break;case a.o.ToText:if((n=e.toValue(n))instanceof s.c)return void this.evalStack.push(new s.n(n.value));break;case a.o.ToInteger:if((n=e.toValue(n))instanceof s.f)return void this.evalStack.push(new s.g(Math.trunc(n.value)));break;case a.o.ToReal:if((n=e.toValue(n))instanceof s.g)return void this.evalStack.push(new s.f(n.value))}throw new Error("Failed system call '".concat(a.o[t],"' and one argument. Operation not supported."))}},{key:"handleDoubleArg",value:function(t,n,i){switch(t){case a.o.Assert:if(n=e.toValue(n),(i=e.toValue(i))instanceof s.b&&n instanceof s.g&&!i.value)throw new Error("Assertion failed. Code ".concat(n,"."));break;case a.o.Inc:if(n=e.toValue(n),i instanceof s.o){var r=i.value;if(r instanceof s.g&&n instanceof s.g)return void(i.value=new s.g(r.value+n.value))}break;case a.o.Dec:if(n=e.toValue(n),i instanceof s.o){var o=i.value;if(o instanceof s.g&&n instanceof s.g)return void(i.value=new s.g(o.value-n.value))}break;case a.o.Random:n=e.toValue(n),(i=e.toValue(i))instanceof s.g&&n instanceof s.g&&this.evalStack.push(new s.g(Math.trunc(Math.random()*n.value)+i.value))}throw new Error("Failed system call '".concat(a.o[t],"' and two arguments. Operation not supported."))}},{key:"handleForEachCall",value:function(e){throw new Error("Runtime: Foreach not yet supported.")}},{key:"handle",value:function(e){if(1!==e.arguments.length)throw new Error("SystemCall requires the number of arguments to be passed. Something must have failed during code gen.");if(!(e.arguments[0]instanceof a.h))throw new Error("SystemCall expects to be passed an IntegerDescriptor argument. Something must have failed during code gen.");for(var t=e.systemCall,n=new Array,i=0;i<e.arguments[0].initialValue;++i)n.push(this.evalStack.pop());if(t!==a.o.LoadForEachDesignators)switch(n.length){case 0:this.handleNoArg(t);break;case 1:this.handleSingleArg(t,n[0]);break;case 2:this.handleDoubleArg(t,n[0],n[1]);break;default:throw new Error("Failed system call '".concat(t,"' with ").concat(n.length," arguments. Operation not supported."))}else this.handleForEachCall(n)}}],[{key:"toValue",value:function(e){return e instanceof s.o?e.value:e}}]),e}(),l=n(7),h=n.n(l),f=function(){function e(t,n){Object(i.a)(this,e),this.system=t,this.valuePointer=n,this.evalStack=new o,this.systemCallHandler=new u(this.system,this.evalStack),this.wait=void 0}return Object(r.a)(e,[{key:"isDone",value:function(){return this.loadValue().isDone()}},{key:"loadValue",value:function(){return this.system.load(this.valuePointer)}},{key:"loadParentValue",value:function(){var e=this.loadValue();return this.system.load(e.parent)}},{key:"add",value:function(){var e=this.evalStack.popVariable(),t=this.evalStack.popVariable();if(e instanceof s.n&&t instanceof s.n)this.evalStack.push(new s.n(t.value+e.value));else if(e instanceof s.f&&t instanceof s.f)this.evalStack.push(new s.f(t.value+e.value));else{if(!(e instanceof s.g&&t instanceof s.g))throw new Error("Add operation failed.");this.evalStack.push(new s.g(Math.trunc(t.value+e.value)))}}},{key:"sub",value:function(){var e=this.evalStack.popVariable(),t=this.evalStack.popVariable();if(e instanceof s.f&&t instanceof s.f)this.evalStack.push(new s.f(t.value-e.value));else{if(!(e instanceof s.g&&t instanceof s.g))throw new Error("Sub operation failed.");this.evalStack.push(new s.g(Math.trunc(t.value-e.value)))}}},{key:"mul",value:function(){var e=this.evalStack.popVariable(),t=this.evalStack.popVariable();if(e instanceof s.f&&t instanceof s.f)this.evalStack.push(new s.f(t.value*e.value));else{if(!(e instanceof s.g&&t instanceof s.g))throw new Error("Mul operation failed.");this.evalStack.push(new s.g(Math.trunc(t.value*e.value)))}}},{key:"div",value:function(){var e=this.evalStack.popVariable(),t=this.evalStack.popVariable();if(e instanceof s.f&&t instanceof s.f)this.evalStack.push(new s.f(t.value/e.value));else{if(!(e instanceof s.g&&t instanceof s.g))throw new Error("Div operation failed.");this.evalStack.push(new s.g(Math.trunc(t.value/e.value)))}}},{key:"negate",value:function(){var e=this.evalStack.popVariable();if(e instanceof s.f)this.evalStack.push(new s.f(-e.value));else{if(!(e instanceof s.g))throw new Error("Negate operation failed.");this.evalStack.push(new s.g(-e.value))}}},{key:"mod",value:function(){var e=this.evalStack.popVariable(),t=this.evalStack.popVariable();if(e instanceof s.f&&t instanceof s.f)this.evalStack.push(new s.f(t.value%e.value));else{if(!(e instanceof s.g&&t instanceof s.g))throw new Error("Mod operation failed.");this.evalStack.push(new s.g(Math.trunc(t.value%e.value)))}}},{key:"handleComparable",value:function(e,t,n){if(e instanceof s.g&&t instanceof s.g)this.evalStack.push(new s.b(n(e.value,t.value)));else if(e instanceof s.f&&t instanceof s.f)this.evalStack.push(new s.b(n(e.value,t.value)));else if(e instanceof s.n&&t instanceof s.n)this.evalStack.push(new s.b(n(e.value,t.value)));else{if(!(e instanceof s.c&&t instanceof s.c))throw new Error("Unsupported less/greater comparison.");this.evalStack.push(new s.b(n(e.value,t.value)))}}},{key:"handleEquatable",value:function(e,t,n){if(e instanceof s.b&&t instanceof s.b)this.evalStack.push(new s.b(n(e.value,t.value)));else if(e instanceof s.g&&t instanceof s.g)this.evalStack.push(new s.b(n(e.value,t.value)));else if(e instanceof s.f&&t instanceof s.f)this.evalStack.push(new s.b(n(e.value,t.value)));else if(e instanceof s.n&&t instanceof s.n)this.evalStack.push(new s.b(n(e.value,t.value)));else{if(!(e instanceof s.c&&t instanceof s.c))throw new Error("Unsupported equality comparison.");this.evalStack.push(new s.b(n(e.value,t.value)))}}},{key:"handleCompareOp",value:function(e){var t=this.evalStack.popVariable();if(void 0===t)throw new Error("Unknown right compare argument.");var n=this.evalStack.popVariable();if(void 0===n)throw new Error("Unknown left compare argument.");switch(e){case a.l.Equal:return void this.handleEquatable(n,t,(function(e,t){return e===t}));case a.l.NotEqual:return void this.handleEquatable(n,t,(function(e,t){return e!==t}));case a.l.Less:return void this.handleComparable(n,t,(function(e,t){return e<t}));case a.l.LessEqual:return void this.handleComparable(n,t,(function(e,t){return e<=t}));case a.l.Greater:return void this.handleComparable(n,t,(function(e,t){return e>t}));case a.l.GreaterEqual:return void this.handleComparable(n,t,(function(e,t){return e>=t}))}throw new Error("Unsupprted compare op.")}},{key:"not",value:function(){var e=this.evalStack.popVariable();if(!(e instanceof s.b))throw new Error("Not operation failed.");this.evalStack.push(new s.b(!e.value))}},{key:"or",value:function(){var e=this.evalStack.popVariable(),t=this.evalStack.popVariable();if(!(e instanceof s.b&&t instanceof s.b))throw new Error("Or operation failed.");this.evalStack.push(new s.b(t.value||e.value))}},{key:"and",value:function(){var e=this.evalStack.popVariable(),t=this.evalStack.popVariable();if(!(e instanceof s.b&&t instanceof s.b))throw new Error("And operation failed.");this.evalStack.push(new s.b(t.value&&e.value))}},{key:"handleNewVariable",value:function(e,t){if(!e.isMutabled())throw new Error("Cannot NEW instanciate a constant value.");if(t instanceof a.c){e.value instanceof s.e&&e.value.finalize();var n=this.system.createComponent(t,this.valuePointer);e.value=n}else{if(!(t instanceof a.p))throw new Error("NEW built in variable not yet supported.");e.value=new s.n("")}}},{key:"handleNewArrayVariable",value:function(e,t){var n=this,i=new Array;e.descriptor.indexTypes.forEach((function(){return i.push(n.evalStack.popVariable())}));var r=new s.o(e.descriptor,void 0);this.handleNewVariable(r,t),e.value.set(i,r)}},{key:"handleNew",value:function(t){var n=t[0];if(1!==t.length||!(n instanceof a.c||e.isBuiltInTypeDescriptor(n)))throw new Error("Unsupported NEW call, check your code generator.");var i=this.evalStack.pop();if(i instanceof s.o)this.handleNewVariable(i,n);else{if(!(i instanceof s.a))throw new Error("Unsupported NEW. NEW target must be a variable.");this.handleNewArrayVariable(i,n)}}},{key:"handleDelete",value:function(){var e=this,t=this.evalStack.pop();if(!(t instanceof s.o||t instanceof s.a))throw new Error("Only variables can be deleted.");if(t instanceof s.o)return t.value instanceof s.e?void t.value.finalize():void(t.value=void 0);var n=new Array;t.descriptor.indexTypes.forEach((function(){return n.push(e.evalStack.popVariable())}));var i=t.value.get(n);i instanceof s.e?i.finalize():t.value.delete(n)}},{key:"loadMessage",value:function(t){var n=this,i=new s.h(t);return t.data.forEach((function(t){var r=n.evalStack.popVariable();if(!e.isBuiltInValue(r))throw new Error("Message can only contain built in values: TEXT, CHARACTER INTEGER, REAL, BOOLEAN");if(!e.descriptorMatchBuiltIn(t,r))throw new Error("Message param does not match stack value");i.fields.push(r)})),i}},{key:"handleSend",value:function(e){if(1!==e.length||!(e[0]instanceof a.k))throw new Error("MessageDescriptor required for sending.");var t=this.evalStack.pop();if(!(t instanceof s.l))throw new Error("Expected target service to send to.");var n=this.loadMessage(e[0]);this.system.send(t,n)}},{key:"handleReceive",value:function(e){var t=this;if(1!==e.length||!(e[0]instanceof a.k))throw new Error("MessageDescriptor required for receiving.");var n=e[0],i=this.evalStack.popVariable();if(!(i instanceof s.l))throw new Error("Receiver must be a service.");this.wait=function(){var e=t.system.receive(i,n);return e!==c.a.finishMessage&&(void 0===e||(e.fields.forEach((function(e){t.evalStack.push(e),t.storeVariable()})),!1))},this.wait()||(this.wait=void 0)}},{key:"handleConnect",value:function(){var e=this.evalStack.popVariable();if(!(e instanceof s.d))throw new Error("Connect target needs to be either a component.");var t=this.evalStack.pop();if(!(t instanceof s.l))throw new Error("Service required for from.");this.system.connect(e,t)}},{key:"handleDisconnect",value:function(){var e=this.evalStack.popVariable();if(!(e instanceof s.d))throw new Error("Need to know from component.");var t=this.evalStack.pop();if(!(t instanceof s.l))throw new Error("Service required for disconnecting.");this.system.disconnect(e,t)}},{key:"handleReceiveCheck",value:function(e){var t=this;if(1!==e.length||!(e[0]instanceof a.k))throw new Error("MessageDescriptor required for receiving.");var n=e[0],i=this.evalStack.popVariable();if(!(i instanceof s.l))throw new Error("Receiver must be a component or service.");this.wait=function(){var e=t.system.receiveTest(i);return void 0===e||(h()(e.descriptor,n)?(t.evalStack.push(new s.b(!0)),!1):(t.evalStack.push(new s.b(!1)),!1))},this.wait()||(this.wait=void 0)}},{key:"handleInputCheck",value:function(e){if(1!==e.length||!(e[0]instanceof a.k))throw new Error("MessageDescriptor required for receiving.");var t=e[0],n=this.evalStack.popVariable();if(!(n instanceof s.l))throw new Error("Receiver must be a component or service.");var i=this.system.receiveTest(n);void 0!==i&&h()(i.descriptor,t)?this.evalStack.push(new s.b(!0)):this.evalStack.push(new s.b(!1))}},{key:"handleSystemCall",value:function(e){if(1!==e.length||!(e[0]instanceof a.n))throw new Error("Invalid system call.");this.systemCallHandler.handle(e[0])}},{key:"handleProcedurecall",value:function(t){var n=this;if(1!==t.length||!(t[0]instanceof a.m))throw new Error("Invalid procedure call.");var i=new Array;t[0].parameters.forEach((function(){var t=n.evalStack.popVariable();if(!(t instanceof s.d||e.isBuiltInValue(t)))throw new Error("Failed to pass value to procedure.");i.push(t)})),this.loadValue().call(t[0],i)}},{key:"handleReturn",value:function(){this.loadValue().procedureReturned()}},{key:"loadBoolean",value:function(e){if(!(e.length>0&&e[0]instanceof a.a))throw new Error("Boolean load operation failed.");this.evalStack.push(new s.b(e[0].initialValue))}},{key:"loadText",value:function(e){if(!(e.length>=1&&e[0]instanceof a.p))throw new Error("Text load operation failed.");this.evalStack.push(new s.n(e[0].initialValue))}},{key:"loadCharacter",value:function(e){if(!(e.length>=1&&e[0]instanceof a.b))throw new Error("Character load operation failed.");this.evalStack.push(new s.c(e[0].initialValue))}},{key:"loadFloat",value:function(e){if(!(e.length>0&&e[0]instanceof a.d))throw new Error("Float load operation failed.");this.evalStack.push(new s.f(e[0].initialValue))}},{key:"loadInteger",value:function(e){if(!(e.length>0&&e[0]instanceof a.h))throw new Error("Integer load operation failed.");this.evalStack.push(new s.g(e[0].initialValue))}},{key:"storeVariable",value:function(){var t=this,n=this.evalStack.popVariable(),i=this.evalStack.pop();if(i instanceof s.o){if(!i.isMutabled())throw new Error("Cannot assign value to a constant.");var r=i.value;if(void 0===r&&(e.isBuiltInValue(n)||n instanceof s.d))return void(i.value=n);if(n instanceof s.g&&r instanceof s.g||n instanceof s.f&&r instanceof s.f||n instanceof s.b&&r instanceof s.b||n instanceof s.c&&r instanceof s.c||n instanceof s.n&&r instanceof s.n||n instanceof s.d&&r instanceof s.d)return void(i.value=n)}if(i instanceof s.a){var a=new Array;return i.descriptor.indexTypes.forEach((function(){return a.push(t.evalStack.popVariable())})),void i.value.set(a,n)}throw new Error("Unsupported Variable Store.")}},{key:"loadVariable",value:function(e){var t=this;if(1!==e.length)throw new Error("Expected single argument for variable load only.");if(e[0]instanceof a.q){var n=this.loadValue().variables.find((function(t){return t.descriptor===e[0]}));if(void 0===n){var i;if(this.valuePointer instanceof s.l)n=null===(i=this.loadParentValue())||void 0===i?void 0:i.variables.find((function(t){return h()(t.descriptor,e[0])}));if(void 0===n)throw new Error("Unknown variable.")}if(n instanceof s.o)return void this.evalStack.push(n);if(n instanceof s.a){var r=this.loadValue().variables.find((function(t){return h()(t.descriptor,e[0])}));if(void 0===r)throw new Error("Unknown array variable.");var o=new Array;return r.descriptor.indexTypes.forEach((function(){return o.push(t.evalStack.popVariable())})),void this.evalStack.push(n.value.get(o))}}throw new Error("Unsupported Variable Load.")}},{key:"loadService",value:function(e){if(1===e.length&&e[0]instanceof a.i){var t=this.evalStack.popVariable();if(t instanceof s.d){var n=this.system.getService(e[0],t);return void this.evalStack.push(n)}}throw new Error("Unsupported Service Load.")}},{key:"loadThis",value:function(){if(!(this.valuePointer instanceof s.l||this.valuePointer instanceof s.d))throw new Error("Load this only for services supported.");this.evalStack.push(this.valuePointer)}},{key:"branch",value:function(e){if(1!==e.length)throw new Error("Branch conditions must have one operand.");var t=e[0];if(!(t instanceof a.j))throw new Error("Failed jump.");this.loadValue().jump(t)}},{key:"branchConditionally",value:function(e,t){var n=this.evalStack.pop();if(1!==t.length)throw new Error("Branch conditions only have one operand.");if(n instanceof s.b&&t[0]instanceof a.j)return n.value===e?void this.branch(t):void 0;throw new Error("Conditional jump failed.")}},{key:"processNext",value:function(){if(!this.loadValue().isDone()){if(void 0!==this.wait){if(this.wait())return;this.wait=void 0}var e=this.loadValue().fetch();if(void 0!==e)switch(e.code){case a.l.Add:this.add();break;case a.l.Subtract:this.sub();break;case a.l.Multiply:this.mul();break;case a.l.Divide:this.div();break;case a.l.Negate:this.negate();break;case a.l.Modulo:this.mod();break;case a.l.Equal:case a.l.Less:case a.l.LessEqual:case a.l.Greater:case a.l.GreaterEqual:case a.l.NotEqual:this.handleCompareOp(e.code);break;case a.l.Not:this.not();break;case a.l.LogicOr:this.or();break;case a.l.LogicAnd:this.and();break;case a.l.New:this.handleNew(e.arguments);break;case a.l.Delete:this.handleDelete();break;case a.l.Send:this.handleSend(e.arguments);break;case a.l.Receive:this.handleReceive(e.arguments);break;case a.l.Connect:this.handleConnect();break;case a.l.Disconnect:this.handleDisconnect();break;case a.l.ReceiveTest:this.handleReceiveCheck(e.arguments);break;case a.l.InputTest:this.handleInputCheck(e.arguments);break;case a.l.SystemCall:this.handleSystemCall(e.arguments);break;case a.l.ProcedureCall:this.handleProcedurecall(e.arguments);break;case a.l.Return:this.handleReturn();break;case a.l.LoadConstantBoolean:this.loadBoolean(e.arguments);break;case a.l.LoadConstantText:this.loadText(e.arguments);break;case a.l.LoadConstantCharacter:this.loadCharacter(e.arguments);break;case a.l.LoadConstantFloat:this.loadFloat(e.arguments);break;case a.l.LoadConstantInteger:this.loadInteger(e.arguments);break;case a.l.Move:throw new Error("MOVE is not yet supported.");case a.l.StoreVariable:this.storeVariable();break;case a.l.LoadVariable:this.loadVariable(e.arguments);break;case a.l.LoadService:this.loadService(e.arguments);break;case a.l.LoadThis:this.loadThis();break;case a.l.Await:console.warn("AWAIT ignored.");break;case a.l.AcquireShared:console.warn("Acquire SHARED ignored.");break;case a.l.ReleaseShared:console.warn("Release SHARED ignored.");break;case a.l.AcquireExclusive:console.warn("Acquire EXCLUSIVE ignored.");break;case a.l.ReleaseExclusive:console.warn("Release EXCLUSIVE ignored.");break;case a.l.Branch:this.branch(e.arguments);break;case a.l.BranchTrue:this.branchConditionally(!0,e.arguments);break;case a.l.BranchFalse:this.branchConditionally(!1,e.arguments);break;case a.l.IsType:throw new Error("IS typecheck is not yet supported.");case a.l.ExistsTest:throw new Error("EXISTSW check is not yet supported.")}}}}],[{key:"isBuiltInTypeDescriptor",value:function(e){return e instanceof a.h||e instanceof a.d||e instanceof a.p||e instanceof a.b||e instanceof a.a}},{key:"isBuiltInValue",value:function(e){return e instanceof s.g||e instanceof s.f||e instanceof s.n||e instanceof s.c||e instanceof s.b}},{key:"descriptorMatchBuiltIn",value:function(e,t){return e instanceof a.h&&t instanceof s.g||e instanceof a.d&&t instanceof s.f||e instanceof a.b&&t instanceof s.c||e instanceof a.p&&t instanceof s.n||e instanceof a.a&&t instanceof s.b}}]),e}()},function(e,t,n){var i=function(e){"use strict";var t,n=Object.prototype,i=n.hasOwnProperty,r="function"===typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(A){c=function(e,t,n){return e[t]=n}}function u(e,t,n,i){var r=t&&t.prototype instanceof m?t:m,a=Object.create(r.prototype),s=new j(i||[]);return a._invoke=function(e,t,n){var i=h;return function(r,a){if(i===v)throw new Error("Generator is already running");if(i===p){if("throw"===r)throw a;return L()}for(n.method=r,n.arg=a;;){var s=n.delegate;if(s){var o=x(s,n);if(o){if(o===g)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var c=l(e,t,n);if("normal"===c.type){if(i=n.done?p:f,c.arg===g)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=p,n.method="throw",n.arg=c.arg)}}}(e,n,s),a}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(A){return{type:"throw",arg:A}}}e.wrap=u;var h="suspendedStart",f="suspendedYield",v="executing",p="completed",g={};function m(){}function d(){}function y(){}var b={};b[a]=function(){return this};var k=Object.getPrototypeOf,T=k&&k(k(I([])));T&&T!==n&&i.call(T,a)&&(b=T);var w=y.prototype=m.prototype=Object.create(b);function O(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(r,a,s,o){var c=l(e[r],e,a);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"===typeof h&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,s,o)}),(function(e){n("throw",e,s,o)})):t.resolve(h).then((function(e){u.value=e,s(u)}),(function(e){return n("throw",e,s,o)}))}o(c.arg)}var r;this._invoke=function(e,i){function a(){return new t((function(t,r){n(e,i,t,r)}))}return r=r?r.then(a,a):a()}}function x(e,n){var i=e.iterator[n.method];if(i===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,x(e,n),"throw"===n.method))return g;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var r=l(i,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,g;var a=r.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function I(e){if(e){var n=e[a];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var r=-1,s=function n(){for(;++r<e.length;)if(i.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}return{next:L}}function L(){return{value:t,done:!0}}return d.prototype=w.constructor=y,y.constructor=d,d.displayName=c(y,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,o,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},O(E.prototype),E.prototype[s]=function(){return this},e.AsyncIterator=E,e.async=function(t,n,i,r,a){void 0===a&&(a=Promise);var s=new E(u(t,n,i,r),a);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},O(w),c(w,o,"Generator"),w[a]=function(){return this},w.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=I,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(i,r){return o.type="throw",o.arg=e,n.next=i,r&&(n.method="next",n.arg=t),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var c=i.call(s,"catchLoc"),u=i.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;S(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:I(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=i}catch(r){Function("r","regeneratorRuntime = r")(i)}},function(e,t){var n,i,r=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"===typeof setTimeout?setTimeout:a}catch(e){n=a}try{i="function"===typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var c,u=[],l=!1,h=-1;function f(){l&&c&&(l=!1,c.length?u=c.concat(u):h=-1,u.length&&v())}function v(){if(!l){var e=o(f);l=!0;for(var t=u.length;t;){for(c=u,u=[];++h<t;)c&&c[h].run();h=-1,t=u.length}c=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||l||o(v)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){"use strict";n.r(t);var i=n(0),r=n(3),a=n(6);function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function o(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var c=n(4),u=n(5),l=n(11),h=n(10);function f(e){var t="function"===typeof Map?new Map:void 0;return(f=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return Object(a.a)(e,arguments,Object(l.a)(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object(h.a)(i,e)})(e)}var v;n(8),n(9);!function(e){e[e.Tag=0]="Tag"}(v||(v={}));var p,g=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var r;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a>1?a-1:0),o=1;o<a;o++)s[o-1]=arguments[o];return(r=t.call.apply(t,[this,e].concat(s)))._tag=v.Tag,r}return Object(r.a)(n,null,[{key:"fromArray",value:function(e){if(!(e.length<1)){var t=e.shift();if(void 0!==t){var i=new n(t);return e.forEach((function(e){i.push(e)})),i}}}}]),n}(f(Array));!function(e){e[e.LT=-1]="LT",e[e.EQ=0]="EQ",e[e.GT=1]="GT"}(p||(p={}));var m,d=function(){function e(t,n){Object(i.a)(this,e),this.line=t,this.character=n}return Object(r.a)(e,[{key:"compareTo",value:function(e){return this.line<e.line||this.line===e.line&&this.character<e.character?p.LT:this.line>e.line||this.line===e.line&&this.character>e.character?p.GT:p.EQ}}],[{key:"from",value:function(t){return t instanceof e?t:new e(t.line,t.character)}}]),e}(),y=function(){function e(t,n){Object(i.a)(this,e),this.start=t,this.end=n}return Object(r.a)(e,null,[{key:"merge",value:function(t,n){var i=d.from(t.start).compareTo(n.start),r=d.from(t.end).compareTo(n.end);return new e(i===p.LT?t.start:i===p.GT?n.start:t.start,r===p.LT?n.end:r===p.GT?t.end:n.end)}}]),e}(),b=function(){function e(t,n){Object(i.a)(this,e),this.uri=t,this.range=n}return Object(r.a)(e,null,[{key:"merge",value:function(t,n){if(t.uri!==n.uri)throw Error("Source location URI missmatch.");return new e(t.uri,y.merge(t.range,n.range))}}]),e}();function k(e){switch(e){case m.Begin:return m.Begin;case m.Activity:return m.Activity;case m.Finally:return m.Finally;case m.End:return m.End;case m.Constant:return m.Constant;case m.Variable:return m.Variable;case m.In:return m.In;case m.Out:return m.Out;case m.Is:return m.Is;case m.Type:return m.Type;case m.Any:return m.Any;case m.Finish:return m.Finish;case m.Component:return m.Component;case m.Interface:return m.Interface;case m.Procedure:return m.Procedure;case m.Implementation:return m.Implementation;case m.Offers:return m.Offers;case m.Requires:return m.Requires;case m.OpenBrace:return m.OpenBrace;case m.CloseBrace:return m.CloseBrace;case m.OpenSquareBracket:return m.OpenSquareBracket;case m.CloseSquareBracket:return m.CloseSquareBracket;case m.OpenParentheses:return m.OpenParentheses;case m.CloseParentheses:return m.CloseParentheses;case m.Semicolon:return m.Semicolon;case m.Colon:return m.Colon;case m.Comma:return m.Comma;case m.Asterisk:return m.Asterisk;case m.Pipe:return m.Pipe;case m.For:return m.For;case m.To:return m.To;case m.By:return m.By;case m.Do:return m.Do;case m.Foreach:return m.Foreach;case m.Of:return m.Of;case m.While:return m.While;case m.Repeat:return m.Repeat;case m.Until:return m.Until;case m.If:return m.If;case m.Then:return m.Then;case m.Elsif:return m.Elsif;case m.Else:return m.Else;case m.Return:return m.Return;case m.NumberSign:return m.NumberSign;case m.Equal:return m.Equal;case m.Less:return m.Less;case m.LessEqual:return m.LessEqual;case m.Greater:return m.Greater;case m.GreaterEqual:return m.GreaterEqual;case m.ColonEqual:return m.ColonEqual;case m.Ellipsis:return m.Ellipsis;case m.Plus:return m.Plus;case m.Minus:return m.Minus;case m.Tilde:return m.Tilde;case m.Slash:return m.Slash;case m.Div:return m.Div;case m.Mod:return m.Mod;case m.And:return m.And;case m.Or:return m.Or;case m.ExclamationMark:return m.ExclamationMark;case m.QuestionMark:return m.QuestionMark;default:return}}!function(e){e.EOT="EOT",e.Begin="BEGIN",e.Activity="ACTIVITY",e.Finally="FINALLY",e.End="END",e.Constant="CONSTANT",e.Variable="VARIABLE",e.In="IN",e.Out="OUT",e.Is="IS",e.Type="TYPE",e.Any="ANY",e.Finish="FINISH",e.Component="COMPONENT",e.Interface="INTERFACE",e.Procedure="PROCEDURE",e.Implementation="IMPLEMENTATION",e.Offers="OFFERS",e.Requires="REQUIRES",e.OpenBrace="{",e.CloseBrace="}",e.OpenSquareBracket="[",e.CloseSquareBracket="]",e.OpenParentheses="(",e.CloseParentheses=")",e.Semicolon=";",e.Colon=":",e.Comma=",",e.Asterisk="*",e.Pipe="|",e.For="FOR",e.To="TO",e.By="BY",e.Do="DO",e.Foreach="FOREACH",e.Of="OF",e.While="WHILE",e.Repeat="REPEAT",e.Until="UNTIL",e.If="IF",e.Then="THEN",e.Elsif="ELSIF",e.Else="ELSE",e.Return="RETURN",e.NumberSign="#",e.Equal="=",e.Less="<",e.LessEqual="<=",e.Greater=">",e.GreaterEqual=">=",e.ColonEqual=":=",e.Ellipsis="..",e.Plus="+",e.Minus="-",e.Tilde="~",e.Slash="/",e.Div="DIV",e.Mod="MOD",e.And="AND",e.Or="OR",e.ExclamationMark="!",e.QuestionMark="?"}(m||(m={}));var T,w=function(){function e(t){Object(i.a)(this,e),this.location=t}return Object(r.a)(e,[{key:"getLocation",value:function(){return this.location}}]),e}();!function(e){e[e.Tag=0]="Tag"}(T||(T={}));var O,E=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e))._errorTag=T.Tag,r}return n}(w),x=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).tag=r,a}return Object(r.a)(n,[{key:"getTag",value:function(){return this.tag}}]),n}(w),C=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).identifier=r,a}return Object(r.a)(n,[{key:"getIdentifier",value:function(){return this.identifier}}]),n}(w),S=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).value=r,a}return Object(r.a)(n,[{key:"getNumber",value:function(){return this.value}}]),n}(w);!function(e){e[e.Tag=0]="Tag"}(O||(O={}));var j,I=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._tag=O.Tag,e}return n}(S);!function(e){e[e.Tag=0]="Tag"}(j||(j={}));var L,A=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._tag=j.Tag,e}return n}(S);!function(e){e[e.Tag=0]="Tag"}(L||(L={}));var P,F,N,R,D,M,B,V,q,_,U,W,G,H,X,Q,z,Y,J,K,$,Z,ee,te,ne,ie,re=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e,r*Math.pow(10,a))).mantissa=r,s.exponent=a,s._tag=L.Tag,s}return Object(r.a)(n,[{key:"getMantissa",value:function(){return this.mantissa}},{key:"getExponent",value:function(){return this.exponent}}]),n}(S),ae=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).text=r,a}return Object(r.a)(n,[{key:"getText",value:function(){return this.text}}]),n}(w);!function(e){e.MIN_VALUE=-2147483648,e.MAX_VALUE=2147483647}(P||(P={})),function(e){e.MIN_VALUE=0,e.MAX_VALUE=2147483647}(F||(F={})),function(e){e.create=function(e,t){return e===Number.MAX_VALUE&&(e=F.MAX_VALUE),t===Number.MAX_VALUE&&(t=F.MAX_VALUE),{line:e,character:t}},e.is=function(e){var t=e;return Ve.objectLiteral(t)&&Ve.uinteger(t.line)&&Ve.uinteger(t.character)}}(N||(N={})),function(e){e.create=function(e,t,n,i){if(Ve.uinteger(e)&&Ve.uinteger(t)&&Ve.uinteger(n)&&Ve.uinteger(i))return{start:N.create(e,t),end:N.create(n,i)};if(N.is(e)&&N.is(t))return{start:e,end:t};throw new Error("Range#create called with invalid arguments["+e+", "+t+", "+n+", "+i+"]")},e.is=function(e){var t=e;return Ve.objectLiteral(t)&&N.is(t.start)&&N.is(t.end)}}(R||(R={})),function(e){e.create=function(e,t){return{uri:e,range:t}},e.is=function(e){var t=e;return Ve.defined(t)&&R.is(t.range)&&(Ve.string(t.uri)||Ve.undefined(t.uri))}}(D||(D={})),function(e){e.create=function(e,t,n,i){return{targetUri:e,targetRange:t,targetSelectionRange:n,originSelectionRange:i}},e.is=function(e){var t=e;return Ve.defined(t)&&R.is(t.targetRange)&&Ve.string(t.targetUri)&&(R.is(t.targetSelectionRange)||Ve.undefined(t.targetSelectionRange))&&(R.is(t.originSelectionRange)||Ve.undefined(t.originSelectionRange))}}(M||(M={})),function(e){e.create=function(e,t,n,i){return{red:e,green:t,blue:n,alpha:i}},e.is=function(e){var t=e;return Ve.numberRange(t.red,0,1)&&Ve.numberRange(t.green,0,1)&&Ve.numberRange(t.blue,0,1)&&Ve.numberRange(t.alpha,0,1)}}(B||(B={})),function(e){e.create=function(e,t){return{range:e,color:t}},e.is=function(e){var t=e;return R.is(t.range)&&B.is(t.color)}}(V||(V={})),function(e){e.create=function(e,t,n){return{label:e,textEdit:t,additionalTextEdits:n}},e.is=function(e){var t=e;return Ve.string(t.label)&&(Ve.undefined(t.textEdit)||Y.is(t))&&(Ve.undefined(t.additionalTextEdits)||Ve.typedArray(t.additionalTextEdits,Y.is))}}(q||(q={})),function(e){e.Comment="comment",e.Imports="imports",e.Region="region"}(_||(_={})),function(e){e.create=function(e,t,n,i,r){var a={startLine:e,endLine:t};return Ve.defined(n)&&(a.startCharacter=n),Ve.defined(i)&&(a.endCharacter=i),Ve.defined(r)&&(a.kind=r),a},e.is=function(e){var t=e;return Ve.uinteger(t.startLine)&&Ve.uinteger(t.startLine)&&(Ve.undefined(t.startCharacter)||Ve.uinteger(t.startCharacter))&&(Ve.undefined(t.endCharacter)||Ve.uinteger(t.endCharacter))&&(Ve.undefined(t.kind)||Ve.string(t.kind))}}(U||(U={})),function(e){e.create=function(e,t){return{location:e,message:t}},e.is=function(e){var t=e;return Ve.defined(t)&&D.is(t.location)&&Ve.string(t.message)}}(W||(W={})),function(e){e.Error=1,e.Warning=2,e.Information=3,e.Hint=4}(G||(G={})),function(e){e.Unnecessary=1,e.Deprecated=2}(H||(H={})),function(e){e.is=function(e){var t=e;return void 0!==t&&null!==t&&Ve.string(t.href)}}(X||(X={})),function(e){e.create=function(e,t,n,i,r,a){var s={range:e,message:t};return Ve.defined(n)&&(s.severity=n),Ve.defined(i)&&(s.code=i),Ve.defined(r)&&(s.source=r),Ve.defined(a)&&(s.relatedInformation=a),s},e.is=function(e){var t,n=e;return Ve.defined(n)&&R.is(n.range)&&Ve.string(n.message)&&(Ve.number(n.severity)||Ve.undefined(n.severity))&&(Ve.integer(n.code)||Ve.string(n.code)||Ve.undefined(n.code))&&(Ve.undefined(n.codeDescription)||Ve.string(null===(t=n.codeDescription)||void 0===t?void 0:t.href))&&(Ve.string(n.source)||Ve.undefined(n.source))&&(Ve.undefined(n.relatedInformation)||Ve.typedArray(n.relatedInformation,W.is))}}(Q||(Q={})),function(e){e.create=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var r={title:e,command:t};return Ve.defined(n)&&n.length>0&&(r.arguments=n),r},e.is=function(e){var t=e;return Ve.defined(t)&&Ve.string(t.title)&&Ve.string(t.command)}}(z||(z={})),function(e){e.replace=function(e,t){return{range:e,newText:t}},e.insert=function(e,t){return{range:{start:e,end:e},newText:t}},e.del=function(e){return{range:e,newText:""}},e.is=function(e){var t=e;return Ve.objectLiteral(t)&&Ve.string(t.newText)&&R.is(t.range)}}(Y||(Y={})),function(e){e.create=function(e,t,n){var i={label:e};return void 0!==t&&(i.needsConfirmation=t),void 0!==n&&(i.description=n),i},e.is=function(e){var t=e;return void 0!==t&&Ve.objectLiteral(t)&&Ve.string(t.label)&&(Ve.boolean(t.needsConfirmation)||void 0===t.needsConfirmation)&&(Ve.string(t.description)||void 0===t.description)}}(J||(J={})),function(e){e.is=function(e){return"string"===typeof e}}(K||(K={})),function(e){e.replace=function(e,t,n){return{range:e,newText:t,annotationId:n}},e.insert=function(e,t,n){return{range:{start:e,end:e},newText:t,annotationId:n}},e.del=function(e,t){return{range:e,newText:"",annotationId:t}},e.is=function(e){var t=e;return Y.is(t)&&(J.is(t.annotationId)||K.is(t.annotationId))}}($||($={})),function(e){e.create=function(e,t){return{textDocument:e,edits:t}},e.is=function(e){var t=e;return Ve.defined(t)&&ce.is(t.textDocument)&&Array.isArray(t.edits)}}(Z||(Z={})),function(e){e.create=function(e,t,n){var i={kind:"create",uri:e};return void 0===t||void 0===t.overwrite&&void 0===t.ignoreIfExists||(i.options=t),void 0!==n&&(i.annotationId=n),i},e.is=function(e){var t=e;return t&&"create"===t.kind&&Ve.string(t.uri)&&(void 0===t.options||(void 0===t.options.overwrite||Ve.boolean(t.options.overwrite))&&(void 0===t.options.ignoreIfExists||Ve.boolean(t.options.ignoreIfExists)))&&(void 0===t.annotationId||K.is(t.annotationId))}}(ee||(ee={})),function(e){e.create=function(e,t,n,i){var r={kind:"rename",oldUri:e,newUri:t};return void 0===n||void 0===n.overwrite&&void 0===n.ignoreIfExists||(r.options=n),void 0!==i&&(r.annotationId=i),r},e.is=function(e){var t=e;return t&&"rename"===t.kind&&Ve.string(t.oldUri)&&Ve.string(t.newUri)&&(void 0===t.options||(void 0===t.options.overwrite||Ve.boolean(t.options.overwrite))&&(void 0===t.options.ignoreIfExists||Ve.boolean(t.options.ignoreIfExists)))&&(void 0===t.annotationId||K.is(t.annotationId))}}(te||(te={})),function(e){e.create=function(e,t,n){var i={kind:"delete",uri:e};return void 0===t||void 0===t.recursive&&void 0===t.ignoreIfNotExists||(i.options=t),void 0!==n&&(i.annotationId=n),i},e.is=function(e){var t=e;return t&&"delete"===t.kind&&Ve.string(t.uri)&&(void 0===t.options||(void 0===t.options.recursive||Ve.boolean(t.options.recursive))&&(void 0===t.options.ignoreIfNotExists||Ve.boolean(t.options.ignoreIfNotExists)))&&(void 0===t.annotationId||K.is(t.annotationId))}}(ne||(ne={})),function(e){e.is=function(e){var t=e;return t&&(void 0!==t.changes||void 0!==t.documentChanges)&&(void 0===t.documentChanges||t.documentChanges.every((function(e){return Ve.string(e.kind)?ee.is(e)||te.is(e)||ne.is(e):Z.is(e)})))}}(ie||(ie={}));var se,oe,ce,ue,le,he,fe,ve,pe,ge,me,de,ye,be,ke,Te,we,Oe,Ee,xe,Ce,Se,je,Ie,Le,Ae,Pe,Fe,Ne,Re,De=function(){function e(e,t){this.edits=e,this.changeAnnotations=t}return e.prototype.insert=function(e,t,n){var i,r;if(void 0===n?i=Y.insert(e,t):K.is(n)?(r=n,i=$.insert(e,t,n)):(this.assertChangeAnnotations(this.changeAnnotations),r=this.changeAnnotations.manage(n),i=$.insert(e,t,r)),this.edits.push(i),void 0!==r)return r},e.prototype.replace=function(e,t,n){var i,r;if(void 0===n?i=Y.replace(e,t):K.is(n)?(r=n,i=$.replace(e,t,n)):(this.assertChangeAnnotations(this.changeAnnotations),r=this.changeAnnotations.manage(n),i=$.replace(e,t,r)),this.edits.push(i),void 0!==r)return r},e.prototype.delete=function(e,t){var n,i;if(void 0===t?n=Y.del(e):K.is(t)?(i=t,n=$.del(e,t)):(this.assertChangeAnnotations(this.changeAnnotations),i=this.changeAnnotations.manage(t),n=$.del(e,i)),this.edits.push(n),void 0!==i)return i},e.prototype.add=function(e){this.edits.push(e)},e.prototype.all=function(){return this.edits},e.prototype.clear=function(){this.edits.splice(0,this.edits.length)},e.prototype.assertChangeAnnotations=function(e){if(void 0===e)throw new Error("Text edit change is not configured to manage change annotations.")},e}(),Me=function(){function e(e){this._annotations=void 0===e?Object.create(null):e,this._counter=0,this._size=0}return e.prototype.all=function(){return this._annotations},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),e.prototype.manage=function(e,t){var n;if(K.is(e)?n=e:(n=this.nextId(),t=e),void 0!==this._annotations[n])throw new Error("Id "+n+" is already in use.");if(void 0===t)throw new Error("No annotation provided for id "+n);return this._annotations[n]=t,this._size++,n},e.prototype.nextId=function(){return this._counter++,this._counter.toString()},e}();!function(){function e(e){var t=this;this._textEditChanges=Object.create(null),void 0!==e?(this._workspaceEdit=e,e.documentChanges?(this._changeAnnotations=new Me(e.changeAnnotations),e.changeAnnotations=this._changeAnnotations.all(),e.documentChanges.forEach((function(e){if(Z.is(e)){var n=new De(e.edits,t._changeAnnotations);t._textEditChanges[e.textDocument.uri]=n}}))):e.changes&&Object.keys(e.changes).forEach((function(n){var i=new De(e.changes[n]);t._textEditChanges[n]=i}))):this._workspaceEdit={}}Object.defineProperty(e.prototype,"edit",{get:function(){return this.initDocumentChanges(),void 0!==this._changeAnnotations&&(0===this._changeAnnotations.size?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),e.prototype.getTextEditChange=function(e){if(ce.is(e)){if(this.initDocumentChanges(),void 0===this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for document changes.");var t={uri:e.uri,version:e.version};if(!(i=this._textEditChanges[t.uri])){var n={textDocument:t,edits:r=[]};this._workspaceEdit.documentChanges.push(n),i=new De(r,this._changeAnnotations),this._textEditChanges[t.uri]=i}return i}if(this.initChanges(),void 0===this._workspaceEdit.changes)throw new Error("Workspace edit is not configured for normal text edit changes.");var i;if(!(i=this._textEditChanges[e])){var r=[];this._workspaceEdit.changes[e]=r,i=new De(r),this._textEditChanges[e]=i}return i},e.prototype.initDocumentChanges=function(){void 0===this._workspaceEdit.documentChanges&&void 0===this._workspaceEdit.changes&&(this._changeAnnotations=new Me,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},e.prototype.initChanges=function(){void 0===this._workspaceEdit.documentChanges&&void 0===this._workspaceEdit.changes&&(this._workspaceEdit.changes=Object.create(null))},e.prototype.createFile=function(e,t,n){if(this.initDocumentChanges(),void 0===this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for document changes.");var i,r,a;if(J.is(t)||K.is(t)?i=t:n=t,void 0===i?r=ee.create(e,n):(a=K.is(i)?i:this._changeAnnotations.manage(i),r=ee.create(e,n,a)),this._workspaceEdit.documentChanges.push(r),void 0!==a)return a},e.prototype.renameFile=function(e,t,n,i){if(this.initDocumentChanges(),void 0===this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for document changes.");var r,a,s;if(J.is(n)||K.is(n)?r=n:i=n,void 0===r?a=te.create(e,t,i):(s=K.is(r)?r:this._changeAnnotations.manage(r),a=te.create(e,t,i,s)),this._workspaceEdit.documentChanges.push(a),void 0!==s)return s},e.prototype.deleteFile=function(e,t,n){if(this.initDocumentChanges(),void 0===this._workspaceEdit.documentChanges)throw new Error("Workspace edit is not configured for document changes.");var i,r,a;if(J.is(t)||K.is(t)?i=t:n=t,void 0===i?r=ne.create(e,n):(a=K.is(i)?i:this._changeAnnotations.manage(i),r=ne.create(e,n,a)),this._workspaceEdit.documentChanges.push(r),void 0!==a)return a}}();!function(e){e.create=function(e){return{uri:e}},e.is=function(e){var t=e;return Ve.defined(t)&&Ve.string(t.uri)}}(se||(se={})),function(e){e.create=function(e,t){return{uri:e,version:t}},e.is=function(e){var t=e;return Ve.defined(t)&&Ve.string(t.uri)&&Ve.integer(t.version)}}(oe||(oe={})),function(e){e.create=function(e,t){return{uri:e,version:t}},e.is=function(e){var t=e;return Ve.defined(t)&&Ve.string(t.uri)&&(null===t.version||Ve.integer(t.version))}}(ce||(ce={})),function(e){e.create=function(e,t,n,i){return{uri:e,languageId:t,version:n,text:i}},e.is=function(e){var t=e;return Ve.defined(t)&&Ve.string(t.uri)&&Ve.string(t.languageId)&&Ve.integer(t.version)&&Ve.string(t.text)}}(ue||(ue={})),function(e){e.PlainText="plaintext",e.Markdown="markdown"}(le||(le={})),function(e){e.is=function(t){var n=t;return n===e.PlainText||n===e.Markdown}}(le||(le={})),function(e){e.is=function(e){var t=e;return Ve.objectLiteral(e)&&le.is(t.kind)&&Ve.string(t.value)}}(he||(he={})),function(e){e.Text=1,e.Method=2,e.Function=3,e.Constructor=4,e.Field=5,e.Variable=6,e.Class=7,e.Interface=8,e.Module=9,e.Property=10,e.Unit=11,e.Value=12,e.Enum=13,e.Keyword=14,e.Snippet=15,e.Color=16,e.File=17,e.Reference=18,e.Folder=19,e.EnumMember=20,e.Constant=21,e.Struct=22,e.Event=23,e.Operator=24,e.TypeParameter=25}(fe||(fe={})),function(e){e.PlainText=1,e.Snippet=2}(ve||(ve={})),function(e){e.Deprecated=1}(pe||(pe={})),function(e){e.create=function(e,t,n){return{newText:e,insert:t,replace:n}},e.is=function(e){var t=e;return t&&Ve.string(t.newText)&&R.is(t.insert)&&R.is(t.replace)}}(ge||(ge={})),function(e){e.asIs=1,e.adjustIndentation=2}(me||(me={})),function(e){e.create=function(e){return{label:e}}}(de||(de={})),function(e){e.create=function(e,t){return{items:e||[],isIncomplete:!!t}}}(ye||(ye={})),function(e){e.fromPlainText=function(e){return e.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")},e.is=function(e){var t=e;return Ve.string(t)||Ve.objectLiteral(t)&&Ve.string(t.language)&&Ve.string(t.value)}}(be||(be={})),function(e){e.is=function(e){var t=e;return!!t&&Ve.objectLiteral(t)&&(he.is(t.contents)||be.is(t.contents)||Ve.typedArray(t.contents,be.is))&&(void 0===e.range||R.is(e.range))}}(ke||(ke={})),function(e){e.create=function(e,t){return t?{label:e,documentation:t}:{label:e}}}(Te||(Te={})),function(e){e.create=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var r={label:e};return Ve.defined(t)&&(r.documentation=t),Ve.defined(n)?r.parameters=n:r.parameters=[],r}}(we||(we={})),function(e){e.Text=1,e.Read=2,e.Write=3}(Oe||(Oe={})),function(e){e.create=function(e,t){var n={range:e};return Ve.number(t)&&(n.kind=t),n}}(Ee||(Ee={})),function(e){e.File=1,e.Module=2,e.Namespace=3,e.Package=4,e.Class=5,e.Method=6,e.Property=7,e.Field=8,e.Constructor=9,e.Enum=10,e.Interface=11,e.Function=12,e.Variable=13,e.Constant=14,e.String=15,e.Number=16,e.Boolean=17,e.Array=18,e.Object=19,e.Key=20,e.Null=21,e.EnumMember=22,e.Struct=23,e.Event=24,e.Operator=25,e.TypeParameter=26}(xe||(xe={})),function(e){e.Deprecated=1}(Ce||(Ce={})),function(e){e.create=function(e,t,n,i,r){var a={name:e,kind:t,location:{uri:i,range:n}};return r&&(a.containerName=r),a}}(Se||(Se={})),function(e){e.create=function(e,t,n,i,r,a){var s={name:e,detail:t,kind:n,range:i,selectionRange:r};return void 0!==a&&(s.children=a),s},e.is=function(e){var t=e;return t&&Ve.string(t.name)&&Ve.number(t.kind)&&R.is(t.range)&&R.is(t.selectionRange)&&(void 0===t.detail||Ve.string(t.detail))&&(void 0===t.deprecated||Ve.boolean(t.deprecated))&&(void 0===t.children||Array.isArray(t.children))&&(void 0===t.tags||Array.isArray(t.tags))}}(je||(je={})),function(e){e.Empty="",e.QuickFix="quickfix",e.Refactor="refactor",e.RefactorExtract="refactor.extract",e.RefactorInline="refactor.inline",e.RefactorRewrite="refactor.rewrite",e.Source="source",e.SourceOrganizeImports="source.organizeImports",e.SourceFixAll="source.fixAll"}(Ie||(Ie={})),function(e){e.create=function(e,t){var n={diagnostics:e};return void 0!==t&&null!==t&&(n.only=t),n},e.is=function(e){var t=e;return Ve.defined(t)&&Ve.typedArray(t.diagnostics,Q.is)&&(void 0===t.only||Ve.typedArray(t.only,Ve.string))}}(Le||(Le={})),function(e){e.create=function(e,t,n){var i={title:e},r=!0;return"string"===typeof t?(r=!1,i.kind=t):z.is(t)?i.command=t:i.edit=t,r&&void 0!==n&&(i.kind=n),i},e.is=function(e){var t=e;return t&&Ve.string(t.title)&&(void 0===t.diagnostics||Ve.typedArray(t.diagnostics,Q.is))&&(void 0===t.kind||Ve.string(t.kind))&&(void 0!==t.edit||void 0!==t.command)&&(void 0===t.command||z.is(t.command))&&(void 0===t.isPreferred||Ve.boolean(t.isPreferred))&&(void 0===t.edit||ie.is(t.edit))}}(Ae||(Ae={})),function(e){e.create=function(e,t){var n={range:e};return Ve.defined(t)&&(n.data=t),n},e.is=function(e){var t=e;return Ve.defined(t)&&R.is(t.range)&&(Ve.undefined(t.command)||z.is(t.command))}}(Pe||(Pe={})),function(e){e.create=function(e,t){return{tabSize:e,insertSpaces:t}},e.is=function(e){var t=e;return Ve.defined(t)&&Ve.uinteger(t.tabSize)&&Ve.boolean(t.insertSpaces)}}(Fe||(Fe={})),function(e){e.create=function(e,t,n){return{range:e,target:t,data:n}},e.is=function(e){var t=e;return Ve.defined(t)&&R.is(t.range)&&(Ve.undefined(t.target)||Ve.string(t.target))}}(Ne||(Ne={})),function(e){e.create=function(e,t){return{range:e,parent:t}},e.is=function(t){var n=t;return void 0!==n&&R.is(n.range)&&(void 0===n.parent||e.is(n.parent))}}(Re||(Re={}));var Be;!function(e){function t(e,n){if(e.length<=1)return e;var i=e.length/2|0,r=e.slice(0,i),a=e.slice(i);t(r,n),t(a,n);for(var s=0,o=0,c=0;s<r.length&&o<a.length;){var u=n(r[s],a[o]);e[c++]=u<=0?r[s++]:a[o++]}for(;s<r.length;)e[c++]=r[s++];for(;o<a.length;)e[c++]=a[o++];return e}e.create=function(e,t,n,i){return new qe(e,t,n,i)},e.is=function(e){var t=e;return!!(Ve.defined(t)&&Ve.string(t.uri)&&(Ve.undefined(t.languageId)||Ve.string(t.languageId))&&Ve.uinteger(t.lineCount)&&Ve.func(t.getText)&&Ve.func(t.positionAt)&&Ve.func(t.offsetAt))},e.applyEdits=function(e,n){for(var i=e.getText(),r=t(n,(function(e,t){var n=e.range.start.line-t.range.start.line;return 0===n?e.range.start.character-t.range.start.character:n})),a=i.length,s=r.length-1;s>=0;s--){var o=r[s],c=e.offsetAt(o.range.start),u=e.offsetAt(o.range.end);if(!(u<=a))throw new Error("Overlapping edit");i=i.substring(0,c)+o.newText+i.substring(u,i.length),a=c}return i}}(Be||(Be={}));var Ve,qe=function(){function e(e,t,n,i){this._uri=e,this._languageId=t,this._version=n,this._content=i,this._lineOffsets=void 0}return Object.defineProperty(e.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),e.prototype.getText=function(e){if(e){var t=this.offsetAt(e.start),n=this.offsetAt(e.end);return this._content.substring(t,n)}return this._content},e.prototype.update=function(e,t){this._content=e.text,this._version=t,this._lineOffsets=void 0},e.prototype.getLineOffsets=function(){if(void 0===this._lineOffsets){for(var e=[],t=this._content,n=!0,i=0;i<t.length;i++){n&&(e.push(i),n=!1);var r=t.charAt(i);n="\r"===r||"\n"===r,"\r"===r&&i+1<t.length&&"\n"===t.charAt(i+1)&&i++}n&&t.length>0&&e.push(t.length),this._lineOffsets=e}return this._lineOffsets},e.prototype.positionAt=function(e){e=Math.max(Math.min(e,this._content.length),0);var t=this.getLineOffsets(),n=0,i=t.length;if(0===i)return N.create(0,e);for(;n<i;){var r=Math.floor((n+i)/2);t[r]>e?i=r:n=r+1}var a=n-1;return N.create(a,e-t[a])},e.prototype.offsetAt=function(e){var t=this.getLineOffsets();if(e.line>=t.length)return this._content.length;if(e.line<0)return 0;var n=t[e.line],i=e.line+1<t.length?t[e.line+1]:this._content.length;return Math.max(Math.min(n+e.character,i),n)},Object.defineProperty(e.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),e}();!function(e){var t=Object.prototype.toString;e.defined=function(e){return"undefined"!==typeof e},e.undefined=function(e){return"undefined"===typeof e},e.boolean=function(e){return!0===e||!1===e},e.string=function(e){return"[object String]"===t.call(e)},e.number=function(e){return"[object Number]"===t.call(e)},e.numberRange=function(e,n,i){return"[object Number]"===t.call(e)&&n<=e&&e<=i},e.integer=function(e){return"[object Number]"===t.call(e)&&-2147483648<=e&&e<=2147483647},e.uinteger=function(e){return"[object Number]"===t.call(e)&&0<=e&&e<=2147483647},e.func=function(e){return"[object Function]"===t.call(e)},e.objectLiteral=function(e){return null!==e&&"object"===typeof e},e.typedArray=function(e,t){return Array.isArray(e)&&e.every(t)}}(Ve||(Ve={}));var _e,Ue=function e(t,n,r,a,s,o,c){Object(i.a)(this,e),this.range=t,this.severity=n,this.message=r,this.code=a,this.source=s,this.tags=o,this.relatedInformation=c},We=function(){function e(){Object(i.a)(this,e),this.diagnostics=new Array,this.warning=!1,this.error=!1}return Object(r.a)(e,[{key:"copy",value:function(){var t=new e;return t.diagnostics=Object(a.a)(Array,o(this.diagnostics)),t.warning=this.warning,t.error=this.error,t}}]),e}(),Ge=function(){function e(){Object(i.a)(this,e),this.state=new We,this.stateStack=new Array}return Object(r.a)(e,[{key:"log",value:function(e){this.state.diagnostics.push(e),e.severity===G.Warning&&(this.state.warning=!0),e.severity===G.Error&&(this.state.error=!0)}},{key:"saveState",value:function(){this.stateStack.push(this.state.copy())}},{key:"restoreState",value:function(){var e=this.stateStack.pop();void 0!==e?this.state=e:console.warn("Failed to restore diagnosis state, no state saved.")}},{key:"hasErrors",value:function(){return this.state.error}},{key:"hasWarnings",value:function(){return this.state.warning}},{key:"getDiagnostics",value:function(){return this.state.diagnostics}},{key:"print",value:function(e){var t=this;this.state.diagnostics.forEach((function(n){e("[".concat(n.range.start.line,":").concat(n.range.start.character,"]: ").concat(t.toString(n.severity),": ").concat(n.message,"."))}))}},{key:"toString",value:function(e){switch(e){case G.Error:return"Error";case G.Warning:return"Warning";case G.Information:return"Information";case G.Hint:return"Hint";default:return"undefined"}}}]),e}();!function(e){e.Null="\0",e.Backspace="\b",e.Space=" ",e.HorizontalTab="\t",e.VerticalTab="\v",e.FormFeed="\f",e.CarriageReturn="\r",e.LineFeed="\n",e.Backslash="\\",e.SingleQuote="'",e.DoubleQuote='"'}(_e||(_e={}));var He,Xe=function(){function e(){Object(i.a)(this,e),this.tokenCache=new Array,this.currentPosition=0,this.currentLinePosition=0,this.currentLine=0}return Object(r.a)(e,[{key:"copy",value:function(){var t=new e;return t.tokenCache=Object(a.a)(Array,o(this.tokenCache)),t.currentPosition=this.currentPosition,t.currentLinePosition=this.currentLinePosition,t.currentLine=this.currentLine,t}}]),e}(),Qe=function(){function e(t,n,r){Object(i.a)(this,e),this.diagnosis=t,this.uri=n,this.code=Array.from(r),this.state=new Xe,this.stateStack=new Array}return Object(r.a)(e,[{key:"advance",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;e>0&&!this.isEOT();)this.isLineFeed()?(this.state.currentLine=this.state.currentLine+1,this.state.currentLinePosition=0):this.state.currentLinePosition=this.state.currentLinePosition+1,this.state.currentPosition=this.state.currentPosition+1,e-=1}},{key:"getCurrentCharacter",value:function(){return this.isEOT()?void 0:this.code[this.state.currentPosition]}},{key:"createSourceLocation",value:function(e){return new b(this.uri,e)}},{key:"createSourcePosition",value:function(){return new d(this.state.currentLine,this.state.currentLinePosition)}},{key:"createEOTToken",value:function(){var e=this.createSourcePosition();return new x(this.createSourceLocation(new y(e,e)),m.EOT)}},{key:"isSpace",value:function(){return this.getCurrentCharacter()===_e.Space}},{key:"isTab",value:function(){var e=this.getCurrentCharacter();return e===_e.HorizontalTab||e===_e.VerticalTab}},{key:"isFormFeed",value:function(){return this.getCurrentCharacter()===_e.FormFeed}},{key:"isLineFeed",value:function(){return this.getCurrentCharacter()===_e.LineFeed}},{key:"isCarriageReturn",value:function(){return this.getCurrentCharacter()===_e.CarriageReturn}},{key:"isBackslash",value:function(){return this.getCurrentCharacter()===_e.Backslash}},{key:"isLetter",value:function(){var e=this.getCurrentCharacter();return void 0!==e&&(e>="a"&&e<="z"||e>="A"&&e<="Z")}},{key:"isDot",value:function(){var e=this.getCurrentCharacter();return void 0!==e&&"."===e}},{key:"isEllipsis",value:function(){return this.isDot()&&this.state.currentPosition+1<this.code.length&&"."===this.code[this.state.currentPosition+1]}},{key:"isNumber",value:function(){var e=this.getCurrentCharacter();return void 0!==e&&e>="0"&&e<="9"}},{key:"isHexCharacter",value:function(){var e=this.getCurrentCharacter();return void 0!==e&&(e>="a"&&e<="f"||e>="A"&&e<="F")}},{key:"isDoubleQuote",value:function(){return this.getCurrentCharacter()===_e.DoubleQuote}},{key:"isWhitespace",value:function(){return this.isSpace()||this.isTab()||this.isLineFeed()||this.isCarriageReturn()||this.isFormFeed()}},{key:"isEOT",value:function(){return this.state.currentPosition>=this.code.length}},{key:"isCommentStart",value:function(){var e=this.getCurrentCharacter();return void 0!==e&&k(e)===m.OpenParentheses&&this.state.currentPosition+1<this.code.length&&k(this.code[this.state.currentPosition+1])===m.Asterisk}},{key:"isCommentEnd",value:function(){var e=this.getCurrentCharacter();return void 0!==e&&k(e)===m.Asterisk&&this.state.currentPosition+1<this.code.length&&k(this.code[this.state.currentPosition+1])===m.CloseParentheses}},{key:"skipWhitespace",value:function(){for(var e=!1;this.isWhitespace();)e=!0,this.advance();return e}},{key:"skipComment",value:function(){var e=!1;if(this.isCommentStart()){for(e=!0,this.advance(2);!this.isEOT()&&!this.isCommentEnd();)this.advance();this.isEOT()||this.advance(2)}return e}},{key:"skipUntilWhitespace",value:function(){for(;!this.isWhitespace()&&!this.isEOT();)this.advance()}},{key:"readCharacter",value:function(){var e=this.getCurrentCharacter();if(this.isBackslash()){this.advance();var t=function(e){switch(e){case"0":return _e.Null;case"b":return _e.Backspace;case"t":return _e.HorizontalTab;case"v":return _e.VerticalTab;case"f":return _e.FormFeed;case"r":return _e.CarriageReturn;case"n":return _e.LineFeed;case"\\":return _e.Backslash;case"'":return _e.SingleQuote;case'"':return _e.DoubleQuote;default:return}}(this.getCurrentCharacter());if(void 0!==t)return this.advance(),t}return this.advance(),e}},{key:"readText",value:function(){var e="",t=this.createSourcePosition();for(this.advance();!this.isDoubleQuote();){var n=this.readCharacter();if(void 0===n)return new E(this.createSourceLocation(new y(t,this.createSourcePosition())));e+=n}if(this.isDoubleQuote()){this.advance();var i=this.createSourcePosition();return new ae(this.createSourceLocation(new y(t,i)),e)}return new E(this.createSourceLocation(new y(t,this.createSourcePosition())))}},{key:"readIdentifier",value:function(){for(var e="",t=this.createSourcePosition();!this.isEOT()&&(this.isLetter()||this.isNumber());)e+=this.getCurrentCharacter(),this.advance();var n=this.createSourceLocation(new y(t,this.createSourcePosition())),i=k(e);return void 0!==i?new x(n,i):new C(n,e)}},{key:"readFixToken",value:function(){var e=this.createSourcePosition(),t=this.getCurrentCharacter();if(void 0!==t){var n=k(t);if(this.advance(),void 0!==n){var i=this.getCurrentCharacter();if(void 0!==i)if(k(i)===m.Equal)switch(n){case m.Less:return this.advance(),new x(this.createSourceLocation(new y(e,this.createSourcePosition())),m.LessEqual);case m.Greater:return this.advance(),new x(this.createSourceLocation(new y(e,this.createSourcePosition())),m.GreaterEqual);case m.Colon:return this.advance(),new x(this.createSourceLocation(new y(e,this.createSourcePosition())),m.ColonEqual)}return new x(this.createSourceLocation(new y(e,this.createSourcePosition())),n)}}return new E(this.createSourceLocation(new y(e,this.createSourcePosition())))}},{key:"readScaleFactor",value:function(){var e=0;for(this.isNumber()||this.diagnosis.log(new Ue(new y(this.createSourcePosition(),this.createSourcePosition()),G.Error,"Scale factor must be at least one digit long."));this.isNumber();){var t=this.getCurrentCharacter();void 0!==t&&(e=10*e+Number.parseInt(t),this.advance())}return e}},{key:"readNumber",value:function(){for(var e=this.createSourcePosition(),t=void 0,n=!1,i=!1,r=0;this.isNumber()||this.isHexCharacter();){if(this.isHexCharacter()&&(n=!0),t=void 0===t?this.getCurrentCharacter():t+this.getCurrentCharacter(),this.advance(),i&&n){this.skipUntilWhitespace(),this.diagnosis.log(new Ue(new y(e,this.createSourcePosition()),G.Error,"Floating point hex numbers are not supported."));break}if(i&&(r-=1),this.isEllipsis())break;if(this.isDot()&&(this.advance(),i=!0),i&&"E"===this.getCurrentCharacter()){this.advance();var a=this.getCurrentCharacter(),s=1;"-"!==a&&"+"!==a||(s="-"===a?-1:1,this.advance()),r=s*this.readScaleFactor();break}}if(void 0===t)return new A(this.createSourceLocation(new y(e,this.createSourcePosition())),0);var o="H"===this.getCurrentCharacter()||"X"===this.getCurrentCharacter();return o&&this.advance(),n&&!o&&(this.skipUntilWhitespace(),this.diagnosis.log(new Ue(new y(e,this.createSourcePosition()),G.Error,'Missing "H" or "X" after hex number'))),n||o?new I(this.createSourceLocation(new y(e,this.createSourcePosition())),Number.parseInt("0x"+t)):i?new re(this.createSourceLocation(new y(e,this.createSourcePosition())),Number.parseInt(t),r):new A(this.createSourceLocation(new y(e,this.createSourcePosition())),Number.parseInt(t))}},{key:"readEllipsis",value:function(){var e=this.createSourcePosition();return this.advance(),this.advance(),new x(this.createSourceLocation(new y(e,this.createSourcePosition())),m.Ellipsis)}},{key:"read",value:function(){for(;!this.isEOT()&&(this.skipWhitespace()||this.skipComment()););return this.isEOT()?this.createEOTToken():this.isDoubleQuote()?this.readText():this.isLetter()?this.readIdentifier():this.isNumber()?this.readNumber():this.isEllipsis()?this.readEllipsis():this.readFixToken()}},{key:"getUri",value:function(){return this.uri}},{key:"saveState",value:function(){this.stateStack.push(this.state.copy())}},{key:"popSaveState",value:function(){this.stateStack.pop()}},{key:"restoreState",value:function(){var e=this.stateStack.pop();void 0!==e?this.state=e:console.warn("No lexer state to restore.")}},{key:"peek",value:function(e){if(e<1)throw RangeError("peek range must be greater than 0.");var t=this.state.tokenCache.length;if(e<=t)return this.state.tokenCache[e-1];do{if(t>0){var n=this.state.tokenCache[t-1];if(n instanceof x&&n.getTag()===m.EOT)return n}t=this.state.tokenCache.push(this.read())}while(e>t);return this.state.tokenCache[e-1]}},{key:"next",value:function(){var e=this.peek(1);return this.state.tokenCache.shift(),e}}]),e}(),ze=function(){function e(t){Object(i.a)(this,e),this.location=t}return Object(r.a)(e,[{key:"getLocation",value:function(){return this.location}}]),e}(),Ye=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).name=r,a}return Object(r.a)(n,[{key:"getName",value:function(){return this.name}},{key:"accept",value:function(e){e.visitAttribute(this)}}]),n}(ze),Je=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).min=r,s.max=a,s}return Object(r.a)(n,[{key:"getMin",value:function(){return this.min}},{key:"getMax",value:function(){return this.max}},{key:"accept",value:function(e){e.visitCardinality(this)}}]),n}(ze);!function(e){e[e.Tag=0]="Tag"}(He||(He={}));var Ke,$e=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._tag=He.Tag,e}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitDeclaration(this)}}]),n}(ze),Ze=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s,o,c){var u;return Object(i.a)(this,n),(u=t.call(this,e)).name=r,u.attributes=a,u.offers=s,u.requires=o,u.body=c,u}return Object(r.a)(n,[{key:"getName",value:function(){return this.name}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getOffers",value:function(){return this.offers}},{key:"getRequires",value:function(){return this.requires}},{key:"getBody",value:function(){return this.body}},{key:"accept",value:function(e){e.visitComponent(this)}}]),n}($e),et=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s,o,c){var u;return Object(i.a)(this,n),(u=t.call(this,e)).declarations=r,u.implementations=a,u.beginBlock=s,u.activityBlock=o,u.finallyBlock=c,u}return Object(r.a)(n,[{key:"getDeclarations",value:function(){return this.declarations}},{key:"getImplementations",value:function(){return this.implementations}},{key:"getBeginBlock",value:function(){return this.beginBlock}},{key:"getActivityBlock",value:function(){return this.activityBlock}},{key:"getFinallyBlock",value:function(){return this.finallyBlock}},{key:"accept",value:function(e){e.visitComponentBody(this)}}]),n}(ze),tt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).name=r,s.expression=a,s}return Object(r.a)(n,[{key:"getName",value:function(){return this.name}},{key:"getExpression",value:function(){return this.expression}},{key:"accept",value:function(e){e.visitConstant(this)}}]),n}(ze),nt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).expression=r,a}return Object(r.a)(n,[{key:"getExpression",value:function(){return this.expression}},{key:"accept",value:function(e){e.visitConstantExpression(this)}}]),n}(ze),it=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).constants=r,a}return Object(r.a)(n,[{key:"getConstants",value:function(){return this.constants}},{key:"accept",value:function(e){e.visitConstantList(this)}}]),n}($e);!function(e){e[e.Tag=0]="Tag"}(Ke||(Ke={}));var rt,at=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._expressionTag=Ke.Tag,e}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitExpression(this)}}]),n}(ze);!function(e){e[e.Tag=0]="Tag"}(rt||(rt={}));var st,ot=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).attributes=r,a._attributedExpressionTag=rt.Tag,a}return Object(r.a)(n,[{key:"getAttributes",value:function(){return this.attributes}},{key:"accept",value:function(e){e.visitAttributedExpression(this)}}]),n}(at),ct=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e,r)).expression=a,s}return Object(r.a)(n,[{key:"getExpression",value:function(){return this.expression}},{key:"accept",value:function(e){e.visitUnaryExpression(this)}}]),n}(ot);!function(e){e[e.Equal=0]="Equal",e[e.NotEqual=1]="NotEqual",e[e.Less=2]="Less",e[e.LessEqual=3]="LessEqual",e[e.More=4]="More",e[e.MoreEqual=5]="MoreEqual"}(st||(st={}));var ut,lt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s,o){var c;return Object(i.a)(this,n),(c=t.call(this,e,r)).left=a,c.op=s,c.right=o,c}return Object(r.a)(n,[{key:"getLeft",value:function(){return this.left}},{key:"getOp",value:function(){return this.op}},{key:"getRight",value:function(){return this.right}},{key:"accept",value:function(e){e.visitBinaryExpression(this)}}]),n}(ot);!function(e){e[e.Offers=0]="Offers",e[e.Requires=1]="Requires"}(ut||(ut={}));var ht,ft=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s){var o;return Object(i.a)(this,n),(o=t.call(this,e,r)).op=a,o.interfaces=s,o}return Object(r.a)(n,[{key:"getOp",value:function(){return this.op}},{key:"getInterfaces",value:function(){return this.interfaces}},{key:"accept",value:function(e){e.visitOffersRequiresExpression(this)}}]),n}(ot),vt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s){var o;return Object(i.a)(this,n),(o=t.call(this,e,r)).designator=a,o.type=s,o}return Object(r.a)(n,[{key:"getDesignator",value:function(){return this.designator}},{key:"getType",value:function(){return this.type}},{key:"accept",value:function(e){e.visitTypeCheck(this)}}]),n}(ot);!function(e){e[e.Tag=0]="Tag"}(ht||(ht={}));var pt,gt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e))._simpleExpressionTag=ht.Tag,r}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitSimpleExpression(this)}}]),n}(at);!function(e){e[e.Plus=0]="Plus",e[e.Minus=1]="Minus"}(pt||(pt={}));var mt,dt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).op=r,s.term=a,s}return Object(r.a)(n,[{key:"getOp",value:function(){return this.op}},{key:"getTerm",value:function(){return this.term}},{key:"accept",value:function(e){e.visitUnaryTermNode(this)}}]),n}(gt);!function(e){e[e.Plus=0]="Plus",e[e.Minus=1]="Minus",e[e.Or=2]="Or"}(mt||(mt={}));var yt,bt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).left=r,s.right=a,s}return Object(r.a)(n,[{key:"getLeft",value:function(){return this.left}},{key:"getRight",value:function(){return this.right}},{key:"accept",value:function(e){e.visitTermChain(this)}}]),n}(gt),kt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).op=r,s.right=a,s}return Object(r.a)(n,[{key:"getOp",value:function(){return this.op}},{key:"getRight",value:function(){return this.right}},{key:"accept",value:function(e){e.visitRightTerm(this)}}]),n}(ze);!function(e){e[e.Tag=0]="Tag"}(yt||(yt={}));var Tt,wt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e))._termTag=yt.Tag,r}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitTerm(this)}}]),n}(gt),Ot=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).left=r,s.right=a,s}return Object(r.a)(n,[{key:"getLeft",value:function(){return this.left}},{key:"getRight",value:function(){return this.right}},{key:"accept",value:function(e){e.visitFactorChain(this)}}]),n}(wt);!function(e){e[e.Times=0]="Times",e[e.Div=1]="Div",e[e.DivText=2]="DivText",e[e.ModText=3]="ModText",e[e.AndText=4]="AndText"}(Tt||(Tt={}));var Et,xt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).op=r,s.right=a,s}return Object(r.a)(n,[{key:"getOp",value:function(){return this.op}},{key:"getRight",value:function(){return this.right}},{key:"accept",value:function(e){e.visitRightFactor(this)}}]),n}(ze);!function(e){e[e.Tag=0]="Tag"}(Et||(Et={}));var Ct,St=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e))._factorTag=Et.Tag,r}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitFactor(this)}}]),n}(wt);!function(e){e[e.Not=0]="Not"}(Ct||(Ct={}));var jt,It=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).prefix=r,s.factor=a,s}return Object(r.a)(n,[{key:"getPrefix",value:function(){return this.prefix}},{key:"getFactor",value:function(){return this.factor}},{key:"accept",value:function(e){e.visitUnaryFactor(this)}}]),n}(St),Lt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).expresion=r,a}return Object(r.a)(n,[{key:"getExpression",value:function(){return this.expresion}},{key:"accept",value:function(e){e.visitExpressionFactor(this)}}]),n}(St),At=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){return Object(i.a)(this,n),t.call(this,e)}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitOperand(this)}}]),n}(St),Pt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).value=r,a}return Object(r.a)(n,[{key:"getValue",value:function(){return this.value}},{key:"accept",value:function(e){e.visitNumber(this)}}]),n}(At);!function(e){e[e.Tag=0]="Tag"}(jt||(jt={}));var Ft,Nt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._integerNumberTag=jt.Tag,e}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitIntegerNumber(this)}}]),n}(Pt);!function(e){e[e.Tag=0]="Tag"}(Ft||(Ft={}));var Rt,Dt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._realNumberTag=Ft.Tag,e}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitRealNumber(this)}}]),n}(Pt),Mt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).character=r,a}return Object(r.a)(n,[{key:"getCharacter",value:function(){return this.character}},{key:"accept",value:function(e){e.visitConstantCharacter(this)}}]),n}(At),Bt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).text=r,a}return Object(r.a)(n,[{key:"getText",value:function(){return this.text}},{key:"accept",value:function(e){e.visitText(this)}}]),n}(At);!function(e){e[e.Any=0]="Any",e[e.Finish=1]="Finish"}(Rt||(Rt={}));var Vt,qt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).designator=r,s.pattern=a,s}return Object(r.a)(n,[{key:"getDesignator",value:function(){return this.designator}},{key:"getPattern",value:function(){return this.pattern}}]),n}(At);!function(e){e[e.Tag=0]="Tag"}(Vt||(Vt={}));var _t,Ut=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._tag=Vt.Tag,e}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitReceiveTest(this)}}]),n}(qt);!function(e){e[e.Tag=0]="Tag"}(_t||(_t={}));var Wt,Gt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._tag=_t.Tag,e}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitInputTest(this)}}]),n}(qt),Ht=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).designator=r,a}return Object(r.a)(n,[{key:"getDesignator",value:function(){return this.designator}},{key:"accept",value:function(e){e.visitExistsTest(this)}}]),n}(At),Xt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).name=r,s.args=a,s}return Object(r.a)(n,[{key:"getName",value:function(){return this.name}},{key:"getArguments",value:function(){return this.args}},{key:"accept",value:function(e){e.visitFunctionCall(this)}}]),n}(At);!function(e){e[e.Tag=0]="Tag"}(Wt||(Wt={}));var Qt,zt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._tag=Wt.Tag,e}return n}(At),Yt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).name=r,a}return Object(r.a)(n,[{key:"getName",value:function(){return this.name}},{key:"accept",value:function(e){e.visitBasicDesignator(this)}}]),n}(zt),Jt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).name=r,s.expressions=a,s}return Object(r.a)(n,[{key:"getName",value:function(){return this.name}},{key:"getExpressions",value:function(){return this.expressions}},{key:"accept",value:function(e){e.visitBasicExpressionDesignator(this)}}]),n}(zt),Kt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).base=r,s.target=a,s}return Object(r.a)(n,[{key:"getBase",value:function(){return this.base}},{key:"getTarget",value:function(){return this.target}},{key:"accept",value:function(e){e.visitBaseTargetDesignator(this)}}]),n}(zt),$t=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).designator=r,s.type=a,s}return Object(r.a)(n,[{key:"getDesignator",value:function(){return this.designator}},{key:"getType",value:function(){return this.type}},{key:"accept",value:function(e){e.visitDesignatorType(this)}}]),n}(zt),Zt=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s){var o;return Object(i.a)(this,n),(o=t.call(this,e)).name=r,o.declarations=a,o.statements=s,o}return Object(r.a)(n,[{key:"getName",value:function(){return this.name}},{key:"getDeclarations",value:function(){return this.declarations}},{key:"getStatements",value:function(){return this.statements}},{key:"accept",value:function(e){e.visitImplementation(this)}}]),n}(ze),en=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).name=r,s.protocol=a,s}return Object(r.a)(n,[{key:"getName",value:function(){return this.name}},{key:"getProtocol",value:function(){return this.protocol}},{key:"accept",value:function(e){e.visitInterface(this)}}]),n}($e),tn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).expression=r,a}return Object(r.a)(n,[{key:"getExpression",value:function(){return this.expression}},{key:"accept",value:function(e){e.visitProtocol(this)}}]),n}(ze),nn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).terms=r,a}return Object(r.a)(n,[{key:"getTerms",value:function(){return this.terms}},{key:"accept",value:function(e){e.visitProtocolExpression(this)}}]),n}(ze),rn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).factors=r,a}return Object(r.a)(n,[{key:"getFactors",value:function(){return this.factors}},{key:"accept",value:function(e){e.visitProtocolTerm(this)}}]),n}(ze),an=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).name=r,s.cardinality=a,s}return Object(r.a)(n,[{key:"getName",value:function(){return this.name}},{key:"getCardinality",value:function(){return this.cardinality}},{key:"accept",value:function(e){e.visitInterfaceDeclaration(this)}}]),n}(ze);!function(e){e[e.Tag=0]="Tag"}(Qt||(Qt={}));var sn,on=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._tag=Qt.Tag,e}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitOfferedInterface(this)}}]),n}(an);!function(e){e[e.Tag=0]="Tag"}(sn||(sn={}));var cn,un=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._tag=sn.Tag,e}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitRequiredInterfface(this)}}]),n}(an),ln=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).name=r,a}return Object(r.a)(n,[{key:"getName",value:function(){return this.name}},{key:"accept",value:function(e){e.visitName(this)}}]),n}(ze),hn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).name=r,s.params=a,s}return Object(r.a)(n,[{key:"getName",value:function(){return this.name}},{key:"getParams",value:function(){return this.params}},{key:"accept",value:function(e){e.visitIndexedName(this)}}]),n}(ze),fn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).names=r,s.type=a,s}return Object(r.a)(n,[{key:"getNames",value:function(){return this.names}},{key:"getType",value:function(){return this.type}},{key:"accept",value:function(e){e.visitParameter(this)}}]),n}(ze),vn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s,o,c){var u;return Object(i.a)(this,n),(u=t.call(this,e)).name=r,u.params=a,u.type=s,u.declarations=o,u.statements=c,u}return Object(r.a)(n,[{key:"getName",value:function(){return this.name}},{key:"getParams",value:function(){return this.params}},{key:"getType",value:function(){return this.type}},{key:"getDeclarations",value:function(){return this.declarations}},{key:"getStatements",value:function(){return this.statements}},{key:"accept",value:function(e){e.visitProcedure(this)}}]),n}($e),pn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).mutable=r,s.parameter=a,s}return Object(r.a)(n,[{key:"isMutable",value:function(){return this.mutable}},{key:"getParameter",value:function(){return this.parameter}},{key:"accept",value:function(e){e.visitProcedureParameter(this)}}]),n}(ze),gn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).components=r,s.interfaces=a,s}return Object(r.a)(n,[{key:"getComponents",value:function(){return this.components}},{key:"getInterfaces",value:function(){return this.interfaces}},{key:"accept",value:function(e){e.visitProgram(this)}}]),n}(ze);!function(e){e[e.Tag=0]="Tag"}(cn||(cn={}));var mn,dn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e))._protocolFactorTag=cn.Tag,r}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitProtocolFactor(this)}}]),n}(ze);!function(e){e[e.IN=0]="IN",e[e.OUT=1]="OUT"}(mn||(mn={}));var yn,bn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s){var o;return Object(i.a)(this,n),(o=t.call(this,e)).direction=r,o.name=a,o.params=s,o}return Object(r.a)(n,[{key:"getDirection",value:function(){return this.direction}},{key:"getName",value:function(){return this.name}},{key:"getParams",value:function(){return this.params}},{key:"accept",value:function(e){e.visitMessageDeclaration(this)}}]),n}(dn);!function(e){e[e.Tag=0]="Tag"}(yn||(yn={}));var kn,Tn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).expression=r,a._protocolFactorExpressionTag=yn.Tag,a}return Object(r.a)(n,[{key:"getExpression",value:function(){return this.expression}},{key:"accept",value:function(e){e.visitProtocolFactorExpression(this)}}]),n}(dn);!function(e){e[e.Tag=0]="Tag"}(kn||(kn={}));var wn,On=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._tag=kn.Tag,e}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitOptionalProtocolFactorExpression(this)}}]),n}(Tn);!function(e){e[e.Tag=0]="Tag"}(wn||(wn={}));var En,xn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._tag=wn.Tag,e}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitRepeatingProtocolFactorExpression(this)}}]),n}(Tn);!function(e){e[e.Tag=0]="Tag"}(En||(En={}));var Cn,Sn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._tag=En.Tag,e}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitGroupProtocolFactorExpression(this)}}]),n}(Tn);!function(e){e[e.Tag=0]="Tag"}(Cn||(Cn={}));var jn,In=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._statementTag=Cn.Tag,e}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitStatement(this)}}]),n}(ze),Ln=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).name=r,s.params=a,s}return Object(r.a)(n,[{key:"getName",value:function(){return this.name}},{key:"getParams",value:function(){return this.params}},{key:"accept",value:function(e){e.visitProcedureCall(this)}}]),n}(In),An=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).designator=r,s.expression=a,s}return Object(r.a)(n,[{key:"getDesignator",value:function(){return this.designator}},{key:"getExpression",value:function(){return this.expression}},{key:"accept",value:function(e){e.visitAssignment(this)}}]),n}(In),Pn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).designator=r,s.args=a,s}return Object(r.a)(n,[{key:"getDesignator",value:function(){return this.designator}},{key:"getArgs",value:function(){return this.args}},{key:"accept",value:function(e){e.visitNew(this)}}]),n}(In),Fn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).what=r,s.to=a,s}return Object(r.a)(n,[{key:"getWhat",value:function(){return this.what}},{key:"getTo",value:function(){return this.to}},{key:"accept",value:function(e){e.visitConnect(this)}}]),n}(In),Nn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).what=r,a}return Object(r.a)(n,[{key:"getWhat",value:function(){return this.what}},{key:"accept",value:function(e){e.visitDisconnect(this)}}]),n}(In),Rn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s){var o;return Object(i.a)(this,n),(o=t.call(this,e)).from=r,o.target=a,o.args=s,o}return Object(r.a)(n,[{key:"getFrom",value:function(){return this.from}},{key:"getTarget",value:function(){return this.target}},{key:"getArgs",value:function(){return this.args}},{key:"accept",value:function(e){e.visitSend(this)}}]),n}(In),Dn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s){var o;return Object(i.a)(this,n),(o=t.call(this,e)).from=r,o.receiver=a,o.targets=s,o}return Object(r.a)(n,[{key:"getFrom",value:function(){return this.from}},{key:"getReceiver",value:function(){return this.receiver}},{key:"getTargets",value:function(){return this.targets}},{key:"accept",value:function(e){e.visitReceive(this)}}]),n}(In),Mn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).target=r,a}return Object(r.a)(n,[{key:"getTarget",value:function(){return this.target}},{key:"accept",value:function(e){e.visitDelete(this)}}]),n}(In),Bn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).from=r,s.to=a,s}return Object(r.a)(n,[{key:"getFrom",value:function(){return this.from}},{key:"getTo",value:function(){return this.to}},{key:"accept",value:function(e){e.visitMove(this)}}]),n}(In),Vn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).expression=r,a}return Object(r.a)(n,[{key:"getExpression",value:function(){return this.expression}},{key:"accept",value:function(e){e.visitAwait(this)}}]),n}(In),qn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).expression=r,a}return Object(r.a)(n,[{key:"getExpression",value:function(){return this.expression}},{key:"accept",value:function(e){e.visitReturn(this)}}]),n}(In),_n=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s,o){var c;return Object(i.a)(this,n),(c=t.call(this,e)).expression=r,c.then=a,c.elseIfs=s,c.elseNode=o,c}return Object(r.a)(n,[{key:"getExpression",value:function(){return this.expression}},{key:"getThen",value:function(){return this.then}},{key:"getElseIfs",value:function(){return this.elseIfs}},{key:"getElse",value:function(){return this.elseNode}},{key:"accept",value:function(e){e.visitIf(this)}}]),n}(In),Un=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).expression=r,s.then=a,s}return Object(r.a)(n,[{key:"getExpression",value:function(){return this.expression}},{key:"getThen",value:function(){return this.then}},{key:"accept",value:function(e){e.visitElseIf(this)}}]),n}(In),Wn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).expression=r,s.body=a,s}return Object(r.a)(n,[{key:"getExpresssion",value:function(){return this.expression}},{key:"getBody",value:function(){return this.body}},{key:"accept",value:function(e){e.visitWhile(this)}}]),n}(In),Gn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).body=r,s.expression=a,s}return Object(r.a)(n,[{key:"getBody",value:function(){return this.body}},{key:"getExpresssion",value:function(){return this.expression}},{key:"accept",value:function(e){e.visitRepeat(this)}}]),n}(In),Hn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s,o,c){var u;return Object(i.a)(this,n),(u=t.call(this,e)).designator=r,u.expression=a,u.to=s,u.by=o,u.statements=c,u}return Object(r.a)(n,[{key:"getDesignator",value:function(){return this.designator}},{key:"getExpression",value:function(){return this.expression}},{key:"getTo",value:function(){return this.to}},{key:"getBy",value:function(){return this.by}},{key:"getStatements",value:function(){return this.statements}},{key:"accept",value:function(e){e.visitFor(this)}}]),n}(In),Xn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s){var o;return Object(i.a)(this,n),(o=t.call(this,e)).designators=r,o.of=a,o.body=s,o}return Object(r.a)(n,[{key:"getDesignators",value:function(){return this.designators}},{key:"getOf",value:function(){return this.of}},{key:"getBody",value:function(){return this.body}},{key:"accept",value:function(e){e.visitForeach(this)}}]),n}(In),Qn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).statements=r,a}return Object(r.a)(n,[{key:"getStatements",value:function(){return this.statements}},{key:"accept",value:function(e){e.visitStatementBlock(this)}}]),n}(In),zn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).attributes=r,s.statements=a,s}return Object(r.a)(n,[{key:"getAttributes",value:function(){return this.attributes}},{key:"getStatements",value:function(){return this.statements}},{key:"accept",value:function(e){e.visitStatementSequence(this)}}]),n}(ze);!function(e){e[e.Tag=0]="Tag"}(jn||(jn={}));var Yn,Jn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._tag=jn.Tag,e}return Object(r.a)(n,[{key:"accept",value:function(e){e.visitType(this)}}]),n}(ze),Kn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).identifier=r,a}return Object(r.a)(n,[{key:"getIdentifier",value:function(){return this.identifier}},{key:"accept",value:function(e){e.visitBasicType(this)}}]),n}(Jn),$n=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e)).offered=r,s.required=a,s}return Object(r.a)(n,[{key:"getOffered",value:function(){return this.offered}},{key:"getRequired",value:function(){return this.required}},{key:"accept",value:function(e){e.visitAnyType(this)}}]),n}(Jn),Zn=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s){var o;return Object(i.a)(this,n),(o=t.call(this,e)).names=r,o.type=a,o.attributes=s,o}return Object(r.a)(n,[{key:"getNames",value:function(){return this.names}},{key:"getType",value:function(){return this.type}},{key:"getAttributes",value:function(){return this.attributes}},{key:"accept",value:function(e){e.visitVariable(this)}}]),n}(ze),ei=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).variables=r,a}return Object(r.a)(n,[{key:"getVariables",value:function(){return this.variables}},{key:"accept",value:function(e){e.visitVariableList(this)}}]),n}($e),ti=function(){function e(){Object(i.a)(this,e)}return Object(r.a)(e,[{key:"visitProtocolFactor",value:function(e){e instanceof bn?this.visitMessageDeclaration(e):e instanceof Tn&&this.visitProtocolFactorExpression(e)}},{key:"visitMessageDeclaration",value:function(e){}},{key:"visitProtocolFactorExpression",value:function(e){e instanceof On?this.visitOptionalProtocolFactorExpression(e):e instanceof xn?this.visitRepeatingProtocolFactorExpression(e):e instanceof Sn&&this.visitGroupProtocolFactorExpression(e)}},{key:"visitOptionalProtocolFactorExpression",value:function(e){}},{key:"visitGroupProtocolFactorExpression",value:function(e){}},{key:"visitRepeatingProtocolFactorExpression",value:function(e){}},{key:"visitType",value:function(e){e instanceof Kn?this.visitBasicType(e):e instanceof $n&&this.visitAnyType(e)}},{key:"visitBasicType",value:function(e){}},{key:"visitAnyType",value:function(e){}},{key:"visitDesignator",value:function(e){e instanceof Yt?this.visitBasicDesignator(e):e instanceof Jt?this.visitBasicExpressionDesignator(e):e instanceof Kt?this.visitBaseTargetDesignator(e):e instanceof $t&&this.visitDesignatorType(e)}},{key:"visitBasicDesignator",value:function(e){}},{key:"visitBasicExpressionDesignator",value:function(e){}},{key:"visitBaseTargetDesignator",value:function(e){}},{key:"visitDesignatorType",value:function(e){}},{key:"visitInterfaceDeclaration",value:function(e){e instanceof on?this.visitOfferedInterface(e):e instanceof un&&this.visitRequiredInterfface(e)}},{key:"visitOfferedInterface",value:function(e){}},{key:"visitRequiredInterfface",value:function(e){}},{key:"visitName",value:function(e){}},{key:"visitIndexedName",value:function(e){}},{key:"visitCardinality",value:function(e){}},{key:"visitProgram",value:function(e){}},{key:"visitDeclaration",value:function(e){e instanceof Ze?this.visitComponent(e):e instanceof en?this.visitInterface(e):e instanceof it?this.visitConstantList(e):e instanceof ei?this.visitVariableList(e):e instanceof vn&&this.visitProcedure(e)}},{key:"visitComponent",value:function(e){}},{key:"visitInterface",value:function(e){}},{key:"visitConstantList",value:function(e){}},{key:"visitVariableList",value:function(e){}},{key:"visitProcedure",value:function(e){}},{key:"visitProcedureParameter",value:function(e){}},{key:"visitComponentBody",value:function(e){}},{key:"visitImplementation",value:function(e){}},{key:"visitProtocol",value:function(e){}},{key:"visitProtocolExpression",value:function(e){}},{key:"visitProtocolTerm",value:function(e){}},{key:"visitAttribute",value:function(e){}},{key:"visitStatementSequence",value:function(e){}},{key:"visitParameter",value:function(e){}},{key:"visitConstant",value:function(e){}},{key:"visitConstantExpression",value:function(e){}},{key:"visitVariable",value:function(e){}},{key:"visitStatement",value:function(e){e instanceof Ln?this.visitProcedureCall(e):e instanceof An?this.visitAssignment(e):e instanceof Pn?this.visitNew(e):e instanceof Fn?this.visitConnect(e):e instanceof Nn?this.visitDisconnect(e):e instanceof Rn?this.visitSend(e):e instanceof Dn?this.visitReceive(e):e instanceof Mn?this.visitDelete(e):e instanceof Bn?this.visitMove(e):e instanceof Vn?this.visitAwait(e):e instanceof qn?this.visitReturn(e):e instanceof _n?this.visitIf(e):e instanceof Un?this.visitElseIf(e):e instanceof Wn?this.visitWhile(e):e instanceof Gn?this.visitRepeat(e):e instanceof Hn?this.visitFor(e):e instanceof Xn?this.visitForeach(e):e instanceof Qn&&this.visitStatementBlock(e)}},{key:"visitProcedureCall",value:function(e){}},{key:"visitAssignment",value:function(e){}},{key:"visitNew",value:function(e){}},{key:"visitConnect",value:function(e){}},{key:"visitDisconnect",value:function(e){}},{key:"visitSend",value:function(e){}},{key:"visitReceive",value:function(e){}},{key:"visitDelete",value:function(e){}},{key:"visitMove",value:function(e){}},{key:"visitAwait",value:function(e){}},{key:"visitReturn",value:function(e){}},{key:"visitIf",value:function(e){}},{key:"visitElseIf",value:function(e){}},{key:"visitWhile",value:function(e){}},{key:"visitRepeat",value:function(e){}},{key:"visitFor",value:function(e){}},{key:"visitForeach",value:function(e){}},{key:"visitStatementBlock",value:function(e){}},{key:"visitExpression",value:function(e){e instanceof gt?this.visitSimpleExpression(e):e instanceof ot&&this.visitAttributedExpression(e)}},{key:"visitAttributedExpression",value:function(e){e instanceof gt?this.visitSimpleExpression(e):e instanceof ct?this.visitUnaryExpression(e):e instanceof lt?this.visitBinaryExpression(e):e instanceof ft?this.visitOffersRequiresExpression(e):e instanceof vt&&this.visitTypeCheck(e)}},{key:"visitUnaryExpression",value:function(e){}},{key:"visitBinaryExpression",value:function(e){}},{key:"visitOffersRequiresExpression",value:function(e){}},{key:"visitTypeCheck",value:function(e){}},{key:"visitSimpleExpression",value:function(e){e instanceof dt?this.visitUnaryTermNode(e):e instanceof bt?this.visitTermChain(e):e instanceof wt&&this.visitTerm(e)}},{key:"visitUnaryTermNode",value:function(e){}},{key:"visitTermChain",value:function(e){}},{key:"visitRightTerm",value:function(e){}},{key:"visitTerm",value:function(e){e instanceof St?this.visitFactor(e):e instanceof Ot?this.visitFactorChain(e):e instanceof xt&&this.visitRightFactor(e)}},{key:"visitFactorChain",value:function(e){}},{key:"visitRightFactor",value:function(e){}},{key:"visitFactor",value:function(e){e instanceof It?this.visitUnaryFactor(e):e instanceof Mt?this.visitConstantCharacter(e):e instanceof At&&this.visitOperand(e)}},{key:"visitUnaryFactor",value:function(e){}},{key:"visitExpressionFactor",value:function(e){}},{key:"visitOperand",value:function(e){e instanceof Pt?this.visitNumber(e):e instanceof Mt?this.visitConstantCharacter(e):e instanceof Bt?this.visitText(e):e instanceof Ut?this.visitReceiveTest(e):e instanceof Gt?this.visitInputTest(e):e instanceof Ht?this.visitExistsTest(e):e instanceof Xt?this.visitFunctionCall(e):e instanceof zt&&this.visitDesignator(e)}},{key:"visitNumber",value:function(e){e instanceof Nt?this.visitIntegerNumber(e):e instanceof Dt&&this.visitRealNumber(e)}},{key:"visitIntegerNumber",value:function(e){}},{key:"visitRealNumber",value:function(e){}},{key:"visitConstantCharacter",value:function(e){}},{key:"visitText",value:function(e){}},{key:"visitReceiveTest",value:function(e){}},{key:"visitInputTest",value:function(e){}},{key:"visitExistsTest",value:function(e){}},{key:"visitFunctionCall",value:function(e){}}]),e}();!function(e){e.New="NEW",e.Conncet="CONNECT",e.Disconnect="DISCONNECT",e.Delete="DELETE",e.Move="MOVE",e.Await="AWAIT",e.Input="INPUT",e.Exists="EXISTS"}(Yn||(Yn={}));var ni,ii=function(){function e(t,n){Object(i.a)(this,e),this.diagnosis=t,this.lexer=n}return Object(r.a)(e,[{key:"hasTag",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=this.lexer.peek(t);return this.isTaggedFixToken(n,e)}},{key:"isTaggedFixToken",value:function(e,t){return e instanceof x&&e.getTag()===t}},{key:"hasIdentifier",value:function(e){var t=this.lexer.peek(1);return t instanceof C&&t.getIdentifier()===e}},{key:"isComponent",value:function(){return this.hasTag(m.Component)}},{key:"isInterface",value:function(){return this.hasTag(m.Interface)}},{key:"isEOT",value:function(){return this.hasTag(m.EOT)}},{key:"error",value:function(e){var t=this.lexer.peek(1).getLocation().range;throw this.diagnosis.log(new Ue(t,G.Error,e)),new Error("[".concat(t.start.line,",").concat(t.start.character,":").concat(t.end.line,",").concat(t.end.character,"]: ").concat(e))}},{key:"loop",value:function(e,t){for(;e()&&!this.isEOT();)t()}},{key:"expectConsumeFixToken",value:function(e){if(!this.tryConsumeFixToken(e)){var t="Expected FixToken with Tag ".concat(e);this.error(t)}}},{key:"tryConsumeFixToken",value:function(e){return!!this.hasTag(e)&&(this.lexer.next(),!0)}},{key:"expectConsumeIdentifierToken",value:function(e){if(!this.tryConsumeIdentifierToken(e)){var t="Expected IdentifierToken with Identifier ".concat(e);this.error(t)}}},{key:"tryParse",value:function(e){try{this.diagnosis.saveState(),this.lexer.saveState();var t=e();return this.lexer.popSaveState(),t}catch(n){return this.diagnosis.restoreState(),void this.lexer.restoreState()}}},{key:"tryConsumeIdentifierToken",value:function(e){return!!this.hasIdentifier(e)&&(this.lexer.next(),!0)}},{key:"parseName",value:function(){var e=this.lexer.peek(1);if(e instanceof C)return this.lexer.next(),new ln(e.getLocation(),e.getIdentifier());return this.error("Failed to parse identifier name")}},{key:"parseIndexedName",value:function(){var e=this.lexer.peek(1);if(!(e instanceof C))return this.error("Failed to parse indexed name.");if(this.lexer.next(),this.tryConsumeFixToken(m.OpenSquareBracket)){var t=this.parseParameterList(),n=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.CloseSquareBracket),new hn(b.merge(e.getLocation(),n),e.getIdentifier(),t)}return new hn(e.getLocation(),e.getIdentifier(),new Array)}},{key:"parseCardinality",value:function(){if(this.hasTag(m.OpenSquareBracket)){var e=this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.OpenSquareBracket);var t=this.lexer.next();if(!(t instanceof A))return this.error("Expected number token.");var n=t.getNumber(),i=n;this.tryConsumeFixToken(m.Ellipsis)&&((t=this.lexer.peek(1))instanceof A?(this.lexer.next(),i=t.getNumber()):this.hasTag(m.Asterisk)?(this.lexer.next(),i=1/0):this.error('Expected number or "*".'));var r=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.CloseSquareBracket),new Je(b.merge(e,r),n,i)}}},{key:"parseInterfaceDeclaration",value:function(e){var t=this.parseName(),n=this.parseCardinality();return new e(void 0===n?t.getLocation():b.merge(t.getLocation(),n.getLocation()),t,n)}},{key:"parseOfferedInterfaceDeclaration",value:function(){return this.parseInterfaceDeclaration(on)}},{key:"parseRequiredInterfaceDeclaration",value:function(){return this.parseInterfaceDeclaration(un)}},{key:"parseOffers",value:function(){var e=new Array;return this.tryConsumeFixToken(m.Offers)&&e.push.apply(e,o(this.parseOfferedInterfaceDeclarationList())),e}},{key:"parseRequires",value:function(){var e=new Array;return this.tryConsumeFixToken(m.Requires)&&e.push.apply(e,o(this.parseRequiredInterfaceDeclarationList())),e}},{key:"parseFunctionCall",value:function(){var e=this.parseName();this.expectConsumeFixToken(m.OpenParentheses);var t=new Array;this.hasTag(m.CloseParentheses)||t.push.apply(t,o(this.parseExpressionList()));var n=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.CloseParentheses),new Xt(b.merge(e.getLocation(),n),e,t)}},{key:"parseMessagePattern",value:function(){return this.tryConsumeFixToken(m.Any)?Rt.Any:this.tryConsumeFixToken(m.Finish)?Rt.Finish:this.parseName()}},{key:"tryParseExpression",value:function(){return this.tryParse(this.parseExpression.bind(this))}},{key:"parseReceiveTestExpression",value:function(e){var t,n=null!==(t=null===e||void 0===e?void 0:e.getLocation())&&void 0!==t?t:this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.QuestionMark);var i=this.lexer.peek(1).getLocation(),r=this.parseMessagePattern();return new Ut(b.merge(n,i),e,r)}},{key:"parseInputTestExpression",value:function(){var e=this.lexer.peek(1).getLocation();this.expectConsumeIdentifierToken(Yn.Input),this.expectConsumeFixToken(m.OpenParentheses);var t=this.parseDesignator();if(!this.hasTag(m.Comma)){if(t instanceof Yt){var n=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.CloseParentheses),new Gt(b.merge(e,n),void 0,t.getName())}this.error("Failed parsing input test node.")}this.expectConsumeFixToken(m.Comma);var i=this.parseMessagePattern(),r=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.CloseParentheses),new Gt(b.merge(e,r),t,i)}},{key:"parseExistsExpression",value:function(){var e=this.lexer.peek(1).getLocation();this.expectConsumeIdentifierToken(Yn.Exists),this.expectConsumeFixToken(m.OpenParentheses);var t=this.parseDesignator(),n=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.CloseParentheses),new Ht(b.merge(e,n),t)}},{key:"parseOperand",value:function(){var e=this.lexer.peek(1);if(e instanceof ae){this.lexer.next();var t=e.getText();return 1===t.length?new Mt(e.getLocation(),t):new Bt(e.getLocation(),t)}if(e instanceof A)return this.lexer.next(),new Nt(e.getLocation(),e.getNumber());if(e instanceof I)return this.lexer.next(),new Nt(e.getLocation(),e.getNumber());if(e instanceof re)return this.lexer.next(),new Dt(e.getLocation(),e.getNumber());if(this.hasIdentifier(Yn.Input))return this.parseInputTestExpression();if(this.hasIdentifier(Yn.Exists))return this.parseExistsExpression();var n=this.tryParseDesignator();return this.hasTag(m.QuestionMark)?this.parseReceiveTestExpression(n):void 0===n?this.parseFunctionCall():n}},{key:"parseFactor",value:function(){var e=this.lexer.peek(1).getLocation();if(this.tryConsumeFixToken(m.Tilde)){var t=this.parseFactor();return new It(b.merge(e,t.getLocation()),Ct.Not,t)}if(this.tryConsumeFixToken(m.OpenParentheses)){var n=this.parseExpression(),i=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.CloseParentheses),new Lt(b.merge(e,i),n)}return this.parseOperand()}},{key:"isFactorInfix",value:function(){return this.hasTag(m.Asterisk)||this.hasTag(m.Slash)||this.hasTag(m.Div)||this.hasTag(m.Mod)||this.hasTag(m.And)}},{key:"parseFactorInfix",value:function(){return this.tryConsumeFixToken(m.Asterisk)?Tt.Times:this.tryConsumeFixToken(m.Slash)?Tt.Div:this.tryConsumeFixToken(m.Div)?Tt.DivText:this.tryConsumeFixToken(m.Mod)?Tt.ModText:this.tryConsumeFixToken(m.And)?Tt.AndText:this.error("Failed to parse factor infix.")}},{key:"parseRightFactor",value:function(){var e=this.lexer.peek(1).getLocation(),t=this.parseFactorInfix(),n=this.parseFactor();return new xt(b.merge(e,n.getLocation()),t,n)}},{key:"parseTerm",value:function(){var e=this.parseFactor();if(!this.isFactorInfix())return e;var t=this.parseListWithPredicate(this.parseRightFactor.bind(this),this.isFactorInfix.bind(this));return new Ot(b.merge(e.getLocation(),t[t.length-1].getLocation()),e,t)}},{key:"isTermInfix",value:function(){return this.hasTag(m.Plus)||this.hasTag(m.Minus)||this.hasTag(m.Or)}},{key:"parseTermInfix",value:function(){return this.tryConsumeFixToken(m.Plus)?mt.Plus:this.tryConsumeFixToken(m.Minus)?mt.Minus:this.tryConsumeFixToken(m.Or)?mt.Or:this.error("Failed to parse term infix.")}},{key:"parseRightTerm",value:function(){var e=this.lexer.peek(1).getLocation(),t=this.parseTermInfix(),n=this.parseTerm();return new kt(b.merge(e,n.getLocation()),t,n)}},{key:"isTermPrefix",value:function(){return this.hasTag(m.Plus)||this.hasTag(m.Minus)}},{key:"parseUnaryPrefix",value:function(){return this.tryConsumeFixToken(m.Plus)?pt.Plus:this.tryConsumeFixToken(m.Minus)?pt.Minus:this.error("Failed to parse prefix operator.")}},{key:"parseUnaryTerm",value:function(){var e=this.lexer.peek(1).getLocation(),t=this.parseUnaryPrefix(),n=this.parseTerm();return new dt(b.merge(e,n.getLocation()),t,n)}},{key:"parseSimpleExpression",value:function(){var e=this.isTermPrefix()?this.parseUnaryTerm():this.parseTerm();if(!this.isTermInfix())return e;var t=this.parseListWithPredicate(this.parseRightTerm.bind(this),this.isTermInfix.bind(this));return new bt(b.merge(e.getLocation(),t[t.length-1].getLocation()),e,t)}},{key:"isBinaryExpressionOperator",value:function(){return this.hasTag(m.Equal)||this.hasTag(m.NumberSign)||this.hasTag(m.Less)||this.hasTag(m.LessEqual)||this.hasTag(m.Greater)||this.hasTag(m.GreaterEqual)}},{key:"parseBinaryExpressionOperator",value:function(){return this.tryConsumeFixToken(m.Equal)?st.Equal:this.tryConsumeFixToken(m.NumberSign)?st.NotEqual:this.tryConsumeFixToken(m.Less)?st.Less:this.tryConsumeFixToken(m.LessEqual)?st.LessEqual:this.tryConsumeFixToken(m.Greater)?st.More:this.tryConsumeFixToken(m.GreaterEqual)?st.MoreEqual:this.error("Failed to parse term infix.")}},{key:"parseBinaryExpression",value:function(e,t,n){var i=this.parseBinaryExpressionOperator(),r=this.parseSimpleExpression();return new lt(b.merge(e,r.getLocation()),t,n,i,r)}},{key:"parseExpression",value:function(){var e=this.parseAttributeList(),t=this.parseSimpleExpression();if(t instanceof zt){var n=0===e.length?t.getLocation():e[0].getLocation();if(this.tryConsumeFixToken(m.Offers)){var i=this.parseOfferedInterfaceDeclarationList();return new ft(b.merge(n,i[i.length-1].getLocation()),e,ut.Offers,i)}if(this.tryConsumeFixToken(m.Requires)){var r=this.parseRequiredInterfaceDeclarationList();return new ft(b.merge(n,r[r.length-1].getLocation()),e,ut.Requires,r)}if(this.tryConsumeFixToken(m.Is)){var a=this.parseType();return new vt(b.merge(n,a.getLocation()),e,t,a)}return this.isBinaryExpressionOperator()?this.parseBinaryExpression(n,e,t):t}var s=0===e.length?t.getLocation():e[0].getLocation();return this.isBinaryExpressionOperator()?this.parseBinaryExpression(s,e,t):new ct(b.merge(s,t.getLocation()),e,t)}},{key:"parseProcedureCall",value:function(){var e=this.parseName(),t=new Array,n=e.getLocation();return this.tryConsumeFixToken(m.OpenParentheses)&&(t.push.apply(t,o(this.parseExpressionList())),n=this.lexer.peek(1).getLocation(),this.expectConsumeFixToken(m.CloseParentheses)),new Ln(b.merge(e.getLocation(),n),e,t)}},{key:"parseStatementSequenceBlock",value:function(e){var t=void 0;if(this.hasTag(e)){var n=this.lexer.peek(1).getLocation();this.expectConsumeFixToken(e),t=this.parseStatementSequence(n)}return t}},{key:"parseBasicDesignator",value:function(){var e=this.parseName();if(this.tryConsumeFixToken(m.OpenSquareBracket)){var t=this.parseExpressionList(),n=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.CloseSquareBracket),new Jt(b.merge(e.getLocation(),n),e,t)}return new Yt(e.getLocation(),e)}},{key:"parseDesignator",value:function(){var e=this.parseBasicDesignator();if(this.tryConsumeFixToken(m.OpenParentheses)){if(this.hasTag(m.Any)){var t=this.parseType(),n=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.CloseParentheses),new $t(b.merge(e.getLocation(),n),e,t)}var i=this.parseDesignator(),r=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.CloseParentheses),new Kt(b.merge(e.getLocation(),r),e,i)}return e}},{key:"tryParseDesignator",value:function(){return this.tryParse(this.parseDesignator.bind(this))}},{key:"parseStatementSequence",value:function(e){var t=this.parseAttributeList(),n=this.parseStatementList(),i=n[n.length-1].getLocation();return new zn(b.merge(e,i),t,n)}},{key:"parseNewStatement",value:function(){var e=this.lexer.peek(1).getLocation();this.expectConsumeIdentifierToken(Yn.New),this.expectConsumeFixToken(m.OpenParentheses);var t=this.parseDesignator(),n=new Array;this.tryConsumeFixToken(m.Comma)&&n.push.apply(n,o(this.parseExpressionList()));var i=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.CloseParentheses),new Pn(b.merge(e,i),t,n)}},{key:"parseDeleteStatement",value:function(){var e=this.lexer.peek(1).getLocation();this.expectConsumeIdentifierToken(Yn.Delete),this.expectConsumeFixToken(m.OpenParentheses);var t=this.parseDesignator(),n=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.CloseParentheses),new Mn(b.merge(e,n),t)}},{key:"parseConnectStatement",value:function(){var e=this.lexer.peek(1).getLocation();this.expectConsumeIdentifierToken(Yn.Conncet),this.expectConsumeFixToken(m.OpenParentheses);var t=this.parseDesignator();this.expectConsumeFixToken(m.Comma);var n=this.parseDesignator(),i=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.CloseParentheses),new Fn(b.merge(e,i),t,n)}},{key:"parseDisconnectStatement",value:function(){var e=this.lexer.peek(1).getLocation();this.expectConsumeIdentifierToken(Yn.Disconnect),this.expectConsumeFixToken(m.OpenParentheses);var t=this.parseDesignator(),n=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.CloseParentheses),new Nn(b.merge(e,n),t)}},{key:"parseMoveStatement",value:function(){var e=this.lexer.peek(1).getLocation();this.expectConsumeIdentifierToken(Yn.Move),this.expectConsumeFixToken(m.OpenParentheses);var t=this.parseDesignator();this.expectConsumeFixToken(m.Comma);var n=this.parseDesignator(),i=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.CloseParentheses),new Bn(b.merge(e,i),t,n)}},{key:"parseAwaitStatement",value:function(){var e=this.lexer.peek(1).getLocation();this.expectConsumeIdentifierToken(Yn.Await),this.expectConsumeFixToken(m.OpenParentheses);var t=this.parseExpression(),n=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.CloseParentheses),new Vn(b.merge(e,n),t)}},{key:"parseSendStatement",value:function(e){var t,n=null!==(t=null===e||void 0===e?void 0:e.getLocation())&&void 0!==t?t:this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.ExclamationMark);var i=this.parseName(),r=new Array,a=i.getLocation();return this.tryConsumeFixToken(m.OpenParentheses)&&(r.push.apply(r,o(this.parseExpressionList())),a=this.lexer.peek(1).getLocation(),this.expectConsumeFixToken(m.CloseParentheses)),new Rn(b.merge(n,a),e,i,r)}},{key:"parseReceiveStatement",value:function(e){var t,n=null!==(t=null===e||void 0===e?void 0:e.getLocation())&&void 0!==t?t:this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.QuestionMark);var i=this.parseName(),r=new Array,a=i.getLocation();return this.tryConsumeFixToken(m.OpenParentheses)&&(r.push.apply(r,o(this.parseDesignatorList())),a=this.lexer.peek(1).getLocation(),this.expectConsumeFixToken(m.CloseParentheses)),new Dn(b.merge(n,a),e,i,r)}},{key:"parseAssignmentStatement",value:function(e){this.expectConsumeFixToken(m.ColonEqual);var t=this.parseExpression();return new An(b.merge(e.getLocation(),t.getLocation()),e,t)}},{key:"parseReturnStatement",value:function(){var e,t=this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.Return);var n=this.tryParseExpression();return new qn(b.merge(t,null!==(e=null===n||void 0===n?void 0:n.getLocation())&&void 0!==e?e:t),n)}},{key:"parseIfStatement",value:function(){var e=this,t=this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.If);var n=this.parseExpression();this.expectConsumeFixToken(m.Then);var i=this.parseStatementSequence(this.lexer.peek(1).getLocation()),r=new Array;this.loop((function(){return e.hasTag(m.Elsif)}),(function(){var t=e.lexer.peek(1).getLocation();e.expectConsumeFixToken(m.Elsif);var n=e.parseExpression();e.expectConsumeFixToken(m.Then);var i=e.parseStatementSequence(e.lexer.peek(1).getLocation());r.push(new Un(b.merge(t,i.getLocation()),n,i))}));var a=void 0;this.tryConsumeFixToken(m.Else)&&(a=this.parseStatementSequence(this.lexer.peek(1).getLocation()));var s=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.End),new _n(b.merge(t,s),n,i,r,a)}},{key:"parseWhileStatement",value:function(){var e=this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.While);var t=this.parseExpression();this.expectConsumeFixToken(m.Do);var n=this.parseStatementSequence(this.lexer.peek(1).getLocation()),i=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.End),new Wn(b.merge(e,i),t,n)}},{key:"parseRepeatStatement",value:function(){var e=this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.Repeat);var t=this.parseStatementSequence(this.lexer.peek(1).getLocation());this.expectConsumeFixToken(m.Until);var n=this.parseExpression();return new Gn(b.merge(e,n.getLocation()),t,n)}},{key:"parseForStatement",value:function(){var e=this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.For);var t=this.parseDesignator();this.expectConsumeFixToken(m.ColonEqual);var n=this.parseExpression();this.expectConsumeFixToken(m.To);var i=this.parseExpression(),r=void 0;this.tryConsumeFixToken(m.By)&&(r=this.parseConstantExpression()),this.expectConsumeFixToken(m.Do);var a=this.parseStatementSequence(this.lexer.peek(1).getLocation()),s=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.End),new Hn(b.merge(e,s),t,n,i,r,a)}},{key:"parseForeachStatement",value:function(){var e=this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.Foreach);var t=this.parseDesignatorList();this.expectConsumeFixToken(m.Of);var n=this.parseDesignator();this.expectConsumeFixToken(m.Do);var i=this.parseStatementSequence(this.lexer.peek(1).getLocation()),r=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.End),new Xn(b.merge(e,r),t,n,i)}},{key:"parseStatementBlock",value:function(){var e=this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.Begin);var t=this.parseStatementSequence(this.lexer.peek(1).getLocation()),n=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.End),new Qn(b.merge(e,n),t)}},{key:"parseStatement",value:function(){if(this.hasIdentifier(Yn.New))return this.parseNewStatement();if(this.hasIdentifier(Yn.Delete))return this.parseDeleteStatement();if(this.hasIdentifier(Yn.Conncet))return this.parseConnectStatement();if(this.hasIdentifier(Yn.Disconnect))return this.parseDisconnectStatement();if(this.hasIdentifier(Yn.Move))return this.parseMoveStatement();if(this.hasIdentifier(Yn.Await))return this.parseAwaitStatement();if(this.hasTag(m.Return))return this.parseReturnStatement();if(this.hasTag(m.If))return this.parseIfStatement();if(this.hasTag(m.While))return this.parseWhileStatement();if(this.hasTag(m.Repeat))return this.parseRepeatStatement();if(this.hasTag(m.For))return this.parseForStatement();if(this.hasTag(m.Foreach))return this.parseForeachStatement();if(this.hasTag(m.Begin))return this.parseStatementBlock();var e=this.tryParseDesignator();if(this.hasTag(m.ExclamationMark))return this.parseSendStatement(e);if(this.hasTag(m.QuestionMark))return this.parseReceiveStatement(e);if(void 0===e)return this.parseProcedureCall();if(this.hasTag(m.ColonEqual))return this.parseAssignmentStatement(e);if(e instanceof Yt)return new Ln(e.getLocation(),e.getName(),new Array);if(e instanceof Kt){var t=e.getBase();if(t instanceof Yt)return new Ln(e.getLocation(),t.getName(),new Array(e.getTarget()))}return this.error("Failed to parse statement. Unknown statement.")}},{key:"parseConstantExpression",value:function(){var e=this.parseExpression();return new nt(e.getLocation(),e)}},{key:"parseConstant",value:function(){var e=this.parseName();this.expectConsumeFixToken(m.Equal);var t=this.parseConstantExpression(),n=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.Semicolon),new tt(b.merge(e.getLocation(),n),e,t)}},{key:"tryParseConstant",value:function(){return this.tryParse(this.parseConstant.bind(this))}},{key:"parseConstantList",value:function(){var e=this,t=this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.Constant);var n=new g(this.parseConstant()),i=!0;return this.loop((function(){return i}),(function(){var t=e.tryParseConstant();void 0!==t?n.push(t):i=!1})),new it(b.merge(t,n[n.length-1].getLocation()),n)}},{key:"parseVariable",value:function(){var e=this.lexer.peek(1).getLocation(),t=this.parseIndexedIdentifierList();this.expectConsumeFixToken(m.Colon);var n=this.parseType(),i=this.parseAttributeList(),r=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.Semicolon),new Zn(b.merge(e,r),t,n,i)}},{key:"tryParseVariable",value:function(){return this.tryParse(this.parseVariable.bind(this))}},{key:"parseVariableList",value:function(){var e=this,t=this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.Variable);var n=new g(this.parseVariable()),i=!0;return this.loop((function(){return i}),(function(){var t=e.tryParseVariable();void 0!==t?n.push(t):i=!1})),new ei(b.merge(t,n[n.length-1].getLocation()),n)}},{key:"parseProcedure",value:function(){var e=this,t=this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.Procedure);var n=this.parseName(),i=new Array;this.tryConsumeFixToken(m.OpenParentheses)&&(this.hasTag(m.CloseParentheses)||i.push.apply(i,o(this.parseProcedureParameterList())),this.expectConsumeFixToken(m.CloseParentheses));var r=this.tryConsumeFixToken(m.Colon)?this.parseType():void 0;this.expectConsumeFixToken(m.Semicolon);var a=new Array,s=void 0,c=!1;this.loop((function(){return!e.hasTag(m.End)&&!c}),(function(){var t=e.parseDeclaration();void 0===t?void 0!==s?c=!0:s=e.parseStatementSequenceBlock(m.Begin):a.push(t)}));var u=this.consumeEnd(n);return new vn(b.merge(t,u),n,i,r,a,s)}},{key:"parseDeclaration",value:function(){return this.hasTag(m.Component)?this.parseComponent():this.hasTag(m.Interface)?this.parseInterface():this.hasTag(m.Constant)?this.parseConstantList():this.hasTag(m.Variable)?this.parseVariableList():this.hasTag(m.Procedure)?this.parseProcedure():void 0}},{key:"parseComponentBody",value:function(){var e=this,t=this.lexer.peek(1).getLocation(),n=void 0,i=void 0,r=void 0,a=new Array,s=new Array,o=t,c=!1;return this.loop((function(){return!e.hasTag(m.End)&&!c}),(function(){var t=e.parseDeclaration();if(void 0===t)if(e.hasTag(m.Implementation))s.push(e.parseImplementation());else if(void 0!==n&&e.hasTag(m.Begin)&&e.error("Cannot have more than one begin per component."),void 0===n&&e.hasTag(m.Begin))void 0!==(n=e.parseStatementSequenceBlock(m.Begin))&&(o=n.getLocation());else if(void 0!==i&&e.hasTag(m.Activity)&&e.error("Cannot have more than one activity per component."),void 0===i&&e.hasTag(m.Activity))void 0!==(i=e.parseStatementSequenceBlock(m.Activity))&&(o=i.getLocation());else if(void 0!==r&&e.hasTag(m.Finally)&&e.error("Cannot have more than one finally per component."),void 0===r&&e.hasTag(m.Finally))void 0!==(r=e.parseStatementSequenceBlock(m.Finally))&&(o=r.getLocation());else if(e.hasTag(m.Component)){var u=e.parseComponent();void 0!==u&&a.push(u)}else if(e.hasTag(m.Implementation)){var l=e.parseImplementation();void 0!==l&&s.push(l)}else c=!0;else a.push(t)})),new et(b.merge(t,o),a,s,n,i,r)}},{key:"consumeEnd",value:function(e){this.expectConsumeFixToken(m.End),this.parseName().getName()!==e.getName()&&this.error("Name missmatch.");var t=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(m.Semicolon),t}},{key:"parseComponent",value:function(){var e=this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.Component);var t=this.parseAttributeList(),n=this.parseName(),i=this.parseOffers(),r=this.parseRequires();this.expectConsumeFixToken(m.Semicolon);var a=this.parseComponentBody(),s=this.consumeEnd(n);return new Ze(b.merge(e,s),n,t,i,r,a)}},{key:"parseImplementation",value:function(){var e=this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.Implementation);var t=this.parseName();this.expectConsumeFixToken(m.Semicolon);var n=this.parseDeclarationList(),i=this.parseStatementSequenceBlock(m.Begin),r=this.consumeEnd(t);return new Zt(b.merge(e,r),t,n,i)}},{key:"parseListWithPredicate",value:function(e,t){var n=new g(e());return this.loop((function(){return t()}),(function(){n.push(e())})),n}},{key:"parseList",value:function(e,t){var n=this,i=new g(e());return this.loop((function(){return n.hasTag(t)}),(function(){n.expectConsumeFixToken(t),i.push(e())})),i}},{key:"parseIdentifierList",value:function(){return this.parseList(this.parseName.bind(this),m.Comma)}},{key:"parseParameterList",value:function(){return this.parseList(this.parseParameter.bind(this),m.Semicolon)}},{key:"parseProcedureParameterList",value:function(){return this.parseList(this.parseProcedureParameter.bind(this),m.Semicolon)}},{key:"parseIndexedIdentifierList",value:function(){return this.parseList(this.parseIndexedName.bind(this),m.Comma)}},{key:"parseExpressionList",value:function(){return this.parseList(this.parseExpression.bind(this),m.Comma)}},{key:"parseDesignatorList",value:function(){return this.parseList(this.parseDesignator.bind(this),m.Comma)}},{key:"parseOfferedInterfaceDeclarationList",value:function(){return this.parseList(this.parseOfferedInterfaceDeclaration.bind(this),m.Comma)}},{key:"parseRequiredInterfaceDeclarationList",value:function(){return this.parseList(this.parseRequiredInterfaceDeclaration.bind(this),m.Comma)}},{key:"parseStatementList",value:function(){return this.parseList(this.parseStatement.bind(this),m.Semicolon)}},{key:"parseAttributeList",value:function(){if(!this.hasTag(m.OpenBrace))return new Array;this.expectConsumeFixToken(m.OpenBrace);var e=this.parseIdentifierList();return this.expectConsumeFixToken(m.CloseBrace),e.map((function(e){return new Ye(e.getLocation(),e)}))}},{key:"parseDeclarationList",value:function(){var e=this,t=new Array,n=!0;return this.loop((function(){return n}),(function(){var i=e.parseDeclaration();void 0!==i?t.push(i):n=!1})),t}},{key:"parseType",value:function(){var e=this.lexer.peek(1);if(e instanceof C)return this.lexer.next(),new Kn(e.getLocation(),e.getIdentifier());this.expectConsumeFixToken(m.Any);var t=new Array,n=new Array;return this.tryConsumeFixToken(m.OpenParentheses)&&(t.push.apply(t,o(this.parseOfferedInterfaceDeclarationList())),this.tryConsumeFixToken(m.Pipe)&&n.push.apply(n,o(this.parseRequiredInterfaceDeclarationList())),this.expectConsumeFixToken(m.CloseParentheses)),new $n(e.getLocation(),t,n)}},{key:"parseParameter",value:function(){var e=this.parseIdentifierList();this.expectConsumeFixToken(m.Colon);var t=this.parseType();return new fn(b.merge(e[0].getLocation(),t.getLocation()),e,t)}},{key:"parseProcedureParameter",value:function(){var e=this.hasTag(m.Variable),t=this.lexer.peek(1).getLocation();e&&this.expectConsumeFixToken(m.Variable);var n=this.parseParameter();return new pn(b.merge(t,n.getLocation()),e,n)}},{key:"parseMessageParameters",value:function(){if(this.tryConsumeFixToken(m.OpenParentheses)){var e=this.parseParameterList();return this.expectConsumeFixToken(m.CloseParentheses),e}return new Array}},{key:"parseMessageDeclaration",value:function(){var e=this.lexer.peek(1).getLocation(),t=void 0;if(this.tryConsumeFixToken(m.In)&&(t=mn.IN),this.tryConsumeFixToken(m.Out)&&(t=mn.OUT),void 0===t)return this.error("Message declarations must have a direction.");var n=this.parseName(),i=this.parseMessageParameters();return new bn(e,t,n,i)}},{key:"parseProtocolTermExpression",value:function(e,t,n){var i=this.lexer.peek(1).getLocation();this.expectConsumeFixToken(t);var r=this.parseProtocolExpression();if(void 0!==r){var a=this.lexer.peek(1).getLocation();return this.expectConsumeFixToken(n),new e(b.merge(i,a),r)}return this.error("Failed to parse protocol term expression.")}},{key:"parseProtocolTerm",value:function(){var e=this,t=this.lexer.peek(1).getLocation(),n=new Array;this.loop((function(){return e.hasTag(m.In)||e.hasTag(m.Out)||e.hasTag(m.OpenSquareBracket)||e.hasTag(m.OpenParentheses)||e.hasTag(m.OpenBrace)}),(function(){if(e.hasTag(m.In)||e.hasTag(m.Out))n.push(e.parseMessageDeclaration());else if(e.hasTag(m.OpenSquareBracket)){var t=e.parseProtocolTermExpression(On,m.OpenSquareBracket,m.CloseSquareBracket);n.push(t)}else if(e.hasTag(m.OpenParentheses)){var i=e.parseProtocolTermExpression(Sn,m.OpenParentheses,m.CloseParentheses);n.push(i)}else if(e.hasTag(m.OpenBrace)){var r=e.parseProtocolTermExpression(xn,m.OpenBrace,m.CloseBrace);n.push(r)}else;}));var i=g.fromArray(n);return void 0===i?this.error("At least one term factor needed."):new rn(t,i)}},{key:"parseProtocolExpression",value:function(){var e=this,t=this.lexer.peek(1).getLocation();if(!this.hasTag(m.End)){var n=new g(this.parseProtocolTerm());return this.loop((function(){return e.hasTag(m.Pipe)}),(function(){e.expectConsumeFixToken(m.Pipe),n.push(e.parseProtocolTerm())})),new nn(t,n)}}},{key:"parseProtocol",value:function(){var e=this.lexer.peek(1).getLocation(),t=this.parseProtocolExpression();return new tn(void 0===t?e:b.merge(e,t.getLocation()),t)}},{key:"parseInterface",value:function(){var e=this.lexer.peek(1).getLocation();this.expectConsumeFixToken(m.Interface);var t=this.parseName();this.expectConsumeFixToken(m.Semicolon);var n=this.parseProtocol(),i=this.consumeEnd(t);return new en(b.merge(e,i),t,n)}},{key:"parse",value:function(){var e=this,t=this.lexer.peek(1).getLocation(),n=new Array,i=new Array,r=!1;this.loop((function(){return!r}),(function(){if(e.isComponent()){var t=e.parseComponent();void 0!==t&&n.push(t)}else if(e.isInterface()){var a=e.parseInterface();void 0!==a&&i.push(a)}else e.error("Invalid top level node."),r=!0}));var a=this.lexer.peek(1).getLocation();return new gn(b.merge(t,a),n,i)}}]),e}();!function(e){e[e.Tag=0]="Tag"}(ni||(ni={}));var ri,ai=function e(){Object(i.a)(this,e),this._globalScopeSymbolTag=ni.Tag},si=function e(t){Object(i.a)(this,e),this.scope=t},oi=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).name=r,a}return n}(si),ci=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).identifier=r,a}return n}(si);!function(e){e[e.Tag=0]="Tag"}(ri||(ri={}));var ui,li=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._blockScopeSymbolTag=ri.Tag,e}return n}(si),hi=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e)).interfaceSymbol=r,a}return n}(si);!function(e){e[e.Tag=0]="Tag"}(ui||(ui={}));var fi,vi=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._typeSymbolTag=ui.Tag,e}return n}(ci),pi=function e(t,n){Object(i.a)(this,e),this.identifier=t,this.type=n},gi=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s){var o;return Object(i.a)(this,n),(o=t.call(this,e,r)).parameters=a,o.returnType=s,o}return n}(vi);!function(e){e[e.Tag=0]="Tag"}(fi||(fi={}));var mi,di=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._builtInTypeSymbol=fi.Tag,e}return n}(vi);!function(e){e[e.Tag=0]="Tag"}(mi||(mi={}));var yi,bi=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.apply(this,arguments))._interfaceSymbolTag=mi.Tag,e}return n}(vi);!function(e){e[e.Tag=0]="Tag"}(yi||(yi={}));var ki,Ti=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s){var o;return Object(i.a)(this,n),(o=t.call(this,e,r)).genericType=a,o.isEntryPoint=s,o._componentSymbolTag=yi.Tag,o}return n}(vi);!function(e){e[e.Tag=0]="Tag"}(ki||(ki={}));var wi,Oi=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this,e,"@@@__ANY__GENERIC_COMPONENT__@@@",r,!1))._genericComponentSymbolTag=ki.Tag,a}return n}(Ti),Ei=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this,e,r)).parameters=a,s}return n}(vi),xi=function e(t,n){Object(i.a)(this,e),this.interfaceSymbol=t,this.cardinality=n},Ci=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;if(Object(i.a)(this,e),this.min=t,this.max=n,t<1)throw new Error("cardinality must be greater 0");if(void 0!==n&&n<t)throw new Error("min ".concat(t," must be greater than max ").concat(n))}return Object(r.a)(e,[{key:"unlimited",value:function(){return this.max===1/0}}]),e}(),Si=function(){function e(t,n){Object(i.a)(this,e),this.offered=t,this.required=n,e.validate(this.offered,"Offered interface defined multiple times."),e.validate(this.required,"Required interface defined multiple times.")}return Object(r.a)(e,[{key:"canBeSubstitutedBy",value:function(t){return e.matchInterfaceDeclarations(this.offered,t.offered,(function(e,t){return e>=t}),(function(e,t){return e>=t}))&&e.matchInterfaceDeclarations(this.required,t.required,(function(e,t){return e<=t}),(function(e,t){return e<=t}))}},{key:"canSubstitute",value:function(e){return e.canBeSubstitutedBy(this)}}],[{key:"validate",value:function(e,t){if(Object(a.a)(Array,o(new Set(e.map((function(e){return e.interfaceSymbol.identifier}))))).length!==e.length)throw new Error(t)}},{key:"matchInterfaceDeclarations",value:function(e,t,n,i){return e.filter((function(e){return void 0!==t.find((function(t){return e.interfaceSymbol===t.interfaceSymbol&&i(e.cardinality.max,t.cardinality.max)&&n(e.cardinality.min,t.cardinality.min)}))})).length===e.length}}]),e}(),ji=function e(t,n,r){Object(i.a)(this,e),this.scope=t,this.searchGlobalScope=n,this.searchParentScope=r},Ii=function(){function e(){Object(i.a)(this,e),this.globalScope=new ai,this.voidType=new di(this.globalScope,"@@@__VOID__@@@"),this.anyRequiredInterfaceType=new bi(this.globalScope,"@@@__ANY_REQUIRED_INTERFACE__@@@"),this.anyGenericComponentType=new Si([],[]),this.anyComponentType=new Ti(this.globalScope,"@@@__ANY_COMPONENT__@@@",this.anyGenericComponentType,!1),this.anyMessage=new Ei(this.globalScope,"ANY",[]),this.finishMessage=new Ei(this.globalScope,"FINISH",[]),this.symbolToDeclaration=new Map,this.symbolToImplementation=new Map,this.symbolToComponent=new Map,this.symbolToInterface=new Map,this.expressionToSymbol=new Map,this.typeToSymbol=new Map,this.designatorToSymbol=new Map,this.variableToSymbol=new Map,this.callToSymbol=new Map,this.sendReceiveToSymbol=new Map,this.patternToSymbol=new Map,this.componentToSymbol=new Map,this.messageToSymbol=new Map,this.implementationToSymbol=new Map,this.procedureToSymbol=new Map,this.interfaceToSymbol=new Map,this.types=new Array,this.builtins=new Array,this.components=new Array,this.interfaces=new Array,this.messages=new Array,this.constants=new Array,this.procedures=new Array,this.impplementations=new Array,this.variables=new Array,this.collectionVariables=new Array}return Object(r.a)(e,[{key:"getMessages",value:function(e){return this.messages.filter((function(t){return t.scope===e}))}},{key:"getSystemProcedures",value:function(){var e=this;return this.procedures.filter((function(t){return t.scope===e.globalScope}))}},{key:"getProcedures",value:function(e){return this.procedures.filter((function(t){return t.scope===e}))}},{key:"getImplementations",value:function(e){return this.impplementations.filter((function(t){return t.scope===e}))}},{key:"getVariables",value:function(e){return this.variables.filter((function(t){return t.scope===e}))}},{key:"getCollectionVariables",value:function(e){return this.collectionVariables.filter((function(t){return t.scope===e}))}},{key:"registerBuiltIns",value:function(e){this.builtins.push(e),this.types.push(e)}},{key:"registerComponent",value:function(e){this.components.push(e),this.types.push(e)}},{key:"registerInterface",value:function(e){this.interfaces.push(e),this.types.push(e)}},{key:"registerMessage",value:function(e){this.messages.push(e),this.types.push(e)}},{key:"registerProcedure",value:function(e){this.procedures.push(e)}},{key:"registerImplementation",value:function(e){this.impplementations.push(e)}},{key:"registerVariable",value:function(e){this.variables.push(e)}},{key:"registerCollectionVariable",value:function(e){this.collectionVariables.push(e)}},{key:"getOrThrow",value:function(e){if(void 0===e)throw new Error("Item was undefined.");return e}},{key:"getFirstOrThrow",value:function(e){if(e.length<1)throw Error("Data containted no element.");if(e.length>1)throw Error("Data contained more than one element.");return e[0]}},{key:"findBuiltIn",value:function(e){return this.builtins.filter((function(t){return t.identifier===e}))}},{key:"findProcedure",value:function(e,t,n,i){var r=this;return this.findInComponent(this.procedures,function(i,a){return i.identifier===e&&i.parameters.length===t.length&&i.parameters.filter((function(e,n){return r.isAssignable(e,t[n])})).length===t.length&&(void 0===n||i.returnType===n)&&i.scope===a}.bind(this),i)}},{key:"isAssignable",value:function(e,t){return e instanceof Ti&&t instanceof Ti?e.genericType.canBeSubstitutedBy(t.genericType):e===t}},{key:"findInComponent",value:function(e,t,n){if(!n.searchGlobalScope&&n.scope instanceof ai)return new Array;var i=e.filter((function(e){return t(e,n.scope)}));return i.length>0||n.scope instanceof ai||!n.searchGlobalScope&&n.scope.scope instanceof ai?i:!n.searchParentScope&&(n.scope instanceof Ti||n.scope instanceof bi)?n.searchGlobalScope?this.findInComponent(e,t,new ji(this.globalScope,n.searchGlobalScope,n.searchParentScope)):i:this.findInComponent(e,t,new ji(n.scope.scope,n.searchGlobalScope,n.searchParentScope))}},{key:"findNameInScope",value:function(e,t,n){return this.findInComponent(e,function(e,n){return e.identifier===t&&e.scope===n}.bind(this),n)}},{key:"findVariable",value:function(e,t){return this.findNameInScope(this.variables,e,t)}},{key:"findMessage",value:function(e,t,n,i){var r=this;return this.findInComponent(this.messages,function(i,a){return i.identifier===e&&i.scope===a&&(t||i.parameters.length===n.length&&i.parameters.filter((function(e,t){return r.isAssignable(e,n[t])})).length===n.length)}.bind(this),i)}},{key:"findCollectionVariable",value:function(e,t,n,i){var r=this;return this.findInComponent(this.collectionVariables,function(i,a){return i.identifier===e&&(t||i.parameters.length===n.length&&i.parameters.filter((function(e,t){return r.isAssignable(e,n[t])})).length===n.length)&&i.scope===a}.bind(this),i)}},{key:"findComponent",value:function(e,t){return this.findNameInScope(this.components,e,t)}},{key:"findInterface",value:function(e,t){return this.findNameInScope(this.interfaces,e,t)}},{key:"findType",value:function(e,t){return this.findNameInScope(this.types,e,t)}},{key:"findImplementation",value:function(e,t){return this.findInComponent(this.impplementations,function(t,n){return t.interfaceSymbol.identifier===e&&t.scope===n}.bind(this),t)}}],[{key:"componentSatisfiesGeneric",value:function(e,t){return 0===t.offered.length&&0===t.required.length||t.canBeSubstitutedBy(e.genericType)}}]),e}(),Li=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s){var o;return Object(i.a)(this,n),(o=t.call(this,e,r)).mutable=a,o.type=s,o}return n}(ci),Ai=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a,s){var o;return Object(i.a)(this,n),(o=t.call(this,e,r)).type=a,o.parameters=s,o}return n}(ci),Pi=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this)).symbolTable=e,a.scope=r,a}return Object(r.a)(n,[{key:"visitBasicType",value:function(e){var t=this.symbolTable.findType(e.getIdentifier(),new ji(this.scope,!0,!0));if(t.length<1)throw new Error("Failed to find type for basic type: ".concat(e.getIdentifier(),", no type found."));if(t.length>1)throw new Error("Failed to find type for basic type: ".concat(e.getIdentifier(),", multiple definitions found."));this.symbolTable.typeToSymbol.set(e,t[0])}},{key:"visitAnyType",value:function(e){var t=this,n=new Oi(this.scope,new Si(e.getOffered().map((function(e){return Wi.createInterfaceDeclarationSymbol(t.symbolTable,e,t.scope)})),e.getRequired().map((function(e){return Wi.createInterfaceDeclarationSymbol(t.symbolTable,e,t.scope)}))));this.symbolTable.typeToSymbol.set(e,n)}}]),n}(ti),Fi=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this)).symbolTable=e,a.scope=r,a}return Object(r.a)(n,[{key:"getType",value:function(e){var t=this.symbolTable.expressionToSymbol.get(e);return this.symbolTable.getOrThrow(t)}},{key:"getBuiltIn",value:function(e){return this.symbolTable.getFirstOrThrow(this.symbolTable.findBuiltIn(e))}},{key:"visitAttributes",value:function(e){var t=this;e.forEach((function(e){return e.accept(t)}))}},{key:"visitConstantExpression",value:function(e){e.getExpression().accept(this)}},{key:"visitUnaryExpression",value:function(e){e.getExpression().accept(this),this.symbolTable.expressionToSymbol.set(e,this.getType(e.getExpression()))}},{key:"visitBinaryExpression",value:function(e){e.getLeft().accept(this),e.getRight().accept(this);var t=this.getType(e.getLeft()),n=this.getType(e.getRight());if(this.checkChainMatch(t,n),!(t instanceof di))throw new Error("Cannot compare non number values.");var i=t.identifier;switch(e.getOp()){case st.Equal:case st.NotEqual:if("REAL"!==i&&"INTEGER"!==i&&"BOOLEAN"!==i&&"CHARACTER"!==i&&"TEXT"!==i)throw new Error("Cannot compare non number values.");break;case st.Less:case st.LessEqual:case st.More:case st.MoreEqual:if("REAL"!==i&&"INTEGER"!==i&&"CHARACTER"!==i&&"TEXT"!==i)throw new Error("Cannot compare non number values.")}this.symbolTable.expressionToSymbol.set(e,this.getBuiltIn("BOOLEAN"))}},{key:"visitOffersRequiresExpression",value:function(e){var t=this;this.visitAttributes(e.getAttributes()),e.getInterfaces().forEach((function(e){return e.accept(t)})),this.symbolTable.expressionToSymbol.set(e,this.getBuiltIn("BOOLEAN"))}},{key:"visitTypeCheck",value:function(e){this.visitAttributes(e.getAttributes()),e.getDesignator().accept(this),e.getType().accept(this),this.symbolTable.expressionToSymbol.set(e,this.getBuiltIn("BOOLEAN"))}},{key:"visitUnaryTermNode",value:function(e){e.getTerm().accept(this);var t=this.getType(e.getTerm());if(!(t instanceof di))throw new Error("Cannot apply unary + - op to non builtin type.");var n=t.identifier;switch(e.getOp()){case pt.Minus:case pt.Plus:if("REAL"!==n&&"INTEGER"!==n)throw new Error("Cannot apply + - to non numbers types.")}this.symbolTable.expressionToSymbol.set(e,this.getType(e.getTerm()))}},{key:"checkChainMatch",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r=Object(a.a)(Array,o(new Set(n)));if(r.length<1)throw new Error("Failed right factor type lookup.");if(r.length>1)throw new Error("Ambiguous right factor type lookup.");if(r[0]!==e)throw new Error("Factor type missmatch. Left: ".concat(e.identifier,", Right: ").concat(r[0].identifier))}},{key:"getChainTypes",value:function(e){var t=this;return e.getRight().map((function(e){return t.getType(e.getRight())}))}},{key:"visitChain",value:function(e){var t=this;e.getLeft().accept(this),e.getRight().forEach((function(e){return e.accept(t)}));var n=this.getType(e.getLeft());this.checkChainMatch.apply(this,[n].concat(o(this.getChainTypes(e)))),this.symbolTable.expressionToSymbol.set(e,n)}},{key:"visitTermChain",value:function(e){this.visitChain(e)}},{key:"visitRightTerm",value:function(e){e.getRight().accept(this)}},{key:"visitFactorChain",value:function(e){this.visitChain(e)}},{key:"visitRightFactor",value:function(e){e.getRight().accept(this)}},{key:"visitUnaryFactor",value:function(e){e.getFactor().accept(this);var t=this.getType(e.getFactor());if(!(t instanceof di))throw new Error("Cannot apply unary not op to non builtin type.");switch(e.getPrefix()){case Ct.Not:if("BOOLEAN"!==t.identifier)throw new Error("Cannot apply not op to non boolean types.")}this.symbolTable.expressionToSymbol.set(e,this.getType(e.getFactor()))}},{key:"visitExpressionFactor",value:function(e){e.getExpression().accept(this),this.symbolTable.expressionToSymbol.set(e,this.getType(e.getExpression()))}},{key:"visitIntegerNumber",value:function(e){this.symbolTable.expressionToSymbol.set(e,this.getBuiltIn("INTEGER"))}},{key:"visitRealNumber",value:function(e){this.symbolTable.expressionToSymbol.set(e,this.getBuiltIn("REAL"))}},{key:"visitConstantCharacter",value:function(e){this.symbolTable.expressionToSymbol.set(e,this.getBuiltIn("CHARACTER"))}},{key:"visitText",value:function(e){this.symbolTable.expressionToSymbol.set(e,this.getBuiltIn("TEXT"))}},{key:"getPatternName",value:function(e){if(e instanceof ln)return e.getName();switch(e){case Rt.Any:return this.symbolTable.anyMessage.identifier;case Rt.Finish:return this.symbolTable.finishMessage.identifier;default:throw new Error("Unknown message!")}}},{key:"visitMessageTest",value:function(e){var t;this.symbolTable.expressionToSymbol.set(e,this.getBuiltIn("BOOLEAN")),null===(t=e.getDesignator())||void 0===t||t.accept(this);var n=e.getDesignator(),i=void 0!==n?this.symbolTable.getOrThrow(this.symbolTable.designatorToSymbol.get(n)):void 0,r=e.getPattern();"task"===(null===i||void 0===i?void 0:i.identifier)&&console.log(e);var a=Ni.getMessage(this.symbolTable,this.scope,e.getDesignator(),this.getPatternName(r),!0,[]);this.symbolTable.patternToSymbol.set(r,a)}},{key:"visitReceiveTest",value:function(e){this.visitMessageTest(e)}},{key:"visitInputTest",value:function(e){this.visitMessageTest(e)}},{key:"visitExistsTest",value:function(e){var t;this.symbolTable.expressionToSymbol.set(e,this.getBuiltIn("BOOLEAN")),null===(t=e.getDesignator())||void 0===t||t.accept(this)}},{key:"visitFunctionCall",value:function(e){var t=this;e.getArguments().forEach((function(e){return e.accept(t)}));var n=e.getArguments().map((function(e){return t.getType(e)})),i=this.symbolTable.getFirstOrThrow(this.symbolTable.findProcedure(e.getName().getName(),n,void 0,new ji(this.scope,!0,!1)));this.symbolTable.expressionToSymbol.set(e,i.returnType),this.symbolTable.callToSymbol.set(e,i)}},{key:"getProcedureParam",value:function(e){for(var t=this.scope;!(t instanceof gi)&&t instanceof ci;)t=t.scope;if(!(t instanceof gi))throw new Error("".concat(e," is not a procedure parameter."));var n=this.symbolTable.getFirstOrThrow(this.symbolTable.findVariable(e,new ji(t,!1,!1)));if(!(n.scope instanceof gi))throw new Error("Found ".concat(e," outside procedure param."));return n}},{key:"visitBasicDesignator",value:function(e){var t=e.getName().getName();try{var n=Ni.getVariable(this.symbolTable,e.getName().getName(),new ji(this.scope,!1,!0));return this.symbolTable.expressionToSymbol.set(e,n.type),void this.symbolTable.designatorToSymbol.set(e,n)}catch(c){}try{var i=this.symbolTable.getFirstOrThrow(this.symbolTable.constants.filter((function(e){return e.identifier===t})));return this.symbolTable.expressionToSymbol.set(e,i.type),void this.symbolTable.designatorToSymbol.set(e,i.type)}catch(c){}try{var r=this.symbolTable.getFirstOrThrow(this.symbolTable.findInterface(t,new ji(this.scope,!0,!0)));return this.symbolTable.expressionToSymbol.set(e,r),void this.symbolTable.designatorToSymbol.set(e,r)}catch(c){}try{var a=this.symbolTable.getFirstOrThrow(this.symbolTable.findComponent(t,new ji(this.scope,!0,!0)));return this.symbolTable.expressionToSymbol.set(e,a),void this.symbolTable.designatorToSymbol.set(e,a)}catch(c){}try{var s=this.symbolTable.getFirstOrThrow(this.symbolTable.findCollectionVariable(t,!0,[],new ji(this.scope,!0,!1)));return this.symbolTable.expressionToSymbol.set(e,s.type),void this.symbolTable.designatorToSymbol.set(e,s)}catch(c){}try{var o=this.getProcedureParam(t);return this.symbolTable.expressionToSymbol.set(e,o.type),void this.symbolTable.designatorToSymbol.set(e,o)}catch(c){}throw new Error("Failed designator type lookup for '".concat(t,"'."))}},{key:"visitBasicExpressionDesignator",value:function(e){var t=e.getName().getName();try{var n=this.symbolTable.getFirstOrThrow(this.symbolTable.findCollectionVariable(t,!0,new Array,new ji(this.scope,!1,!0)));return this.symbolTable.expressionToSymbol.set(e,n.type),void this.symbolTable.designatorToSymbol.set(e,n)}catch(r){}try{var i=this.symbolTable.getFirstOrThrow(this.symbolTable.findInterface(t,new ji(this.scope,!0,!0)));return this.symbolTable.expressionToSymbol.set(e,i),void this.symbolTable.designatorToSymbol.set(e,i)}catch(r){}throw new Error("Failed designator type lookup for '".concat(t,"'."))}},{key:"visitBaseTargetDesignator",value:function(e){var t=e.getBase(),n=e.getTarget();if(n.accept(this),t instanceof Yt){var i=t.getName().getName();try{var r=Ni.getProcedure(i,this.symbolTable,new Array(this.getType(n)),void 0,new ji(this.scope,!0,!1));return this.symbolTable.expressionToSymbol.set(t,r),this.symbolTable.designatorToSymbol.set(e,r),void this.symbolTable.expressionToSymbol.set(e,r.returnType)}catch(s){}}t.accept(this);var a=this.getType(t);this.symbolTable.expressionToSymbol.set(e,a),this.symbolTable.designatorToSymbol.set(e,a)}},{key:"visitDesignatorType",value:function(e){e.getDesignator().accept(this),e.getType().accept(new Pi(this.symbolTable,this.scope))}}]),n}(ti),Ni=function(){function e(){Object(i.a)(this,e)}return Object(r.a)(e,null,[{key:"checkNotConstantSymbol",value:function(e,t){if(0!==t.constants.filter((function(t){return t.identifier===e})).length)throw new Error("".concat(e," is a constant variable!"))}},{key:"getComponent",value:function(e,t,n){this.checkNotConstantSymbol(t,e);var i=e.findComponent(t,n);if(i.length>1)throw new Error("Component ".concat(t," defined ").concat(i.length," times in the same scope."));if(i.length<1)throw new Error("No component ".concat(t," found."));return i[0]}},{key:"getInterface",value:function(e,t,n){this.checkNotConstantSymbol(t,e);var i=e.findInterface(t,n);if(i.length>1)throw new Error("Interface ".concat(t," defined ").concat(i.length," times in the same scope."));if(i.length<1)throw new Error("No interface ".concat(t," found."));return i[0]}},{key:"getImplementation",value:function(e,t,n){if(this.checkNotConstantSymbol(t,e),!(n.scope instanceof Ti))throw new Error("Failed to locate ".concat(t,", must be inside a component."));var i=e.findImplementation(t,n);if(i.length>1)throw new Error("Implementaiton ".concat(t," defined ").concat(i.length," times in the same scope."));if(i.length<1)throw new Error("No implementation ".concat(t," found."));return i[0]}},{key:"getConstant",value:function(e,t){var n=e.constants.filter((function(e){return e.identifier===t}));if(n.length>1)throw new Error("Found ".concat(t," multiple times."));if(n.length<1)throw new Error("Failed to find ".concat(t,"."));return n[0]}},{key:"getVariable",value:function(e,t,n){var i=e.findVariable(t,n);if(i.length>1)throw new Error("Found ".concat(t," multiple times."));if(i.length<1)throw new Error("Failed to find ".concat(t,"."));return i[0]}},{key:"getProcedureParam",value:function(e,t,n){for(;!(t instanceof gi)&&t instanceof ci;)t=t.scope;if(!(t instanceof gi))throw new Error("".concat(n," is not a procedure parameter."));var i=this.getVariable(e,n,new ji(t,!1,!1));if(!(i.scope instanceof gi))throw new Error("Found ".concat(n," outside procedure param."));return i}},{key:"getProcedure",value:function(e,t,n,i,r){this.checkNotConstantSymbol(e,t);var a=t.findProcedure(e,n,i,r);if(a.length>1)throw new Error("Procedure ".concat(e," defined ").concat(a.length," times in the same scope."));if(a.length<1)throw new Error("No procedure ".concat(e," found."));return a[0]}},{key:"getProcedureFromNode",value:function(t,n,i){var r=t.getName().getName();this.checkNotConstantSymbol(r,n);var a=n.voidType,s=t.getType();if(void 0!==s){s.accept(new Pi(n,i.scope));var o=n.typeToSymbol.get(s);if(void 0===o)throw new Error("Failed to find procedure ".concat(r," return type."));a=o}var c=e.convertParamTypes(n,i.scope,t.getParams().map((function(e){return e.getParameter()})));return this.getProcedure(r,n,c,a,i)}},{key:"getTypeType",value:function(e,t){var n=e.typeToSymbol.get(t);if(void 0===n)throw new Error("Type node type lookup failed.");return n}},{key:"convertParamTypes",value:function(e,t,n){var i=this;return n.flatMap((function(n){n.getType().accept(new Pi(e,t));var r=i.getTypeType(e,n.getType());return n.getNames().map((function(){return r}))}))}},{key:"getMessageInImplentation",value:function(e,t,n,i,r){for(;!(t instanceof hi);){if(t instanceof ai)throw new Error("Failed message lookup for ".concat(n,"."));t=t.scope}var a=e.findMessage(n,i,r,new ji(t.interfaceSymbol,!1,!1));if(a.length>1)throw new Error("Ambiguous message lookup for ".concat(n,"."));if(a.length<1)throw new Error("Message lookup failed for ".concat(n,"."));return a[0]}},{key:"getMessage",value:function(e,t,n,i,r,a){var s=a.map((function(n){n.accept(new Fi(e,t));var i=e.expressionToSymbol.get(n);if(void 0===i)throw new Error("Failed argument type lookup.");return i}));if(null===n||void 0===n||n.accept(new Fi(e,t)),void 0!==n){var c=e.expressionToSymbol.get(n),u=new Array;if(c instanceof Ti)u.push.apply(u,o(c.genericType.offered.map((function(e){return e.interfaceSymbol})).flatMap((function(t){return e.findMessage(i,r,s,new ji(t,!1,!1))}))));else{if(!(c instanceof bi))throw new Error("Failed interface lookup for ".concat(i,"."));u.push.apply(u,o(e.findMessage(i,r,s,new ji(c,!1,!1))))}if(u.length>1)throw new Error("Ambigious message lookup for ".concat(i,"."));if(u.length<1)throw new Error("Message lookup failed for ".concat(i,"."));return u[0]}return this.getMessageInImplentation(e,t,i,r,s)}}]),e}(),Ri=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this)).symbolTable=e,a.scope=r,a}return Object(r.a)(n,[{key:"visitComponent",value:function(e){var t=this,n=e.getName().getName(),i=e.getAttributes(),r=new Ti(this.scope,n,new Si(e.getOffers().map((function(e){return Wi.createInterfaceDeclarationSymbol(t.symbolTable,e,t.scope)})),e.getRequires().map((function(e){return Wi.createInterfaceDeclarationSymbol(t.symbolTable,e,t.scope)}))),i.filter((function(e){return"ENTRYPOINT"===e.getName().getName()})).length>0);try{throw Ni.getComponent(this.symbolTable,n,new ji(this.scope,!1,!1)),new Error("Duplicate component ".concat(n," detected,"))}catch(a){}if(r.isEntryPoint&&!this.isEntryPoint(r))throw new Error("Marked entrypoint component ".concat(n,", requires at least one non system interfaces to be connected."));this.symbolTable.registerComponent(r),this.symbolTable.symbolToComponent.set(r,e),this.symbolTable.componentToSymbol.set(e,r)}},{key:"isEntryPoint",value:function(e){var t=this,n=e.genericType.required;return 0===n.length||n.map((function(e){return t.isSystemInterface(e.interfaceSymbol.identifier)})).reduce((function(e,t){return e&&t}),!0)}},{key:"isSystemInterface",value:function(e){switch(e){case"SystemTime":case"FileSystem":case"GraphicView":return!0;default:return!1}}}]),n}(ti),Di=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this)).symbolTable=e,a.scope=r,a}return Object(r.a)(n,[{key:"visitInterface",value:function(e){var t=e.getName().getName(),n=new bi(this.scope,t);try{throw this.symbolTable.getFirstOrThrow(this.symbolTable.findInterface(t,new ji(this.scope,!1,!1))),new Error("Duplicate interface ".concat(t," detected."))}catch(i){}this.symbolTable.registerInterface(n),this.symbolTable.symbolToInterface.set(n,e),this.symbolTable.interfaceToSymbol.set(e,n)}}]),n}(ti),Mi=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this)).symbolTable=e,a.scope=r,a}return Object(r.a)(n,[{key:"visitProtocol",value:function(e){var t;null===(t=e.getExpression())||void 0===t||t.accept(this)}},{key:"visitProtocolTerm",value:function(e){var t=this;e.getFactors().forEach((function(e){return e.accept(t)}))}},{key:"visitMessageDeclaration",value:function(e){var t=this,n=e.getName().getName(),i=e.getParams().flatMap((function(e){e.getType().accept(new Pi(t.symbolTable,t.scope));var i=t.symbolTable.typeToSymbol.get(e.getType());if(void 0===i)throw new Error("Type lookup for message '".concat(n,"' param failed."));return e.getNames().map((function(){return i}))})),r=new Ei(this.scope,n,i);this.symbolTable.registerMessage(r),this.symbolTable.messageToSymbol.set(e,r)}},{key:"visitOptionalProtocolFactorExpression",value:function(e){e.getExpression().accept(this)}},{key:"visitGroupProtocolFactorExpression",value:function(e){e.getExpression().accept(this)}},{key:"visitRepeatingProtocolFactorExpression",value:function(e){e.getExpression().accept(this)}},{key:"visitProtocolExpression",value:function(e){var t=this;e.getTerms().forEach((function(e){return e.accept(t)}))}}]),n}(ti),Bi=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this)).symbolTable=e,a.scope=r,a}return Object(r.a)(n,[{key:"visitProcedure",value:function(e){var t=this,n=e.getName().getName(),i=Ni.convertParamTypes(this.symbolTable,this.scope,e.getParams().map((function(e){return e.getParameter()}))),r=this.symbolTable.voidType,a=e.getType();if(void 0!==a){a.accept(new Pi(this.symbolTable,this.scope));var s=this.symbolTable.typeToSymbol.get(a);if(void 0===s)throw new Error("Failed to find procedure return type for ".concat(n,"."));r=s}try{throw Ni.getProcedureFromNode(e,this.symbolTable,new ji(this.scope,!1,!1)),new Error("Duplicate procedure detected.")}catch(c){}var o=new gi(this.scope,n,i,r);e.getParams().forEach((function(e){var n=e.getParameter();n.getNames().forEach((function(i){return t.symbolTable.registerVariable(new Li(o,i.getName(),e.isMutable(),Ni.getTypeType(t.symbolTable,n.getType())))}))})),this.symbolTable.registerProcedure(o),this.symbolTable.procedureToSymbol.set(e,o)}}]),n}(ti),Vi=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this)).symbolTable=e,a.scope=r,a}return Object(r.a)(n,[{key:"visitImplementation",value:function(e){var t=e.getName().getName(),n=this.scope.genericType.offered.filter((function(e){return e.interfaceSymbol.identifier===t})).map((function(e){return e.interfaceSymbol}));if(1!==n.length)throw new Error("Could not find interface for '".concat(t,"' implementation."));try{throw Ni.getImplementation(this.symbolTable,t,new ji(this.scope,!1,!1)),new Error("Duplicate '".concat(t,"' implementation detected."))}catch(r){}var i=new hi(this.scope,n[0]);this.symbolTable.registerImplementation(i),this.symbolTable.symbolToImplementation.set(i,e),this.symbolTable.implementationToSymbol.set(e,i)}}]),n}(ti),qi=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this)).symbolTable=e,a.scope=r,a}return Object(r.a)(n,[{key:"visitConstant",value:function(e){var t=e.getName().getName();e.getExpression().accept(new Fi(this.symbolTable,this.scope));var n=this.symbolTable.getOrThrow(this.symbolTable.expressionToSymbol.get(e.getExpression().getExpression())),i=new Li(this.scope,t,!1,n);this.symbolTable.registerVariable(i),this.symbolTable.variableToSymbol.set(e,i)}},{key:"visitConstantList",value:function(e){var t=this;e.getConstants().forEach((function(e){return e.accept(t)}))}}]),n}(ti),_i=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this)).symbolTable=e,a.scope=r,a}return Object(r.a)(n,[{key:"visitVariable",value:function(e){var t=this;e.getType().accept(new Pi(this.symbolTable,this.scope));var n=this.symbolTable.typeToSymbol.get(e.getType());if(void 0===n)throw new Error("".concat(e.getNames()[0].getName(),": Unknown type."));e.getNames().forEach((function(i){var r=i.getName();if(n instanceof di&&"TEXT"===n.identifier)t.symbolTable.registerCollectionVariable(new Ai(t.scope,r,n,new Array(t.symbolTable.getFirstOrThrow(t.symbolTable.findBuiltIn("INTEGER")))));else{if(0===i.getParams().length){var a=new Li(t.scope,r,!0,n);return t.symbolTable.registerVariable(a),void t.symbolTable.variableToSymbol.set(e,a)}t.symbolTable.registerCollectionVariable(new Ai(t.scope,r,n,Ni.convertParamTypes(t.symbolTable,t.scope,i.getParams())))}}))}},{key:"visitVariableList",value:function(e){var t=this;e.getVariables().forEach((function(e){return e.accept(t)}))}}]),n}(ti),Ui=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this)).symbolTable=e,a.scope=r,a}return Object(r.a)(n,[{key:"visitProgram",value:function(e){var t=this;e.getInterfaces().forEach((function(e){return e.accept(new Di(t.symbolTable,t.scope))})),e.getComponents().forEach((function(e){return e.accept(new Ri(t.symbolTable,t.scope))})),e.getInterfaces().forEach((function(e){return e.accept(new n(t.symbolTable,t.scope))})),e.getComponents().forEach((function(e){return e.accept(new n(t.symbolTable,t.scope))}))}},{key:"visitComponent",value:function(e){var t,i=e.getName().getName(),r=this.symbolTable.findComponent(i,new ji(this.scope,!1,!1));if(1!==r.length)throw new Error("Failed lookup for component ".concat(i,"."));null===(t=e.getBody())||void 0===t||t.accept(new n(this.symbolTable,r[0]))}},{key:"visitInterface",value:function(e){var t=e.getName().getName(),n=this.symbolTable.findInterface(t,new ji(this.scope,!1,!1));if(1!==n.length)throw new Error("Failed to lookup interface ".concat(t,"."));e.getProtocol().accept(new Mi(this.symbolTable,n[0]))}},{key:"visitProtocol",value:function(e){var t;null===(t=e.getExpression())||void 0===t||t.accept(new Mi(this.symbolTable,this.scope))}},{key:"visitProcedure",value:function(e){var t=Ni.getProcedureFromNode(e,this.symbolTable,new ji(this.scope,!1,!1));this.registerLayer(e.getDeclarations(),t)}},{key:"registerLayer",value:function(e,t,i,r){var a=this,s=e.filter((function(e){return e instanceof Ze})).map((function(e){return e})),o=e.filter((function(e){return e instanceof en})).map((function(e){return e})),c=e.filter((function(e){return e instanceof vn})).map((function(e){return e})),u=e.filter((function(e){return e instanceof ei})).map((function(e){return e})),l=e.filter((function(e){return e instanceof it})).map((function(e){return e}));o.forEach((function(e){return e.accept(new Di(a.symbolTable,t))})),s.forEach((function(e){return e.accept(new Ri(a.symbolTable,t))})),c.forEach((function(e){return e.accept(new Bi(a.symbolTable,t))})),u.forEach((function(e){return e.accept(new _i(a.symbolTable,t))})),l.forEach((function(e){return e.accept(new qi(a.symbolTable,t))})),void 0!==i&&i(),o.forEach((function(e){return e.accept(new n(a.symbolTable,t))})),s.forEach((function(e){return e.accept(new n(a.symbolTable,t))})),c.forEach((function(e){return e.accept(new n(a.symbolTable,t))})),void 0!==r&&r(new n(this.symbolTable,t))}},{key:"visitImplementation",value:function(e){var t=e.getName().getName();if(!(this.scope instanceof Ti))throw new Error("Implementation must be in a component scope!");var n=this.symbolTable.findImplementation(t,new ji(this.scope,!1,!1));if(1!==n.length)throw new Error("Failed to lookup interface ".concat(t,"."));this.registerLayer(e.getDeclarations(),n[0])}},{key:"visitComponentBody",value:function(e){var t=this;if(!(this.scope instanceof Ti))throw new Error("Component body must be a component scope!");var n=this.scope;this.registerLayer(e.getDeclarations(),n,(function(){e.getImplementations().forEach((function(e){return e.accept(new Vi(t.symbolTable,n))}))}),(function(t){e.getImplementations().forEach((function(e){return e.accept(t)}))}))}}]),n}(ti),Wi=function(){function e(t,n){Object(i.a)(this,e),this.symbolTable=t,this.programScope=n;var r=new di(this.symbolTable.globalScope,"BOOLEAN"),a=new di(this.symbolTable.globalScope,"CHARACTER"),s=new di(this.symbolTable.globalScope,"TEXT"),o=new di(this.symbolTable.globalScope,"INTEGER"),c=new di(this.symbolTable.globalScope,"REAL");this.builtInTypes=new Array(r,a,s,o,c),this.constants=new Map([["TRUE",r],["FALSE",r],["PI",c]]),this.variables=new Map([["TIME",o]]),this.systemProcedures=new Array(["ASSERT",[this.symbolTable.voidType,new Array(r)]],["ASSERT",[this.symbolTable.voidType,new Array(r,o)]],["HALT",[this.symbolTable.voidType,new Array(o)]],["INC",[this.symbolTable.voidType,new Array(o)]],["INC",[this.symbolTable.voidType,new Array(o,o)]],["DEC",[this.symbolTable.voidType,new Array(o)]],["DEC",[this.symbolTable.voidType,new Array(o,o)]],["PASSIVATE",[this.symbolTable.voidType,new Array(o)]],["WRITE",[this.symbolTable.voidType,new Array(s)]],["WRITE",[this.symbolTable.voidType,new Array(o)]],["WRITE",[this.symbolTable.voidType,new Array(c)]],["WRITE",[this.symbolTable.voidType,new Array(a)]],["WRITEHEX",[this.symbolTable.voidType,new Array(o)]],["WRITELINE",[this.symbolTable.voidType,new Array]],["NEW",[this.symbolTable.voidType,new Array(this.symbolTable.anyComponentType)]],["NEW",[this.symbolTable.voidType,new Array(o)]],["NEW",[this.symbolTable.voidType,new Array(o,o)]],["NEW",[this.symbolTable.voidType,new Array(o,o,o)]],["DELETE",[this.symbolTable.voidType,new Array(this.symbolTable.anyComponentType)]],["COUNT",[o,new Array(this.symbolTable.anyRequiredInterfaceType)]],["LENGTH",[o,new Array(s)]],["SQRT",[c,new Array(c)]],["SIN",[c,new Array(c)]],["COS",[c,new Array(c)]],["TAN",[c,new Array(c)]],["ARCSIN",[c,new Array(c)]],["ARCCOS",[c,new Array(c)]],["ARCTAN",[c,new Array(c)]],["RANDOM",[o,new Array(o,o)]],["MIN",[c,new Array(c)]],["MIN",[o,new Array(o)]],["MAX",[c,new Array(c)]],["MAX",[o,new Array(o)]],["CHARACTER",[a,new Array(o)]],["INTEGER",[o,new Array(c)]],["REAL",[c,new Array(o)]],["TEXT",[s,new Array(a)]])}return Object(r.a)(e,[{key:"register",value:function(e){this.registerBuiltIns(),e.accept(new Ui(this.symbolTable,this.programScope))}},{key:"registerBuiltIns",value:function(){this.registerBuiltInTypes(),this.registerBuiltInProcedures(),this.registerBuiltInConstants(),this.registerBuiltInVariables()}},{key:"registerBuiltInTypes",value:function(){var e=this;this.builtInTypes.forEach((function(t){return e.symbolTable.registerBuiltIns(t)}))}},{key:"registerBuiltInProcedures",value:function(){var e=this;this.systemProcedures.forEach((function(t){var n=new gi(e.symbolTable.globalScope,t[0],t[1][1],t[1][0]);e.symbolTable.registerProcedure(n)}))}},{key:"registerBuiltInConstants",value:function(){var e=this;this.constants.forEach((function(t,n){return e.symbolTable.constants.push(new pi(n,t))}))}},{key:"registerBuiltInVariables",value:function(){var e=this;this.variables.forEach((function(t,n){return e.symbolTable.registerVariable(new Li(e.symbolTable.globalScope,n,!1,t))}))}}],[{key:"run",value:function(t,n,i){new e(t,i).register(n)}},{key:"createInterfaceDeclarationSymbol",value:function(e,t,n){var i,r=t.getName().getName(),a=e.findInterface(r,new ji(n,!0,!0));if(0===a.length)throw new Error("Interface ".concat(r," not defined."));if(a.length>1)throw new Error("Interface ".concat(r," multiple times defined."));var s=t.getCardinality();return new xi(a[0],new Ci(null!==(i=null===s||void 0===s?void 0:s.getMin())&&void 0!==i?i:1,null===s||void 0===s?void 0:s.getMax()))}}]),e}(),Gi=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r){var a;return Object(i.a)(this,n),(a=t.call(this)).symbolTable=e,a.scope=r,a}return Object(r.a)(n,[{key:"findCollectionVariable",value:function(e){if(e instanceof Jt||e instanceof Yt){var t=e.getName().getName(),n=this.symbolTable.findCollectionVariable(t,!0,[],new ji(this.scope,!1,!1));if(n.length>1)throw new Error("Found ".concat(t," multiple times."));if(n.length<1)throw new Error("Failed to find ".concat(t,"."));return n[0]}throw new Error("Not implemented yet.")}},{key:"visitProgram",value:function(e){var t=this;e.getComponents().forEach((function(e){return e.accept(t)}))}},{key:"visitComponent",value:function(e){var t,i=Ni.getComponent(this.symbolTable,e.getName().getName(),new ji(this.scope,!0,!0));null===(t=e.getBody())||void 0===t||t.accept(new n(this.symbolTable,i))}},{key:"visitComponentBody",value:function(e){var t,i,r,a=this;e.getDeclarations().forEach((function(e){return e.accept(a)})),e.getImplementations().forEach((function(e){return e.accept(a)})),null===(t=e.getBeginBlock())||void 0===t||t.accept(new n(this.symbolTable,this.scope)),null===(i=e.getActivityBlock())||void 0===i||i.accept(new n(this.symbolTable,this.scope)),null===(r=e.getFinallyBlock())||void 0===r||r.accept(new n(this.symbolTable,this.scope))}},{key:"visitImplementation",value:function(e){var t,i=this,r=Ni.getImplementation(this.symbolTable,e.getName().getName(),new ji(this.scope,!0,!1));e.getDeclarations().forEach((function(e){return e.accept(new n(i.symbolTable,r))})),null===(t=e.getStatements())||void 0===t||t.accept(new n(this.symbolTable,r))}},{key:"visitProcedure",value:function(e){var t,i=this,r=Ni.getProcedureFromNode(e,this.symbolTable,new ji(this.scope,!0,!1));e.getDeclarations().forEach((function(e){return e.accept(new n(i.symbolTable,r))})),null===(t=e.getStatements())||void 0===t||t.accept(new n(this.symbolTable,r))}},{key:"visitStatementSequence",value:function(e){var t=this;e.getStatements().forEach((function(e){return e.accept(new n(t.symbolTable,new li(t.scope)))}))}},{key:"visitProcedureCall",value:function(e){var t=this,n=e.getParams().map((function(e){return e.accept(new Fi(t.symbolTable,t.scope)),t.symbolTable.getOrThrow(t.symbolTable.expressionToSymbol.get(e))})),i=Ni.getProcedure(e.getName().getName(),this.symbolTable,n,void 0,new ji(this.scope,!0,!1));this.symbolTable.callToSymbol.set(e,i)}},{key:"visitAssignment",value:function(e){e.getDesignator().accept(new Fi(this.symbolTable,this.scope));var t=this.symbolTable.getOrThrow(this.symbolTable.designatorToSymbol.get(e.getDesignator()));if(!(t instanceof Li&&t.mutable)&&!(t instanceof Ai))throw new Error("Cannot asign to to a constant variable.");e.getExpression().accept(new Fi(this.symbolTable,this.scope))}},{key:"visitNew",value:function(e){var t=this;e.getDesignator().accept(new Fi(this.symbolTable,this.scope)),e.getArgs().forEach((function(e){return e.accept(new Fi(t.symbolTable,t.scope))}))}},{key:"visitConnect",value:function(e){e.getTo().accept(new Fi(this.symbolTable,this.scope)),e.getWhat().accept(new Fi(this.symbolTable,this.scope))}},{key:"visitDisconnect",value:function(e){e.getWhat().accept(new Fi(this.symbolTable,this.scope))}},{key:"visitSend",value:function(e){if("FINISHED"===e.getTarget().getName())throw new Error("foo");this.symbolTable.sendReceiveToSymbol.set(e,Ni.getMessage(this.symbolTable,this.scope,e.getFrom(),e.getTarget().getName(),!1,e.getArgs()))}},{key:"visitReceive",value:function(e){this.symbolTable.sendReceiveToSymbol.set(e,Ni.getMessage(this.symbolTable,this.scope,e.getFrom(),e.getReceiver().getName(),!1,e.getTargets()))}},{key:"visitDelete",value:function(e){e.getTarget().accept(new Fi(this.symbolTable,this.scope))}},{key:"visitMove",value:function(e){e.getFrom().accept(new Fi(this.symbolTable,this.scope)),e.getTo().accept(new Fi(this.symbolTable,this.scope))}},{key:"visitAwait",value:function(e){e.getExpression().accept(new Fi(this.symbolTable,this.scope))}},{key:"visitReturn",value:function(e){var t;null===(t=e.getExpression())||void 0===t||t.accept(new Fi(this.symbolTable,this.scope))}},{key:"visitIf",value:function(e){var t,i=this,r=new li(this.scope);e.getExpression().accept(new Fi(this.symbolTable,r)),e.getThen().accept(new n(this.symbolTable,r)),e.getElseIfs().forEach((function(e){return e.accept(new n(i.symbolTable,r))})),null===(t=e.getElse())||void 0===t||t.accept(new n(this.symbolTable,r))}},{key:"visitElseIf",value:function(e){var t=new li(this.scope);e.getExpression().accept(new Fi(this.symbolTable,t)),e.getThen().accept(new n(this.symbolTable,t))}},{key:"visitWhile",value:function(e){var t=new li(this.scope);e.getExpresssion().accept(new Fi(this.symbolTable,t)),e.getBody().accept(new n(this.symbolTable,t))}},{key:"visitRepeat",value:function(e){var t=new li(this.scope);e.getExpresssion().accept(new Fi(this.symbolTable,t)),e.getBody().accept(new Fi(this.symbolTable,t))}},{key:"visitFor",value:function(e){var t,i=new li(this.scope);if(e.getExpression().accept(new Fi(this.symbolTable,i)),!(e.getDesignator()instanceof Yt))throw new Error("Only basic designators currently supported.");e.getDesignator().accept(new Fi(this.symbolTable,i)),e.getTo().accept(new Fi(this.symbolTable,i)),null===(t=e.getBy())||void 0===t||t.accept(new Fi(this.symbolTable,i)),e.getStatements().accept(new n(this.symbolTable,i))}},{key:"visitForeach",value:function(e){var t=this,i=new li(this.scope);e.getOf().accept(new Fi(this.symbolTable,i));var r=this.findCollectionVariable(e.getOf());if(r.parameters.length<e.getDesignators().length)throw new Error("Foreach designator match error.");e.getDesignators().forEach((function(e,n){if(!(e instanceof Yt))throw new Error("Only basic designators supported.");t.symbolTable.registerVariable(new Li(t.scope,e.getName().getName(),!0,r.parameters[n])),e.accept(new Fi(t.symbolTable,i))})),e.getBody().accept(new n(this.symbolTable,i))}},{key:"visitStatementBlock",value:function(e){e.getStatements().accept(this)}}]),n}(ti),Hi=function(){function e(t,n){Object(i.a)(this,e),this.symbolTable=t,this.programScope=n}return Object(r.a)(e,[{key:"fix",value:function(e){e.accept(new Gi(this.symbolTable,this.programScope)),e.accept(new _i(this.symbolTable,this.programScope))}}],[{key:"run",value:function(t,n,i){new e(t,i).fix(n)}}]),e}(),Xi=function(){function e(){Object(i.a)(this,e)}return Object(r.a)(e,[{key:"check",value:function(e,t){var n=new Ii,i=new oi(n.globalScope,e);return Wi.run(n,t,i),Hi.run(n,t,i),n}}]),e}(),Qi=n(1);!function(e){e[e.Tag=0]="Tag"}(wi||(wi={}));var zi=function e(){Object(i.a)(this,e),this._labelTag=wi.Tag},Yi=function(){function e(){Object(i.a)(this,e),this.targets=new Map,this.origins=new Map,this.code=new Array}return Object(r.a)(e,[{key:"complete",value:function(){return this.fixLabels(),this.code}},{key:"createLabel",value:function(){return new zi}},{key:"setLabel",value:function(e){this.targets.set(e,this.code.length)}},{key:"fixLabels",value:function(){var e=this;this.origins.forEach((function(t,n){var i=e.targets.get(n);if(void 0===i)throw new Error("Cannot branch to unknown label.");t.forEach((function(t){var n=e.code[t-1];if(n.code!==Qi.l.Branch&&n.code!==Qi.l.BranchFalse&&n.code!==Qi.l.BranchTrue)throw new Error("Not a jump instruction: "+n.code+", target: "+i+", origin: "+t);e.code[t-1].arguments.push(new Qi.j(i-t))}))}))}},{key:"emitLoadInteger",value:function(e){this.emit(Qi.l.LoadConstantInteger,new Qi.h(e))}},{key:"emitLoadFloat",value:function(e){this.emit(Qi.l.LoadConstantFloat,new Qi.d(e))}},{key:"emitLoadCharacter",value:function(e){this.emit(Qi.l.LoadConstantCharacter,new Qi.b(e))}},{key:"emitLoadText",value:function(e){this.emit(Qi.l.LoadConstantText,new Qi.p(e))}},{key:"emitLoadBoolean",value:function(e){this.emit(Qi.l.LoadConstantBoolean,new Qi.a(e))}},{key:"emitJump",value:function(e,t){var n;this.emit(e),this.origins.has(t)||this.origins.set(t,new Array),null===(n=this.origins.get(t))||void 0===n||n.push(this.code.length)}},{key:"emitBranch",value:function(e){this.emitJump(Qi.l.Branch,e)}},{key:"emitBranchFalse",value:function(e){this.emitJump(Qi.l.BranchFalse,e)}},{key:"emitBranchTrue",value:function(e){this.emitJump(Qi.l.BranchTrue,e)}},{key:"emitSystemCall",value:function(e,t){var n=new Qi.n(e);n.arguments.push(new Qi.h(t)),this.emit(Qi.l.SystemCall,n)}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.code.push(Object(a.a)(Qi.g,[e].concat(n)))}}]),e}(),Ji=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this)).symbols=e,s.scope=r,s.metadata=a,s.assembler=new Yi,s}return Object(r.a)(n,[{key:"getInstructions",value:function(){return this.assembler.complete()}},{key:"visitBasicDesignator",value:function(e){var t=e.getName().getName(),n=this.symbols.getOrThrow(this.symbols.designatorToSymbol.get(e));if(n instanceof di&&n.scope===this.symbols.globalScope)switch(t){case"FALSE":return void this.assembler.emitLoadBoolean(!1);case"TRUE":return void this.assembler.emitLoadBoolean(!0);case"PI":return void this.assembler.emitLoadFloat(Math.PI)}if(n instanceof Li||n instanceof Ai){var i=this.metadata.findVariable(n);this.assembler.emit(Qi.l.LoadVariable,i)}else{if(!(n instanceof bi))throw Error("Unsupported BasicDesignatorNode ".concat(t));var r=this.metadata.findInterface(n);this.assembler.emit(Qi.l.LoadService,r)}}},{key:"visitBaseTargetDesignator",value:function(e){var t=this.symbols.designatorToSymbol.get(e);if(void 0===t)throw new Error("Failed base target designator node lookup.");e.getTarget().accept(this),t instanceof gi?this.handleCall(t):e.getBase().accept(this)}},{key:"visitAttribute",value:function(e){switch(e.getName().getName()){case"SHARED":this.assembler.emit(Qi.l.AcquireShared);break;case"EXCLUSIVE":this.assembler.emit(Qi.l.AcquireExclusive)}}},{key:"handleLockRelease",value:function(e){switch(e.getName().getName()){case"SHARED":this.assembler.emit(Qi.l.ReleaseShared);break;case"EXCLUSIVE":this.assembler.emit(Qi.l.ReleaseExclusive)}}},{key:"visitStatementSequence",value:function(e){var t=this;e.getAttributes().forEach((function(e){return e.accept(t)})),e.getStatements().forEach((function(e){return e.accept(t)})),e.getAttributes().forEach((function(e){return t.handleLockRelease(e)}))}},{key:"handleSystemCall",value:function(e){var t=e.identifier,n=e.parameters.length;if(e.scope!==this.symbols.globalScope)return!1;switch(t){case"WRITELINE":return this.assembler.emitSystemCall(Qi.o.WriteLine,n),!0;case"ASSERT":return this.assembler.emitSystemCall(Qi.o.Assert,n),!0;case"HALT":return this.assembler.emitSystemCall(Qi.o.Halt,n),!0;case"INC":return this.assembler.emitSystemCall(Qi.o.Inc,n),!0;case"DEC":return this.assembler.emitSystemCall(Qi.o.Dec,n),!0;case"PASSIVATE":return this.assembler.emitSystemCall(Qi.o.Passivate,n),!0;case"WRITE":return this.assembler.emitSystemCall(Qi.o.Write,n),!0;case"WRITEHEX":return this.assembler.emitSystemCall(Qi.o.WriteHex,n),!0;case"COUNT":return this.assembler.emitSystemCall(Qi.o.Count,n),!0;case"LENGTH":return this.assembler.emitSystemCall(Qi.o.Length,n),!0;case"SQRT":return this.assembler.emitSystemCall(Qi.o.Sqrt,n),!0;case"SIN":return this.assembler.emitSystemCall(Qi.o.Sin,n),!0;case"COS":return this.assembler.emitSystemCall(Qi.o.Cos,n),!0;case"TAN":return this.assembler.emitSystemCall(Qi.o.Tan,n),!0;case"ARCSIN":return this.assembler.emitSystemCall(Qi.o.ArcSin,n),!0;case"ARCCOS":return this.assembler.emitSystemCall(Qi.o.ArcCos,n),!0;case"ARCTAN":return this.assembler.emitSystemCall(Qi.o.ArcTan,n),!0;case"MIN":return this.assembler.emitSystemCall(Qi.o.Min,n),!0;case"MAX":return this.assembler.emitSystemCall(Qi.o.Max,n),!0;case"CHARACTER":return this.assembler.emitSystemCall(Qi.o.ToCharacter,n),!0;case"INTEGER":return this.assembler.emitSystemCall(Qi.o.ToInteger,n),!0;case"REAL":return this.assembler.emitSystemCall(Qi.o.ToReal,n),!0;case"TEXT":return this.assembler.emitSystemCall(Qi.o.ToText,n),!0;case"RANDOM":return this.assembler.emitSystemCall(Qi.o.Random,n),!0}return!1}},{key:"handleCall",value:function(e){this.handleSystemCall(e)||this.assembler.emit(Qi.l.ProcedureCall,this.metadata.findProcedure(e))}},{key:"visitProcedureCall",value:function(e){var t=this;e.getParams().forEach((function(e){e.accept(t)})),this.handleCall(this.symbols.getOrThrow(this.symbols.callToSymbol.get(e)))}},{key:"visitAssignment",value:function(e){e.getDesignator().accept(this),e.getExpression().accept(this),this.assembler.emit(Qi.l.StoreVariable)}},{key:"visitConstantList",value:function(e){var t=this;e.getConstants().forEach((function(e){var n=t.symbols.getOrThrow(t.symbols.variableToSymbol.get(e)),i=t.metadata.findVariable(n);t.assembler.emit(Qi.l.LoadVariable,i),e.getExpression().getExpression().accept(t),t.assembler.emit(Qi.l.StoreVariable)}))}},{key:"visitNew",value:function(e){var t=this,n=e.getDesignator(),i=this.symbols.designatorToSymbol.get(n);if(e.getArgs().forEach((function(e){return e.accept(t)})),n.accept(this),i instanceof Li||i instanceof Ai){var r=i.type;if(r instanceof Ti)return void this.assembler.emit(Qi.l.New,this.metadata.findComponent(r));if(r instanceof di)return void this.assembler.emit(Qi.l.New,this.metadata.builtInTypeDescriptor(r))}throw new Error("Unsupported new statement.")}},{key:"visitConnect",value:function(e){e.getWhat().accept(this),e.getTo().accept(this),this.assembler.emit(Qi.l.Connect)}},{key:"visitDisconnect",value:function(e){e.getWhat().accept(this),this.assembler.emit(Qi.l.Disconnect)}},{key:"visitSend",value:function(e){var t=this;e.getArgs().forEach((function(e){return e.accept(t)}));var n=e.getFrom();(void 0===n||n instanceof Yt)&&this.assembler.emit(Qi.l.LoadThis),null===n||void 0===n||n.accept(this);var i=this.metadata.findMessage(this.symbols.getOrThrow(this.symbols.sendReceiveToSymbol.get(e)));this.assembler.emit(Qi.l.Send,i)}},{key:"visitReceive",value:function(e){var t=this;e.getTargets().forEach((function(e){return e.accept(t)}));var n=e.getFrom();(void 0===n||n instanceof Yt)&&this.assembler.emit(Qi.l.LoadThis),null===n||void 0===n||n.accept(this);var i=this.metadata.findMessage(this.symbols.getOrThrow(this.symbols.sendReceiveToSymbol.get(e)));this.assembler.emit(Qi.l.Receive,i)}},{key:"visitDelete",value:function(e){e.getTarget().accept(this),this.assembler.emit(Qi.l.Delete)}},{key:"visitMove",value:function(e){e.getFrom().accept(this),e.getTo().accept(this),this.assembler.emit(Qi.l.Move)}},{key:"visitAwait",value:function(e){var t=this.assembler.createLabel(),n=this.assembler.createLabel();this.assembler.setLabel(t),e.getExpression().accept(this),this.assembler.emitBranchFalse(n),this.assembler.emitBranch(t),this.assembler.setLabel(n)}},{key:"visitReturn",value:function(e){var t;null===(t=e.getExpression())||void 0===t||t.accept(this),this.assembler.emit(Qi.l.Return)}},{key:"visitIf",value:function(e){var t,n=this,i=this.assembler.createLabel(),r=e.getElseIfs().map((function(){return n.assembler.createLabel()})),a=this.assembler.createLabel();(e.getExpression().accept(this),e.getElseIfs().length>0&&(this.assembler.emitBranchFalse(r[0]),e.getThen().accept(this),e.getElseIfs().forEach((function(t,s){n.assembler.emitBranch(i),n.assembler.setLabel(r[s]),t.getExpression().accept(n),n.assembler.emitBranchFalse(s+1<e.getElseIfs().length?r[s+1]:void 0!==e.getElse()?a:i),t.getThen().accept(n)}))),void 0!==e.getElse())&&(this.assembler.emitBranchFalse(a),e.getThen().accept(this),this.assembler.emitBranch(i),this.assembler.setLabel(a),null===(t=e.getElse())||void 0===t||t.accept(this));0===e.getElseIfs().length&&void 0===e.getElse()&&(this.assembler.emitBranchFalse(i),e.getThen().accept(this)),this.assembler.setLabel(i)}},{key:"visitWhile",value:function(e){var t=this.assembler.createLabel(),n=this.assembler.createLabel();this.assembler.setLabel(t),e.getExpresssion().accept(this),this.assembler.emitBranchFalse(n),e.getBody().accept(this),this.assembler.emitBranch(t),this.assembler.setLabel(n)}},{key:"visitRepeat",value:function(e){var t=this.assembler.createLabel(),n=this.assembler.createLabel();this.assembler.setLabel(t),e.getBody().accept(this),e.getExpresssion().accept(this),this.assembler.emitBranchFalse(n),this.assembler.emitBranch(t),this.assembler.setLabel(n)}},{key:"visitFor",value:function(e){var t=this.assembler.createLabel(),n=this.assembler.createLabel(),i=e.getDesignator();i.accept(this),e.getExpression().accept(this),this.assembler.emit(Qi.l.StoreVariable),this.assembler.setLabel(t),i.accept(this),e.getTo().accept(this);var r=e.getBy();if(void 0!==r){var a=this.assembler.createLabel(),s=this.assembler.createLabel(),o=r.getExpression();o.accept(this),this.assembler.emitLoadInteger(0),this.assembler.emit(Qi.l.Greater),this.assembler.emitBranchFalse(a),this.assembler.emit(Qi.l.LessEqual),this.assembler.emitBranchFalse(n),this.assembler.emitBranch(s),this.assembler.setLabel(a),this.assembler.emit(Qi.l.GreaterEqual),this.assembler.emitBranchFalse(n),this.assembler.setLabel(s),e.getStatements().accept(this),i.accept(this),o.accept(this),this.assembler.emitSystemCall(Qi.o.Inc,2)}else this.assembler.emit(Qi.l.LessEqual),this.assembler.emitBranchFalse(n),e.getStatements().accept(this),i.accept(this),this.assembler.emitSystemCall(Qi.o.Inc,1);this.assembler.emitBranch(t),this.assembler.setLabel(n)}},{key:"visitForeach",value:function(e){var t=this;console.warn("FOREACH is not yet fully supported by the code generator and runtime.");var n=this.assembler.createLabel(),i=this.assembler.createLabel();this.assembler.setLabel(n),e.getDesignators().forEach((function(e){return e.accept(t)})),e.getOf().accept(this),this.assembler.emitSystemCall(Qi.o.LoadForEachDesignators,e.getDesignators().length),this.assembler.emitBranchFalse(i),e.getBody().accept(this),this.assembler.emitBranch(n),this.assembler.setLabel(i)}},{key:"visitStatementBlock",value:function(e){e.getStatements().accept(this)}},{key:"visitUnaryExpression",value:function(e){e.getExpression().accept(this)}},{key:"visitBinaryExpression",value:function(e){switch(e.getLeft().accept(this),e.getRight().accept(this),e.getOp()){case st.Equal:this.assembler.emit(Qi.l.Equal);break;case st.Less:this.assembler.emit(Qi.l.Less);break;case st.LessEqual:this.assembler.emit(Qi.l.LessEqual);break;case st.More:this.assembler.emit(Qi.l.Greater);break;case st.MoreEqual:this.assembler.emit(Qi.l.GreaterEqual);break;case st.NotEqual:this.assembler.emit(Qi.l.NotEqual)}}},{key:"visitTypeCheck",value:function(e){e.getDesignator().accept(this),e.getType().accept(this),this.assembler.emit(Qi.l.IsType)}},{key:"visitUnaryTermNode",value:function(e){switch(e.getTerm().accept(this),e.getOp()){case pt.Minus:this.assembler.emit(Qi.l.Negate)}}},{key:"visitTermChain",value:function(e){var t=this;e.getLeft().accept(this),e.getRight().forEach((function(e){return e.accept(t)}))}},{key:"visitRightTerm",value:function(e){switch(e.getRight().accept(this),e.getOp()){case mt.Minus:this.assembler.emit(Qi.l.Subtract);break;case mt.Or:this.assembler.emit(Qi.l.LogicOr);break;case mt.Plus:this.assembler.emit(Qi.l.Add)}}},{key:"visitFactorChain",value:function(e){var t=this;e.getLeft().accept(this),e.getRight().forEach((function(e){return e.accept(t)}))}},{key:"visitRightFactor",value:function(e){switch(e.getRight().accept(this),e.getOp()){case Tt.AndText:this.assembler.emit(Qi.l.Add);break;case Tt.Div:case Tt.DivText:this.assembler.emit(Qi.l.Divide);break;case Tt.Times:this.assembler.emit(Qi.l.Multiply);break;case Tt.ModText:this.assembler.emit(Qi.l.Modulo)}}},{key:"visitUnaryFactor",value:function(e){switch(e.getFactor().accept(this),e.getPrefix()){case Ct.Not:this.assembler.emit(Qi.l.Not)}}},{key:"visitExpressionFactor",value:function(e){e.getExpression().accept(this)}},{key:"visitIntegerNumber",value:function(e){this.assembler.emitLoadInteger(e.getValue())}},{key:"visitRealNumber",value:function(e){this.assembler.emitLoadFloat(e.getValue())}},{key:"visitConstantCharacter",value:function(e){this.assembler.emitLoadCharacter(e.getCharacter())}},{key:"visitText",value:function(e){this.assembler.emitLoadText(e.getText())}},{key:"visitReceiveTest",value:function(e){var t=this.symbols.getOrThrow(this.symbols.patternToSymbol.get(e.getPattern())),n=e.getDesignator();void 0===n?this.assembler.emit(Qi.l.LoadThis):n.accept(this),this.assembler.emit(Qi.l.ReceiveTest,this.metadata.findMessage(t))}},{key:"visitInputTest",value:function(e){var t=e.getDesignator();void 0===t?this.assembler.emit(Qi.l.LoadThis):t.accept(this),this.assembler.emit(Qi.l.InputTest)}},{key:"visitExistsTest",value:function(e){e.getDesignator().accept(this),this.assembler.emit(Qi.l.ExistsTest)}},{key:"visitFunctionCall",value:function(e){var t=this;e.getArguments().forEach((function(e){return e.accept(t)})),this.handleCall(this.symbols.getOrThrow(this.symbols.callToSymbol.get(e)))}},{key:"visitProcedure",value:function(e){var t,i,r=this.symbols.getOrThrow(this.symbols.procedureToSymbol.get(e)),a=new n(this.symbols,r,this.metadata);null===(t=e.getStatements())||void 0===t||t.accept(a),(i=this.metadata.findProcedure(r).begin.instructions).push.apply(i,o(a.getInstructions()))}}]),n}(ti),Ki=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this)).symbol=e,s.metadata=r,s.symbols=a,s}return Object(r.a)(n,[{key:"visitImplementation",value:function(e){var t,n,i,r=this.metadata.findImplementation(this.symbol),a=new Ji(this.symbols,this.symbol,this.metadata);e.getDeclarations().filter((function(e){return e instanceof ei||e instanceof it})).forEach((function(e){return e.accept(a)})),(t=r.declarations.init.instructions).push.apply(t,o(a.getInstructions())),a=new Ji(this.symbols,this.symbol,this.metadata),null===(n=e.getStatements())||void 0===n||n.accept(a),(i=r.begin.instructions).push.apply(i,o(a.getInstructions()))}}]),n}(ti),$i=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e,r,a){var s;return Object(i.a)(this,n),(s=t.call(this)).symbol=e,s.metadata=r,s.symbols=a,s}return Object(r.a)(n,[{key:"visitComponentBody",value:function(e){var t,n,i,r,a,s,c,u=this,l=this.metadata.findComponent(this.symbol),h=new Ji(this.symbols,this.symbol,this.metadata);e.getDeclarations().filter((function(e){return e instanceof ei||e instanceof it})).forEach((function(e){return e.accept(h)})),(t=l.declarations.init.instructions).push.apply(t,o(h.getInstructions())),e.getImplementations().forEach((function(e){var t=u.symbols.getOrThrow(u.symbols.implementationToSymbol.get(e)),n=new Ki(t,u.metadata,u.symbols);e.accept(n)})),h=new Ji(this.symbols,this.symbol,this.metadata),null===(n=e.getBeginBlock())||void 0===n||n.accept(h),(i=l.begin.instructions).push.apply(i,o(h.getInstructions())),h=new Ji(this.symbols,this.symbol,this.metadata),null===(r=e.getActivityBlock())||void 0===r||r.accept(h),(a=l.activity.instructions).push.apply(a,o(h.getInstructions())),h=new Ji(this.symbols,this.symbol,this.metadata),null===(s=e.getFinallyBlock())||void 0===s||s.accept(h),(c=l.finally.instructions).push.apply(c,o(h.getInstructions()))}}]),n}(ti),Zi=function(){function e(){Object(i.a)(this,e),this.componentMapping=new Map,this.interfaceMapping=new Map,this.implementationMapping=new Map,this.procedureMapping=new Map,this.variableMapping=new Map,this.messageMapping=new Map,this.globalDescriptor=new Qi.c("@___@GLOBAL_DESCRIPTOR@___@")}return Object(r.a)(e,[{key:"getGlobalComponent",value:function(){return this.globalDescriptor}},{key:"pushComponent",value:function(e,t){this.componentMapping.set(e,t)}},{key:"findComponent",value:function(e){var t=this.componentMapping.get(e);if(void 0===t)throw new Error("Unknown Symbol <-> Component Mapping.");return t}},{key:"pushInterface",value:function(e,t){this.interfaceMapping.set(e,t)}},{key:"findInterface",value:function(e){var t=this.interfaceMapping.get(e);if(void 0===t)throw new Error("Unknown Symbol <-> Interface Mapping.");return t}},{key:"pushImplementation",value:function(e,t){this.implementationMapping.set(e,t)}},{key:"findImplementation",value:function(e){var t=this.implementationMapping.get(e);if(void 0===t)throw new Error("Unknown Symbol <-> Component Mapping.");return t}},{key:"pushProcedure",value:function(e,t){this.procedureMapping.set(e,t)}},{key:"findProcedure",value:function(e){var t=this.procedureMapping.get(e);if(void 0===t)throw new Error("Unkknown Symbol <-> Component Mapping.");return t}},{key:"pushVariable",value:function(e,t){this.variableMapping.set(e,t)}},{key:"findVariable",value:function(e){var t=this.variableMapping.get(e);if(void 0===t)throw new Error("Unkknown Symbol <-> Variable Mapping.");return t}},{key:"pushMessage",value:function(e,t){this.messageMapping.set(e,t)}},{key:"findMessage",value:function(e){var t=this.messageMapping.get(e);if(void 0===t)throw new Error("Unkknown Symbol <-> Message Mapping.");return t}},{key:"builtInTypeDescriptor",value:function(e){switch(e.identifier){case"INTEGER":return new Qi.h;case"REAL":return new Qi.d;case"BOOLEAN":return new Qi.a;case"CHARACTER":return new Qi.b;case"TEXT":return new Qi.p;default:throw new Error("Unsupported variable built in type symbol.")}}}]),e}(),er=function(){function e(){Object(i.a)(this,e)}return Object(r.a)(e,[{key:"generate",value:function(e){var t=this,n=new Qi.e,i=this.generateMetadata(e);return e.components.forEach((function(r){return t.generateComponent(r,e,n,i)})),n}},{key:"generateMetadata",value:function(e){var t=this,n=new Zi;return n.pushComponent(e.anyComponentType,new Qi.c(e.anyComponentType.identifier)),n.pushInterface(e.anyRequiredInterfaceType,new Qi.i(e.anyRequiredInterfaceType.identifier)),n.pushMessage(e.finishMessage,new Qi.k(e.finishMessage.identifier)),n.pushMessage(e.anyMessage,new Qi.k(e.anyMessage.identifier)),e.getSystemProcedures().forEach((function(e){var i,r=new Qi.m(e.identifier,void 0);(i=r.parameters).push.apply(i,o(e.parameters.map((function(e){return new Qi.q(e.identifier,t.convertSymbolToDescriptor(e,n),!0)})))),n.pushProcedure(e,r)})),e.interfaces.forEach((function(e){return n.pushInterface(e,new Qi.i(e.identifier))})),e.components.forEach((function(e){return n.pushComponent(e,new Qi.c(e.identifier))})),e.messages.forEach((function(e){var i=new Qi.k(e.identifier);e.parameters.forEach((function(e){i.data.push(t.convertSymbolToDescriptor(e,n))})),n.pushMessage(e,i)})),e.interfaces.forEach((function(i){return t.fillInterface(i,n,e)})),e.impplementations.forEach((function(e){var t=new Qi.f(n.findInterface(e.interfaceSymbol));n.pushImplementation(e,t)})),e.variables.forEach((function(e){var i=t.convertSymbolToDescriptor(e.type,n),r=new Qi.q(e.identifier,i,!0);i instanceof Qi.p&&r.indexTypes.push(new Qi.h),n.pushVariable(e,r)})),e.collectionVariables.forEach((function(e){var i,r=t.convertSymbolToDescriptor(e.type,n),a=new Qi.q(e.identifier,r,!0);(i=a.indexTypes).push.apply(i,o(e.parameters.map((function(e){return t.convertSymbolToDescriptor(e,n)})))),n.pushVariable(e,a)})),e.procedures.forEach((function(i){var r,a=i.returnType,s=a===e.voidType?void 0:t.convertSymbolToDescriptor(a,n),c=new Qi.m(i.identifier,s);(r=c.parameters).push.apply(r,o(i.parameters.map((function(e){return new Qi.q(e.identifier,t.convertSymbolToDescriptor(e,n),!0)})))),n.pushProcedure(i,c)})),e.components.forEach((function(i){return t.fillComponent(i,n,e)})),n}},{key:"convertSymbolToDescriptor",value:function(e,t){if(e instanceof di)return t.builtInTypeDescriptor(e);if(e instanceof Ti)return t.findComponent(e);if(e instanceof bi)return t.findInterface(e);throw new Error("Cannot convert to descriptor")}},{key:"fillInterface",value:function(e,t,n){t.findInterface(e)}},{key:"fillComponent",value:function(e,t,n){var i=t.findComponent(e);e.genericType.offered.forEach((function(e){return i.offers.push(t.findInterface(e.interfaceSymbol))})),e.genericType.required.forEach((function(e){return i.requires.push(t.findInterface(e.interfaceSymbol))})),n.getImplementations(e).forEach((function(e){return i.implementations.push(t.findImplementation(e))})),n.getVariables(e).forEach((function(e){return i.declarations.variables.push(t.findVariable(e))})),n.getCollectionVariables(e).forEach((function(e){return i.declarations.variables.push(t.findVariable(e))})),n.getProcedures(e).forEach((function(e){return i.declarations.procedures.push(t.findProcedure(e))}))}},{key:"generateComponent",value:function(e,t,n,i){var r,a=t.symbolToComponent.get(e);if(void 0===a||!(a instanceof Ze))throw new Error("Failed node lookup for component ".concat(e.identifier));null===(r=a.getBody())||void 0===r||r.accept(new $i(e,i,t));var s=i.findComponent(e);n.components.push(s),e.isEntryPoint&&n.entryPoints.push(s)}}]),e}(),tr=function(){function e(){Object(i.a)(this,e)}return Object(r.a)(e,[{key:"compile",value:function(e,t){var n=new Ge,i=new Qe(n,e,t),r=new ii(n,i).parse();if(n.hasErrors())throw n.print(console.log),new Error("Error during Lexing and/or Parsing. See console.log.");var a=(new Xi).check(e,r);return(new er).generate(a)}}]),e}(),nr=n(13),ir=self,rr=!1;function ar(e){var t=(rr=e)?"":"\n> ";ir.postMessage({output:t,running:rr})}function sr(e){rr=!1,ir.postMessage({output:"\n!!! ".concat(e," !!!\n\n"),running:rr})}var or=new tr,cr=new nr.a;cr.changeOutput(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((function(e){void 0!==e&&ir.postMessage({output:e,running:rr})}))}.bind(ir)),cr.isRunningUpdate(ar.bind(ir)),ir.onmessage=function(e){if("run"===e.data.fn)try{ar(!0);var t=or.compile(e.data.uri,e.data.code);cr.run(t)}catch(n){sr(n.message)}if("stop"===e.data.fn)try{cr.halt()}catch(n){sr(n.message)}};t.default=ir}]);
//# sourceMappingURL=system.worker.526f85ec.worker.js.map